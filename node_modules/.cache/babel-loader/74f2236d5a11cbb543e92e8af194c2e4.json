{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\components\\Table\\menu\\src\\mixin.js","dependencies":[{"path":"D:\\cdRule\\src\\components\\Table\\menu\\src\\mixin.js","mtime":1635230121403},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import XEUtils from 'xe-utils';\nimport { UtilTools, DomTools } from \"../../tools\";\nimport VXETable from \"../../v-x-e-table\";\nexport default {\n  methods: {\n    /**\r\n     * 关闭快捷菜单\r\n     */\n    _closeMenu: function _closeMenu() {\n      Object.assign(this.ctxMenuStore, {\n        visible: false,\n        selected: null,\n        selectChild: null,\n        showChild: false\n      });\n      return this.$nextTick();\n    },\n    // 处理菜单的移动\n    moveCtxMenu: function moveCtxMenu(evnt, keyCode, ctxMenuStore, property, operKey, operRest, menuList) {\n      var selectItem;\n      var selectIndex = XEUtils.findIndexOf(menuList, function (item) {\n        return ctxMenuStore[property] === item;\n      });\n\n      if (keyCode === operKey) {\n        if (operRest && UtilTools.hasChildrenList(ctxMenuStore.selected)) {\n          ctxMenuStore.showChild = true;\n        } else {\n          ctxMenuStore.showChild = false;\n          ctxMenuStore.selectChild = null;\n        }\n      } else if (keyCode === 38) {\n        for (var len = selectIndex - 1; len >= 0; len--) {\n          if (menuList[len].visible !== false) {\n            selectItem = menuList[len];\n            break;\n          }\n        }\n\n        ctxMenuStore[property] = selectItem || menuList[menuList.length - 1];\n      } else if (keyCode === 40) {\n        for (var index = selectIndex + 1; index < menuList.length; index++) {\n          if (menuList[index].visible !== false) {\n            selectItem = menuList[index];\n            break;\n          }\n        }\n\n        ctxMenuStore[property] = selectItem || menuList[0];\n      } else if (ctxMenuStore[property] && (keyCode === 13 || keyCode === 32)) {\n        this.ctxMenuLinkEvent(evnt, ctxMenuStore[property]);\n      }\n    },\n\n    /**\r\n     * 快捷菜单事件处理\r\n     */\n    handleGlobalContextmenuEvent: function handleGlobalContextmenuEvent(evnt) {\n      var $refs = this.$refs,\n          tId = this.tId,\n          editStore = this.editStore,\n          menuConfig = this.menuConfig,\n          contextMenu = this.contextMenu,\n          ctxMenuStore = this.ctxMenuStore,\n          ctxMenuOpts = this.ctxMenuOpts,\n          mouseConfig = this.mouseConfig,\n          mouseOpts = this.mouseOpts;\n      var selected = editStore.selected;\n      var layoutList = ['header', 'body', 'footer'];\n\n      if (menuConfig || contextMenu) {\n        if (ctxMenuStore.visible && $refs.ctxWrapper && DomTools.getEventTargetNode(evnt, $refs.ctxWrapper.$el).flag) {\n          evnt.preventDefault();\n          return;\n        }\n\n        if (this._keyCtx) {\n          var type = 'body';\n          var params = {\n            type: type,\n            $grid: this.$xegrid,\n            $table: this,\n            keyboard: true,\n            columns: this.visibleColumn.slice(0),\n            $event: evnt // 如果开启单元格区域\n\n          };\n\n          if (mouseConfig && mouseOpts.area) {\n            var activeArea = this.getActiveCellArea();\n\n            if (activeArea && activeArea.row && activeArea.column) {\n              params.row = activeArea.row;\n              params.column = activeArea.column;\n              this.openContextMenu(evnt, type, params);\n              return;\n            }\n          } else if (mouseConfig && mouseOpts.selected) {\n            // 如果启用键盘导航且已选中单元格\n            if (selected.row && selected.column) {\n              params.row = selected.row;\n              params.column = selected.column;\n              this.openContextMenu(evnt, type, params);\n              return;\n            }\n          }\n        } // 分别匹配表尾、内容、表尾的快捷菜单\n\n\n        for (var index = 0; index < layoutList.length; index++) {\n          var layout = layoutList[index];\n          var columnTargetNode = DomTools.getEventTargetNode(evnt, this.$el, \"vxe-\".concat(layout, \"--column\"), function (target) {\n            // target=td|th，直接向上找 table 去匹配即可\n            return target.parentNode.parentNode.parentNode.getAttribute('xid') === tId;\n          });\n          var _params = {\n            type: layout,\n            $grid: this.$xegrid,\n            $table: this,\n            columns: this.visibleColumn.slice(0),\n            $event: evnt\n          };\n\n          if (columnTargetNode.flag) {\n            var cell = columnTargetNode.targetElem;\n            var column = this.getColumnNode(cell).item;\n            var typePrefix = \"\".concat(layout, \"-\");\n            Object.assign(_params, {\n              column: column,\n              columnIndex: this.getColumnIndex(column),\n              cell: cell\n            });\n\n            if (layout === 'body') {\n              var row = this.getRowNode(cell.parentNode).item;\n              typePrefix = '';\n              _params.row = row;\n              _params.rowIndex = this.getRowIndex(row);\n            }\n\n            this.openContextMenu(evnt, layout, _params); // 在 v4 中废弃事件 cell-context-menu、header-cell-context-menu、footer-cell-context-menu\n\n            if (this.$listeners[\"\".concat(typePrefix, \"cell-context-menu\")]) {\n              if (process.env.VUE_APP_VXE_TABLE_ENV === 'development') {\n                UtilTools.warn('vxe.error.delEvent', [\"\".concat(typePrefix, \"cell-context-menu\"), \"\".concat(typePrefix, \"cell-menu\")]);\n              }\n\n              this.emitEvent(\"\".concat(typePrefix, \"cell-context-menu\"), _params, evnt);\n            } else {\n              this.emitEvent(\"\".concat(typePrefix, \"cell-menu\"), _params, evnt);\n            }\n\n            return;\n          } else if (DomTools.getEventTargetNode(evnt, this.$el, \"vxe-table--\".concat(layout, \"-wrapper\"), function (target) {\n            return target.getAttribute('xid') === tId;\n          }).flag) {\n            if (ctxMenuOpts.trigger === 'cell') {\n              evnt.preventDefault();\n            } else {\n              this.openContextMenu(evnt, layout, _params);\n            }\n\n            return;\n          }\n        }\n      }\n\n      if ($refs.filterWrapper && !DomTools.getEventTargetNode(evnt, $refs.filterWrapper.$el).flag) {\n        this.closeFilter();\n      }\n\n      this.closeMenu();\n    },\n\n    /**\r\n     * 显示快捷菜单\r\n     */\n    openContextMenu: function openContextMenu(evnt, type, params) {\n      var _this = this;\n\n      var isCtxMenu = this.isCtxMenu,\n          ctxMenuStore = this.ctxMenuStore,\n          ctxMenuOpts = this.ctxMenuOpts;\n      var config = ctxMenuOpts[type];\n      var visibleMethod = ctxMenuOpts.visibleMethod;\n\n      if (config) {\n        var options = config.options,\n            disabled = config.disabled;\n\n        if (disabled) {\n          evnt.preventDefault();\n        } else if (isCtxMenu && options && options.length) {\n          params.options = options;\n          this.preventEvent(evnt, 'event.showMenu', params, function () {\n            if (!visibleMethod || visibleMethod(params)) {\n              evnt.preventDefault();\n\n              _this.updateZindex();\n\n              var _DomTools$getDomNode = DomTools.getDomNode(),\n                  scrollTop = _DomTools$getDomNode.scrollTop,\n                  scrollLeft = _DomTools$getDomNode.scrollLeft,\n                  visibleHeight = _DomTools$getDomNode.visibleHeight,\n                  visibleWidth = _DomTools$getDomNode.visibleWidth;\n\n              var top = evnt.clientY + scrollTop;\n              var left = evnt.clientX + scrollLeft;\n\n              var handleVisible = function handleVisible() {\n                Object.assign(ctxMenuStore, {\n                  args: params,\n                  visible: true,\n                  list: options,\n                  selected: null,\n                  selectChild: null,\n                  showChild: false,\n                  style: {\n                    zIndex: _this.tZindex,\n                    top: \"\".concat(top, \"px\"),\n                    left: \"\".concat(left, \"px\")\n                  }\n                });\n\n                _this.$nextTick(function () {\n                  var ctxElem = _this.$refs.ctxWrapper.$el;\n                  var clientHeight = ctxElem.clientHeight;\n                  var clientWidth = ctxElem.clientWidth;\n\n                  var _DomTools$getAbsolute = DomTools.getAbsolutePos(ctxElem),\n                      boundingTop = _DomTools$getAbsolute.boundingTop,\n                      boundingLeft = _DomTools$getAbsolute.boundingLeft;\n\n                  var offsetTop = boundingTop + clientHeight - visibleHeight;\n                  var offsetLeft = boundingLeft + clientWidth - visibleWidth;\n\n                  if (offsetTop > -10) {\n                    ctxMenuStore.style.top = \"\".concat(Math.max(scrollTop + 2, top - clientHeight - 2), \"px\");\n                  }\n\n                  if (offsetLeft > -10) {\n                    ctxMenuStore.style.left = \"\".concat(Math.max(scrollLeft + 2, left - clientWidth - 2), \"px\");\n                  }\n                });\n              };\n\n              var keyboard = params.keyboard,\n                  row = params.row,\n                  column = params.column;\n\n              if (keyboard && row && column) {\n                _this.scrollToRow(row, column).then(function () {\n                  var cell = _this.getCell(row, column);\n\n                  var _DomTools$getAbsolute2 = DomTools.getAbsolutePos(cell),\n                      boundingTop = _DomTools$getAbsolute2.boundingTop,\n                      boundingLeft = _DomTools$getAbsolute2.boundingLeft;\n\n                  top = boundingTop + scrollTop + Math.floor(cell.offsetHeight / 2);\n                  left = boundingLeft + scrollLeft + Math.floor(cell.offsetWidth / 2);\n                  handleVisible();\n                });\n              } else {\n                handleVisible();\n              }\n            } else {\n              _this.closeMenu();\n            }\n          });\n        }\n      }\n\n      this.closeFilter();\n    },\n    ctxMenuMouseoverEvent: function ctxMenuMouseoverEvent(evnt, item, child) {\n      var menuElem = evnt.currentTarget;\n      var ctxMenuStore = this.ctxMenuStore;\n      evnt.preventDefault();\n      evnt.stopPropagation();\n      ctxMenuStore.selected = item;\n      ctxMenuStore.selectChild = child;\n\n      if (!child) {\n        ctxMenuStore.showChild = UtilTools.hasChildrenList(item);\n\n        if (ctxMenuStore.showChild) {\n          this.$nextTick(function () {\n            var childWrapperElem = menuElem.nextElementSibling;\n\n            if (childWrapperElem) {\n              var _DomTools$getAbsolute3 = DomTools.getAbsolutePos(menuElem),\n                  boundingTop = _DomTools$getAbsolute3.boundingTop,\n                  boundingLeft = _DomTools$getAbsolute3.boundingLeft,\n                  visibleHeight = _DomTools$getAbsolute3.visibleHeight,\n                  visibleWidth = _DomTools$getAbsolute3.visibleWidth;\n\n              var posTop = boundingTop + menuElem.offsetHeight;\n              var posLeft = boundingLeft + menuElem.offsetWidth;\n              var left = '';\n              var right = ''; // 是否超出右侧\n\n              if (posLeft + childWrapperElem.offsetWidth > visibleWidth - 10) {\n                left = 'auto';\n                right = \"\".concat(menuElem.offsetWidth, \"px\");\n              } // 是否超出底部\n\n\n              var top = '';\n              var bottom = '';\n\n              if (posTop + childWrapperElem.offsetHeight > visibleHeight - 10) {\n                top = 'auto';\n                bottom = '0';\n              }\n\n              childWrapperElem.style.left = left;\n              childWrapperElem.style.right = right;\n              childWrapperElem.style.top = top;\n              childWrapperElem.style.bottom = bottom;\n            }\n          });\n        }\n      }\n    },\n    ctxMenuMouseoutEvent: function ctxMenuMouseoutEvent(evnt, item) {\n      var ctxMenuStore = this.ctxMenuStore;\n\n      if (!item.children) {\n        ctxMenuStore.selected = null;\n      }\n\n      ctxMenuStore.selectChild = null;\n    },\n\n    /**\r\n     * 快捷菜单点击事件\r\n     */\n    ctxMenuLinkEvent: function ctxMenuLinkEvent(evnt, menu) {\n      // 如果一级菜单有配置 code 则允许点击，否则不能点击\n      if (!menu.disabled && (menu.code || !menu.children || !menu.children.length)) {\n        var ctxMenuMethod = VXETable.menus.get(menu.code);\n        var params = Object.assign({\n          menu: menu,\n          $grid: this.$xegrid,\n          $table: this,\n          $event: evnt\n        }, this.ctxMenuStore.args);\n\n        if (ctxMenuMethod) {\n          ctxMenuMethod.call(this, params, evnt);\n        } // 在 v4 中废弃事件 context-menu-click\n\n\n        if (this.$listeners['context-menu-click']) {\n          if (process.env.VUE_APP_VXE_TABLE_ENV === 'development') {\n            UtilTools.warn('vxe.error.delEvent', ['context-menu-click', 'menu-click']);\n          }\n\n          this.emitEvent('context-menu-click', params, evnt);\n        } else {\n          this.emitEvent('menu-click', params, evnt);\n        }\n\n        this.closeMenu();\n      }\n    }\n  }\n};",{"version":3,"sources":["D:\\cdRule\\src\\components\\Table\\menu\\src\\mixin.js"],"names":["methods","_closeMenu","Object","visible","selected","selectChild","showChild","moveCtxMenu","selectIndex","ctxMenuStore","keyCode","operRest","UtilTools","len","menuList","selectItem","index","handleGlobalContextmenuEvent","$refs","tId","editStore","menuConfig","contextMenu","ctxMenuOpts","mouseConfig","mouseOpts","layoutList","DomTools","evnt","type","params","$grid","$table","keyboard","columns","$event","activeArea","layout","columnTargetNode","target","cell","column","typePrefix","columnIndex","row","process","openContextMenu","isCtxMenu","config","visibleMethod","options","disabled","scrollTop","scrollLeft","visibleHeight","visibleWidth","top","left","handleVisible","args","list","style","zIndex","ctxElem","clientHeight","clientWidth","boundingTop","boundingLeft","offsetTop","offsetLeft","Math","ctxMenuMouseoverEvent","menuElem","childWrapperElem","posTop","posLeft","right","bottom","ctxMenuMouseoutEvent","item","ctxMenuLinkEvent","menu","ctxMenuMethod","VXETable"],"mappings":"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","sourcesContent":["import XEUtils from 'xe-utils'\r\nimport { UtilTools, DomTools } from '../../tools'\r\nimport VXETable from '../../v-x-e-table'\r\n\r\nexport default {\r\n  methods: {\r\n    /**\r\n     * 关闭快捷菜单\r\n     */\r\n    _closeMenu () {\r\n      Object.assign(this.ctxMenuStore, {\r\n        visible: false,\r\n        selected: null,\r\n        selectChild: null,\r\n        showChild: false\r\n      })\r\n      return this.$nextTick()\r\n    },\r\n    // 处理菜单的移动\r\n    moveCtxMenu (evnt, keyCode, ctxMenuStore, property, operKey, operRest, menuList) {\r\n      let selectItem\r\n      const selectIndex = XEUtils.findIndexOf(menuList, item => ctxMenuStore[property] === item)\r\n      if (keyCode === operKey) {\r\n        if (operRest && UtilTools.hasChildrenList(ctxMenuStore.selected)) {\r\n          ctxMenuStore.showChild = true\r\n        } else {\r\n          ctxMenuStore.showChild = false\r\n          ctxMenuStore.selectChild = null\r\n        }\r\n      } else if (keyCode === 38) {\r\n        for (let len = selectIndex - 1; len >= 0; len--) {\r\n          if (menuList[len].visible !== false) {\r\n            selectItem = menuList[len]\r\n            break\r\n          }\r\n        }\r\n        ctxMenuStore[property] = selectItem || menuList[menuList.length - 1]\r\n      } else if (keyCode === 40) {\r\n        for (let index = selectIndex + 1; index < menuList.length; index++) {\r\n          if (menuList[index].visible !== false) {\r\n            selectItem = menuList[index]\r\n            break\r\n          }\r\n        }\r\n        ctxMenuStore[property] = selectItem || menuList[0]\r\n      } else if (ctxMenuStore[property] && (keyCode === 13 || keyCode === 32)) {\r\n        this.ctxMenuLinkEvent(evnt, ctxMenuStore[property])\r\n      }\r\n    },\r\n    /**\r\n     * 快捷菜单事件处理\r\n     */\r\n    handleGlobalContextmenuEvent (evnt) {\r\n      const { $refs, tId, editStore, menuConfig, contextMenu, ctxMenuStore, ctxMenuOpts, mouseConfig, mouseOpts } = this\r\n      const { selected } = editStore\r\n      const layoutList = ['header', 'body', 'footer']\r\n      if (menuConfig || contextMenu) {\r\n        if (ctxMenuStore.visible && $refs.ctxWrapper && DomTools.getEventTargetNode(evnt, $refs.ctxWrapper.$el).flag) {\r\n          evnt.preventDefault()\r\n          return\r\n        }\r\n        if (this._keyCtx) {\r\n          const type = 'body'\r\n          const params = { type, $grid: this.$xegrid, $table: this, keyboard: true, columns: this.visibleColumn.slice(0), $event: evnt }\r\n          // 如果开启单元格区域\r\n          if (mouseConfig && mouseOpts.area) {\r\n            const activeArea = this.getActiveCellArea()\r\n            if (activeArea && activeArea.row && activeArea.column) {\r\n              params.row = activeArea.row\r\n              params.column = activeArea.column\r\n              this.openContextMenu(evnt, type, params)\r\n              return\r\n            }\r\n          } else if (mouseConfig && mouseOpts.selected) {\r\n            // 如果启用键盘导航且已选中单元格\r\n            if (selected.row && selected.column) {\r\n              params.row = selected.row\r\n              params.column = selected.column\r\n              this.openContextMenu(evnt, type, params)\r\n              return\r\n            }\r\n          }\r\n        }\r\n        // 分别匹配表尾、内容、表尾的快捷菜单\r\n        for (let index = 0; index < layoutList.length; index++) {\r\n          const layout = layoutList[index]\r\n          const columnTargetNode = DomTools.getEventTargetNode(evnt, this.$el, `vxe-${layout}--column`, target => {\r\n            // target=td|th，直接向上找 table 去匹配即可\r\n            return target.parentNode.parentNode.parentNode.getAttribute('xid') === tId\r\n          })\r\n          const params = { type: layout, $grid: this.$xegrid, $table: this, columns: this.visibleColumn.slice(0), $event: evnt }\r\n          if (columnTargetNode.flag) {\r\n            const cell = columnTargetNode.targetElem\r\n            const column = this.getColumnNode(cell).item\r\n            let typePrefix = `${layout}-`\r\n            Object.assign(params, { column, columnIndex: this.getColumnIndex(column), cell })\r\n            if (layout === 'body') {\r\n              const row = this.getRowNode(cell.parentNode).item\r\n              typePrefix = ''\r\n              params.row = row\r\n              params.rowIndex = this.getRowIndex(row)\r\n            }\r\n            this.openContextMenu(evnt, layout, params)\r\n            // 在 v4 中废弃事件 cell-context-menu、header-cell-context-menu、footer-cell-context-menu\r\n            if (this.$listeners[`${typePrefix}cell-context-menu`]) {\r\n              if (process.env.VUE_APP_VXE_TABLE_ENV === 'development') {\r\n                UtilTools.warn('vxe.error.delEvent', [`${typePrefix}cell-context-menu`, `${typePrefix}cell-menu`])\r\n              }\r\n              this.emitEvent(`${typePrefix}cell-context-menu`, params, evnt)\r\n            } else {\r\n              this.emitEvent(`${typePrefix}cell-menu`, params, evnt)\r\n            }\r\n            return\r\n          } else if (DomTools.getEventTargetNode(evnt, this.$el, `vxe-table--${layout}-wrapper`, target => target.getAttribute('xid') === tId).flag) {\r\n            if (ctxMenuOpts.trigger === 'cell') {\r\n              evnt.preventDefault()\r\n            } else {\r\n              this.openContextMenu(evnt, layout, params)\r\n            }\r\n            return\r\n          }\r\n        }\r\n      }\r\n      if ($refs.filterWrapper && !DomTools.getEventTargetNode(evnt, $refs.filterWrapper.$el).flag) {\r\n        this.closeFilter()\r\n      }\r\n      this.closeMenu()\r\n    },\r\n    /**\r\n     * 显示快捷菜单\r\n     */\r\n    openContextMenu (evnt, type, params) {\r\n      const { isCtxMenu, ctxMenuStore, ctxMenuOpts } = this\r\n      const config = ctxMenuOpts[type]\r\n      const visibleMethod = ctxMenuOpts.visibleMethod\r\n      if (config) {\r\n        const { options, disabled } = config\r\n        if (disabled) {\r\n          evnt.preventDefault()\r\n        } else if (isCtxMenu && options && options.length) {\r\n          params.options = options\r\n          this.preventEvent(evnt, 'event.showMenu', params, () => {\r\n            if (!visibleMethod || visibleMethod(params)) {\r\n              evnt.preventDefault()\r\n              this.updateZindex()\r\n              const { scrollTop, scrollLeft, visibleHeight, visibleWidth } = DomTools.getDomNode()\r\n              let top = evnt.clientY + scrollTop\r\n              let left = evnt.clientX + scrollLeft\r\n              const handleVisible = () => {\r\n                Object.assign(ctxMenuStore, {\r\n                  args: params,\r\n                  visible: true,\r\n                  list: options,\r\n                  selected: null,\r\n                  selectChild: null,\r\n                  showChild: false,\r\n                  style: {\r\n                    zIndex: this.tZindex,\r\n                    top: `${top}px`,\r\n                    left: `${left}px`\r\n                  }\r\n                })\r\n                this.$nextTick(() => {\r\n                  const ctxElem = this.$refs.ctxWrapper.$el\r\n                  const clientHeight = ctxElem.clientHeight\r\n                  const clientWidth = ctxElem.clientWidth\r\n                  const { boundingTop, boundingLeft } = DomTools.getAbsolutePos(ctxElem)\r\n                  const offsetTop = boundingTop + clientHeight - visibleHeight\r\n                  const offsetLeft = boundingLeft + clientWidth - visibleWidth\r\n                  if (offsetTop > -10) {\r\n                    ctxMenuStore.style.top = `${Math.max(scrollTop + 2, top - clientHeight - 2)}px`\r\n                  }\r\n                  if (offsetLeft > -10) {\r\n                    ctxMenuStore.style.left = `${Math.max(scrollLeft + 2, left - clientWidth - 2)}px`\r\n                  }\r\n                })\r\n              }\r\n              const { keyboard, row, column } = params\r\n              if (keyboard && row && column) {\r\n                this.scrollToRow(row, column).then(() => {\r\n                  const cell = this.getCell(row, column)\r\n                  const { boundingTop, boundingLeft } = DomTools.getAbsolutePos(cell)\r\n                  top = boundingTop + scrollTop + Math.floor(cell.offsetHeight / 2)\r\n                  left = boundingLeft + scrollLeft + Math.floor(cell.offsetWidth / 2)\r\n                  handleVisible()\r\n                })\r\n              } else {\r\n                handleVisible()\r\n              }\r\n            } else {\r\n              this.closeMenu()\r\n            }\r\n          })\r\n        }\r\n      }\r\n      this.closeFilter()\r\n    },\r\n    ctxMenuMouseoverEvent (evnt, item, child) {\r\n      const menuElem = evnt.currentTarget\r\n      const ctxMenuStore = this.ctxMenuStore\r\n      evnt.preventDefault()\r\n      evnt.stopPropagation()\r\n      ctxMenuStore.selected = item\r\n      ctxMenuStore.selectChild = child\r\n      if (!child) {\r\n        ctxMenuStore.showChild = UtilTools.hasChildrenList(item)\r\n        if (ctxMenuStore.showChild) {\r\n          this.$nextTick(() => {\r\n            const childWrapperElem = menuElem.nextElementSibling\r\n            if (childWrapperElem) {\r\n              const { boundingTop, boundingLeft, visibleHeight, visibleWidth } = DomTools.getAbsolutePos(menuElem)\r\n              const posTop = boundingTop + menuElem.offsetHeight\r\n              const posLeft = boundingLeft + menuElem.offsetWidth\r\n              let left = ''\r\n              let right = ''\r\n              // 是否超出右侧\r\n              if (posLeft + childWrapperElem.offsetWidth > visibleWidth - 10) {\r\n                left = 'auto'\r\n                right = `${menuElem.offsetWidth}px`\r\n              }\r\n              // 是否超出底部\r\n              let top = ''\r\n              let bottom = ''\r\n              if (posTop + childWrapperElem.offsetHeight > visibleHeight - 10) {\r\n                top = 'auto'\r\n                bottom = '0'\r\n              }\r\n              childWrapperElem.style.left = left\r\n              childWrapperElem.style.right = right\r\n              childWrapperElem.style.top = top\r\n              childWrapperElem.style.bottom = bottom\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    ctxMenuMouseoutEvent (evnt, item) {\r\n      const ctxMenuStore = this.ctxMenuStore\r\n      if (!item.children) {\r\n        ctxMenuStore.selected = null\r\n      }\r\n      ctxMenuStore.selectChild = null\r\n    },\r\n    /**\r\n     * 快捷菜单点击事件\r\n     */\r\n    ctxMenuLinkEvent (evnt, menu) {\r\n      // 如果一级菜单有配置 code 则允许点击，否则不能点击\r\n      if (!menu.disabled && (menu.code || !menu.children || !menu.children.length)) {\r\n        const ctxMenuMethod = VXETable.menus.get(menu.code)\r\n        const params = Object.assign({ menu, $grid: this.$xegrid, $table: this, $event: evnt }, this.ctxMenuStore.args)\r\n        if (ctxMenuMethod) {\r\n          ctxMenuMethod.call(this, params, evnt)\r\n        }\r\n        // 在 v4 中废弃事件 context-menu-click\r\n        if (this.$listeners['context-menu-click']) {\r\n          if (process.env.VUE_APP_VXE_TABLE_ENV === 'development') {\r\n            UtilTools.warn('vxe.error.delEvent', ['context-menu-click', 'menu-click'])\r\n          }\r\n          this.emitEvent('context-menu-click', params, evnt)\r\n        } else {\r\n          this.emitEvent('menu-click', params, evnt)\r\n        }\r\n        this.closeMenu()\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}]}