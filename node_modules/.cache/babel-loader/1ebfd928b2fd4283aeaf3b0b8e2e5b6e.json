{"remainingRequest":"D:\\cdRule\\node_modules\\thread-loader\\dist\\cjs.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\components\\Table\\export\\src\\export-panel.js","dependencies":[{"path":"D:\\cdRule\\src\\components\\Table\\export\\src\\export-panel.js","mtime":1638515703904},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import XEUtils from 'xe-utils';\nimport GlobalConfig from '../../v-x-e-table/src/conf';\nimport VxeModal from '../../modal/src/modal';\nimport VxeInput from '../../input/src/input';\nimport VxeCheckbox from '../../checkbox/src/checkbox';\nimport VxeSelect from '../../select/src/select';\nimport VxeOption from '../../select/src/option';\nimport { UtilTools } from '../../tools';\nexport default {\n  name: 'VxeExportPanel',\n  props: {\n    defaultOptions: Object,\n    storeData: Object\n  },\n  components: {\n    VxeModal,\n    VxeInput,\n    VxeCheckbox,\n    VxeSelect,\n    VxeOption\n  },\n\n  data() {\n    return {\n      isAll: false,\n      isIndeterminate: false,\n      loading: false\n    };\n  },\n\n  computed: {\n    vSize() {\n      return this.size || this.$parent.size || this.$parent.vSize;\n    },\n\n    checkedAll() {\n      return this.storeData.columns.every(column => column.checked);\n    },\n\n    showSheet() {\n      return ['html', 'xml', 'xlsx', 'pdf'].indexOf(this.defaultOptions.type) > -1;\n    },\n\n    supportMerge() {\n      const storeData = this.storeData,\n            defaultOptions = this.defaultOptions;\n      return !defaultOptions.original && defaultOptions.mode === 'current' && (storeData.isPrint || ['html', 'xlsx'].indexOf(defaultOptions.type) > -1);\n    },\n\n    supportStyle() {\n      const defaultOptions = this.defaultOptions;\n      return !defaultOptions.original && ['xlsx'].indexOf(defaultOptions.type) > -1;\n    }\n\n  },\n\n  render(h) {\n    const _e = this._e,\n          checkedAll = this.checkedAll,\n          isAll = this.isAll,\n          isIndeterminate = this.isIndeterminate,\n          showSheet = this.showSheet,\n          supportMerge = this.supportMerge,\n          supportStyle = this.supportStyle,\n          defaultOptions = this.defaultOptions,\n          storeData = this.storeData;\n    const hasTree = storeData.hasTree,\n          hasMerge = storeData.hasMerge,\n          isPrint = storeData.isPrint,\n          hasColgroup = storeData.hasColgroup;\n    const isHeader = defaultOptions.isHeader;\n    const cols = [];\n    XEUtils.eachTree(storeData.columns, column => {\n      const colTitle = UtilTools.formatText(column.getTitle(), 1);\n      const isColGroup = column.children && column.children.length;\n      cols.push(h('li', {\n        class: ['vxe-export--panel-column-option', `level--${column.level}`, {\n          'is--group': isColGroup,\n          'is--checked': column.checked,\n          'is--indeterminate': column.halfChecked,\n          'is--disabled': column.disabled\n        }],\n        attrs: {\n          title: colTitle\n        },\n        on: {\n          click: () => {\n            if (!column.disabled) {\n              this.changeOption(column);\n            }\n          }\n        }\n      }, [h('span', {\n        class: 'vxe-checkbox--icon vxe-checkbox--checked-icon',\n        style: {\n          '--checkedColor': $_theme.color\n        }\n      }), h('span', {\n        class: 'vxe-checkbox--icon vxe-checkbox--unchecked-icon',\n        style: {\n          '--checkedColor': $_theme.color\n        }\n      }), h('span', {\n        class: 'vxe-checkbox--icon vxe-checkbox--indeterminate-icon',\n        style: {\n          '--checkedColor': $_theme.color\n        }\n      }), h('span', {\n        class: 'vxe-checkbox--label'\n      }, colTitle)]));\n    });\n    return h('vxe-modal', {\n      res: 'modal',\n      props: {\n        value: storeData.visible,\n        title: GlobalConfig.i18n(isPrint ? 'vxe.export.printTitle' : 'vxe.export.expTitle'),\n        width: 660,\n        mask: true,\n        lockView: true,\n        showFooter: false,\n        escClosable: true,\n        maskClosable: true,\n        loading: this.loading\n      },\n      on: {\n        input(value) {\n          storeData.visible = value;\n        },\n\n        show: this.showEvent\n      }\n    }, [h('div', {\n      class: 'vxe-export--panel'\n    }, [h('table', {\n      attrs: {\n        cellspacing: 0,\n        cellpadding: 0,\n        border: 0\n      }\n    }, [h('tbody', [[isPrint ? _e() : h('tr', [h('td', GlobalConfig.i18n('vxe.export.expName')), h('td', [h('vxe-input', {\n      ref: 'filename',\n      props: {\n        value: defaultOptions.filename,\n        type: 'text',\n        clearable: true,\n        placeholder: GlobalConfig.i18n('vxe.export.expNamePlaceholder')\n      },\n      on: {\n        modelValue(value) {\n          defaultOptions.filename = value;\n        }\n\n      }\n    })])]), isPrint ? _e() : h('tr', [h('td', GlobalConfig.i18n('vxe.export.expType')), h('td', [h('vxe-select', {\n      props: {\n        value: defaultOptions.type\n      },\n      on: {\n        input(value) {\n          defaultOptions.type = value;\n        }\n\n      }\n    }, storeData.typeList.map(item => {\n      return h('vxe-option', {\n        props: {\n          value: item.value,\n          label: GlobalConfig.i18n(item.label)\n        }\n      });\n    }))])]), isPrint || showSheet ? h('tr', [h('td', GlobalConfig.i18n('vxe.export.expSheetName')), h('td', [h('vxe-input', {\n      ref: 'sheetname',\n      props: {\n        value: defaultOptions.sheetName,\n        type: 'text',\n        clearable: true,\n        placeholder: GlobalConfig.i18n('vxe.export.expSheetNamePlaceholder')\n      },\n      on: {\n        modelValue(value) {\n          defaultOptions.sheetName = value;\n        }\n\n      }\n    })])]) : _e(), h('tr', [h('td', GlobalConfig.i18n('vxe.export.expMode')), h('td', [h('vxe-select', {\n      props: {\n        value: defaultOptions.mode\n      },\n      on: {\n        input(value) {\n          defaultOptions.mode = value;\n        }\n\n      }\n    }, storeData.modeList.map(item => {\n      return h('vxe-option', {\n        props: {\n          value: item.value,\n          label: GlobalConfig.i18n(item.label)\n        }\n      });\n    }))])]), h('tr', [h('td', [GlobalConfig.i18n('vxe.export.expColumn')]), h('td', [h('div', {\n      class: 'vxe-export--panel-column'\n    }, [h('ul', {\n      class: 'vxe-export--panel-column-header'\n    }, [h('li', {\n      class: ['vxe-export--panel-column-option', {\n        'is--checked': isAll,\n        'is--indeterminate': isIndeterminate\n      }],\n      attrs: {\n        title: GlobalConfig.i18n('vxe.table.allTitle')\n      },\n      on: {\n        click: this.allColumnEvent\n      }\n    }, [h('span', {\n      class: 'vxe-checkbox--icon vxe-checkbox--checked-icon',\n      style: {\n        '--checkedColor': $_theme.color\n      }\n    }), h('span', {\n      class: 'vxe-checkbox--icon vxe-checkbox--unchecked-icon',\n      style: {\n        '--checkedColor': $_theme.color\n      }\n    }), h('span', {\n      class: 'vxe-checkbox--icon vxe-checkbox--indeterminate-icon',\n      style: {\n        '--checkedColor': $_theme.color\n      }\n    }), h('span', {\n      class: 'vxe-checkbox--label'\n    }, GlobalConfig.i18n('vxe.export.expCurrentColumn'))])]), h('ul', {\n      class: 'vxe-export--panel-column-body'\n    }, cols)])])]), h('tr', [h('td', GlobalConfig.i18n('vxe.export.expOpts')), h('td', [h('div', {\n      class: 'vxe-export--panel-option-row'\n    }, [h('vxe-checkbox', {\n      props: {\n        value: isHeader,\n        title: GlobalConfig.i18n('vxe.export.expHeaderTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptHeader')\n      },\n      on: {\n        input(value) {\n          defaultOptions.isHeader = value;\n        }\n\n      }\n    }), h('vxe-checkbox', {\n      props: {\n        value: defaultOptions.isFooter,\n        disabled: !storeData.hasFooter,\n        title: GlobalConfig.i18n('vxe.export.expFooterTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptFooter')\n      },\n      on: {\n        input(value) {\n          defaultOptions.isFooter = value;\n        }\n\n      }\n    }), h('vxe-checkbox', {\n      props: {\n        value: defaultOptions.original,\n        title: GlobalConfig.i18n('vxe.export.expOriginalTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptOriginal')\n      },\n      on: {\n        input(value) {\n          defaultOptions.original = value;\n        }\n\n      }\n    })]), h('div', {\n      class: 'vxe-export--panel-option-row'\n    }, [h('vxe-checkbox', {\n      props: {\n        value: isHeader && hasColgroup && supportMerge ? defaultOptions.isColgroup : false,\n        disabled: !isHeader || !hasColgroup || !supportMerge,\n        title: GlobalConfig.i18n('vxe.export.expColgroupTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptColgroup')\n      },\n      on: {\n        input(value) {\n          defaultOptions.isColgroup = value;\n        }\n\n      }\n    }), h('vxe-checkbox', {\n      props: {\n        value: hasMerge && supportMerge && checkedAll ? defaultOptions.isMerge : false,\n        disabled: !hasMerge || !supportMerge || !checkedAll,\n        title: GlobalConfig.i18n('vxe.export.expMergeTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptMerge')\n      },\n      on: {\n        input(value) {\n          defaultOptions.isMerge = value;\n        }\n\n      }\n    }), isPrint ? _e() : h('vxe-checkbox', {\n      props: {\n        value: supportStyle ? defaultOptions.useStyle : false,\n        disabled: !supportStyle,\n        title: GlobalConfig.i18n('vxe.export.expUseStyleTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptUseStyle')\n      },\n      on: {\n        input(value) {\n          defaultOptions.useStyle = value;\n        }\n\n      }\n    }), h('vxe-checkbox', {\n      props: {\n        value: hasTree ? defaultOptions.isAllExpand : false,\n        disabled: !hasTree,\n        title: GlobalConfig.i18n('vxe.export.expAllExpandTitle'),\n        content: GlobalConfig.i18n('vxe.export.expOptAllExpand')\n      },\n      on: {\n        input(value) {\n          defaultOptions.isAllExpand = value;\n        }\n\n      }\n    })])])])]])]), h('div', {\n      class: 'vxe-export--panel-btns'\n    }, [h('vxe-button', {\n      props: {\n        content: GlobalConfig.i18n('vxe.export.expCancel')\n      },\n      on: {\n        click: this.cancelEvent\n      }\n    }), h('vxe-button', {\n      ref: 'confirmBtn',\n      props: {\n        status: 'primary',\n        content: GlobalConfig.i18n(isPrint ? 'vxe.export.expPrint' : 'vxe.export.expConfirm')\n      },\n      on: {\n        click: this.confirmEvent\n      }\n    })])])]);\n  },\n\n  methods: {\n    changeOption(column) {\n      const isChecked = !column.checked;\n      XEUtils.eachTree([column], item => {\n        item.checked = isChecked;\n        item.halfChecked = false;\n      });\n      this.handleOptionCheck(column);\n      this.checkStatus();\n    },\n\n    handleOptionCheck(column) {\n      const matchObj = XEUtils.findTree(this.storeData.columns, item => item === column);\n\n      if (matchObj && matchObj.parent) {\n        const parent = matchObj.parent;\n\n        if (parent.children && parent.children.length) {\n          parent.checked = parent.children.every(column => column.checked);\n          parent.halfChecked = !parent.checked && parent.children.some(column => column.checked || column.halfChecked);\n          this.handleOptionCheck(parent);\n        }\n      }\n    },\n\n    checkStatus() {\n      const columns = this.storeData.columns;\n      this.isAll = columns.every(column => column.disabled || column.checked);\n      this.isIndeterminate = !this.isAll && columns.some(column => !column.disabled && (column.checked || column.halfChecked));\n    },\n\n    allColumnEvent() {\n      const isAll = !this.isAll;\n      XEUtils.eachTree(this.storeData.columns, column => {\n        if (!column.disabled) {\n          column.checked = isAll;\n          column.halfChecked = false;\n        }\n      });\n      this.isAll = isAll;\n      this.checkStatus();\n    },\n\n    showEvent() {\n      this.$nextTick(() => {\n        const $refs = this.$refs;\n        const targetElem = $refs.filename || $refs.sheetname || $refs.confirmBtn;\n\n        if (targetElem) {\n          targetElem.focus();\n        }\n      });\n      this.checkStatus();\n    },\n\n    getExportOption() {\n      const checkedAll = this.checkedAll,\n            storeData = this.storeData,\n            defaultOptions = this.defaultOptions,\n            supportMerge = this.supportMerge;\n      const hasMerge = storeData.hasMerge,\n            columns = storeData.columns;\n      const expColumns = XEUtils.searchTree(columns, column => column.checked, {\n        children: 'children',\n        mapChildren: 'childNodes',\n        original: true\n      });\n      return Object.assign({}, defaultOptions, {\n        columns: expColumns,\n        isMerge: hasMerge && supportMerge && checkedAll ? defaultOptions.isMerge : false\n      });\n    },\n\n    cancelEvent() {\n      this.storeData.visible = false;\n    },\n\n    confirmEvent(evnt) {\n      if (this.storeData.isPrint) {\n        this.printEvent(evnt);\n      } else {\n        this.exportEvent(evnt);\n      }\n    },\n\n    printEvent() {\n      const $xetable = this.$parent;\n      this.storeData.visible = false;\n      $xetable.print(Object.assign({}, $xetable.printOpts, this.getExportOption()));\n    },\n\n    exportEvent() {\n      const $xetable = this.$parent;\n      this.loading = true;\n      $xetable.exportData(Object.assign({}, $xetable.exportOpts, this.getExportOption())).then(() => {\n        this.loading = false;\n        this.storeData.visible = false;\n      }).catch(() => {\n        this.loading = false;\n      });\n    }\n\n  }\n};",null]}