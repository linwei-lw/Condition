{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\main\\alarm\\RealTimeAlarm\\MediaViewingWindow.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\main\\alarm\\RealTimeAlarm\\MediaViewingWindow.vue","mtime":1673591787306},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getCars } from '@/common/cache/CacheTeamCar.js';\nimport { getAlarmType } from '@/common/cache/CacheAlarm.js';\nimport BinViewingWindow from \"./BinViewingWindow.vue\";\nimport _Labels from '@/common/gps/Labels.js';\nimport '@/components/ImgSwiper/swiper.css';\nexport default {\n  data: function data() {\n    return {\n      medias: {},\n      mediasList: [],\n      url: null,\n      o_url: null,\n      type: null,\n      callback: null,\n      waiting: false,\n      top: 0,\n      rotateTimes: 0,\n      imgMaxHeight: 800,\n      margin: 0,\n      isHide: false,\n      index: null\n    };\n  },\n  _car_map: null,\n  _alarm_map: null,\n  mySwiper: null,\n  created: function created() {\n    var _this = this;\n\n    getCars(function (cars) {\n      _this._car_map = cars.map;\n    });\n    getAlarmType(function (alarm) {\n      _this._alarm_map = alarm.map;\n    });\n    this.imgMaxHeight = document.body.clientHeight - 86 - 87;\n  },\n  computed: {\n    Labels: function Labels() {\n      return _Labels;\n    }\n  },\n  mounted: function mounted() {\n    if (this.type == '2') {\n      this.getVideoSrc();\n    }\n  },\n  methods: {\n    onBinDbclick: function onBinDbclick() {\n      $_popup.open(BinViewingWindow, {\n        data: this.url\n      });\n    },\n    videoError: function videoError(e) {\n      this.o_url = this.url;\n      this.createFlv();\n    },\n    getVideoSrc: function getVideoSrc() {\n      try {\n        this._video = this.$refs.video;\n        var that = this;\n\n        this._video.addEventListener(\"error\", that.videoError, false);\n      } catch (error) {}\n    },\n    createFlv: function createFlv() {\n      var _this2 = this;\n\n      $_main.http.post('/query/media?createFlv', {\n        media: this.medias\n      }).then(function (result) {\n        _this2.url = _this2.o_url.replace('.mp4', '.new.mp4').replace('.h264', '.new.mp4');\n        var that = _this2;\n\n        _this2._video.removeEventListener(\"error\", that.videoError, false);\n      });\n    },\n    swiperDisabled: function swiperDisabled(add) {\n      if (this.index + add < 0 || this.index + add == this.mediasList.length) {\n        return true;\n      }\n\n      return false;\n    },\n    nextClick: function nextClick(add) {\n      this.callback(this.index + add);\n      this.$refs.w.close();\n    },\n    mouseOver: function mouseOver() {\n      this.isHide = true;\n    },\n    mouseLeave: function mouseLeave() {\n      this.isHide = false;\n    },\n    plateFormatter: function plateFormatter(cellValue) {\n      cellValue = this._car_map[cellValue];\n      return cellValue ? cellValue.plate : '';\n    },\n    speedFormatter: function speedFormatter(cellValue) {\n      if (cellValue) {\n        return JSON.parse(cellValue).speed != null ? JSON.parse(cellValue).speed + 'km/h' : '';\n      }\n\n      return '';\n    },\n    reasonFormatter: function reasonFormatter(cellValue, row) {\n      var alarmType = !JSON.parse(cellValue).alarmType ? $_L.get('其他') : JSON.parse(cellValue).alarmType;\n\n      if (!this._alarm_map[alarmType]) {\n        alarmType = $_L.get('其他');\n      }\n\n      if (alarmType == $_L.get('其他')) {\n        if (row.event == \"0\") {\n          cellValue = $_L.get('平台下发指令');\n        } else if (row.event == \"1\") {\n          cellValue = $_L.get('定时动作');\n        } else if (row.event == \"2\") {\n          cellValue = $_L.get('抢劫报警触发');\n        } else if (row.event == \"3\") {\n          cellValue = $_L.get('碰撞侧翻报警触发');\n        } else if (row.event == \"4\") {\n          cellValue = $_L.get('开门拍照');\n        } else if (row.event == \"5\") {\n          cellValue = $_L.get('门关拍照');\n        } else if (row.event == \"6\") {\n          cellValue = $_L.get('车门由开变关，时速从小于20公里到超过20公里');\n        } else if (row.event == \"7\") {\n          cellValue = $_L.get('定距拍照');\n        } else if (row.event == \"9\") {\n          cellValue = $_L.get('终端自动');\n        } else if (row.event == \"100\") {\n          cellValue = $_L.get('人脸对比');\n        }\n      } else {\n        cellValue = this._alarm_map[alarmType].name;\n      }\n\n      return cellValue ? cellValue : '';\n    },\n    rollImg: function rollImg() {\n      /* 获取当前页面的缩放比\n          若未设置zoom缩放比，则为默认100%，即1，原图大小\n      */\n      var zoom = parseInt(this.$refs.img.style.zoom) || 100;\n      /* event.wheelDelta 获取滚轮滚动值并将滚动值叠加给缩放比zoom\n            wheelDelta统一为±120，其中正数表示为向上滚动，负数表示向下滚动\n        */\n\n      zoom += event.wheelDelta / 12;\n      /* 最小范围 和 最大范围 的图片缩放尺度 */\n\n      var top = parseInt(this.$el.style.top.replace('px', ''));\n\n      if (zoom >= 35 && zoom * this.$refs.img.height / 100 < this.imgMaxHeight - top) {\n        this.$refs.img.style.zoom = zoom + \"%\";\n      }\n\n      return false;\n    },\n    getTypeName: function getTypeName(type) {\n      if (type == 0) {\n        return $_L.get('照片');\n      } else if (type == 1) {\n        return $_L.get('音频');\n      } else if (type == 2) {\n        return $_L.get('视频');\n      } else if (type == 3) {\n        return $_L.get('文件');\n      } else {\n        return $_L.get('其他');\n      }\n    },\n    isImg: function isImg(type) {\n      if (type == 0) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    copyUrl: function copyUrl() {\n      var Url2 = this.url;\n      var oInput = document.createElement('input');\n      oInput.value = Url2;\n      document.body.appendChild(oInput);\n      oInput.select(); // 选择对象\n\n      document.execCommand(\"Copy\"); // 执行浏览器复制命令\n\n      oInput.className = 'oInput';\n      oInput.style.display = 'none';\n    },\n    onRotateClick: function onRotateClick(type) {\n      this.copyUrl();\n      var img = document.getElementById(\"img\");\n      var content = document.getElementById(\"content\");\n\n      if (type == \"right\") {\n        this.rotateTimes++;\n      } else if (type == \"left\") {\n        this.rotateTimes--;\n      } else {\n        this.rotateTimes = 0;\n        this.$refs.img.style.zoom = \"100%\";\n      }\n\n      img.style.webkitTransform = 'rotate(' + 90 * this.rotateTimes + 'deg)';\n      img.style.mozTransform = 'rotate(' + 90 * this.rotateTimes + 'deg)';\n      img.style.msTransform = 'rotate(' + 90 * this.rotateTimes + 'deg)';\n      img.style.oTransform = 'rotate(' + 90 * this.rotateTimes + 'deg)';\n      img.style.transform = 'rotate(' + 90 * this.rotateTimes + 'deg)';\n\n      if (this.rotateTimes % 2 != 0) {\n        this.margin = (img.clientWidth - img.clientHeight) / 2;\n        this.top = parseInt(this.$el.style.top.replace('px', ''));\n      } else {\n        this.margin = 0;\n      }\n    },\n    onDownload: function onDownload() {\n      var original = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var url = original ? this.url : this.o_url;\n      var suffix = this.type == '2' && this.o_url && original ? 'new.mp4' : url.split(\"refPath=\")[1].split(\".\")[1];\n      var time = this.medias.time.replace(\" \", \"_\").replace(new RegExp(\":\", \"gm\"), \"\") + \".\" + suffix;\n      var fileName = this.plateFormatter(this.medias.carId) + \"_\" + time;\n      var xhr = new XMLHttpRequest();\n      xhr.responseType = \"blob\"; // 返回类型blob\n\n      xhr.open('get', url, true);\n      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); // 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑\n\n      var that = this;\n\n      xhr.onload = function () {\n        // 请求完成\n        if (this.status === 200) {\n          // 返回200\n          var blob = this.response;\n          var reader = new FileReader();\n          reader.readAsDataURL(blob); // 转换为base64\n\n          reader.onload = function (e) {\n            // 转换完成，创建一个a标签用于下载\n            var a = document.createElement('a');\n            a.download = fileName;\n            a.href = e.target.result;\n            $(\"body\").append(a); // 修复firefox中无法触发click\n\n            a.click();\n            $(a).remove();\n            that.waiting = false;\n          };\n        } else {\n          $_alert.error($_L.get('下载失败！'));\n        }\n      }; // 发送ajax请求\n\n\n      xhr.send();\n    }\n  }\n};",{"version":3,"sources":["MediaViewingWindow.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Window :title=\"$_L.get(getTypeName(type)+'查看'+' '+'（当前第'+(index+1)+'张/共'+mediasList.length+'张）')\" ref=\"w\" :waiting=\"waiting\" style=\"min-width:500px;\" id=\"w\">\n    <div :class=\"$style.content\" ref=\"content\" id=\"content\" @mousewheel=\"isImg(type)&&rollImg()\" :style=\"'max-height:'+(imgMaxHeight-top)+'px;'\" :title=\"url\" @mouseover=\"mouseOver\" @mouseleave=\"mouseLeave\">\n      <img :src=\"url\" v-if=\"isImg(type)\" :class=\"$style.img\" ref=\"img\" id=\"img\" :style=\"'max-height:'+imgMaxHeight+'px;margin:'+margin+'px '+(-margin)+'px'\" >\n      <video :src=\"url\" v-if=\"type=='2'\" controls autoplay width=\"750\" height=\"450\" style=\"object-fit:fill;\" ref=\"video\"></video>\n      <audio :src=\"url\"  v-if=\"type=='1'\" controls=\"controls\" autoplay>{{$_L.get('您的浏览器不支持 audio 标签。')}}</audio>\n      <img src=\"@/assets/icon/file.png\" v-if=\"type == '3'\" @dblclick.stop=\"onBinDbclick()\" style=\"cursor: pointer;\">\n      <img src=\"@/assets/icon/file2.png\" v-if=\"type == '4'\" style=\"width: 100px;\">\n      <div class=\"swiper-button-next\" v-if=\"index||mediasList.length > 0\" v-show=\"isHide\" :class=\"swiperDisabled(1)&&'swiper-button-disabled'\" @click=\"nextClick(1)\" :disabled=\"swiperDisabled(1)\"></div>\n      <div class=\"swiper-button-prev\" v-if=\"index||mediasList.length > 0\" v-show=\"isHide\" :class=\"swiperDisabled(-1)&&'swiper-button-disabled'\" @click=\"nextClick(-1)\" :disabled=\"swiperDisabled(-1)\"></div>\n    </div>\n    <div :class=\"$style.details\" ref=\"details\" @mousewheel=\"isImg(type)&&rollImg()\">\n      <table :class=\"$style.table\">\n        <tr>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\">{{$_L.get('车牌')}}</td><td :style=\"{borderColor:theme.border_color_light}\">{{plateFormatter(medias.carId)}}</td>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\">{{$_L.get('时间')}}</td><td :style=\"{borderColor:theme.border_color_light}\">{{medias.time}}</td>\n        </tr>\n        <tr>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\">{{$_L.get('原因')}}</td><td :style=\"{borderColor:theme.border_color_light}\">{{reasonFormatter(medias.exts, medias)}}</td>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\">{{$_L.get('通道')}}</td><td :style=\"{borderColor:theme.border_color_light}\">{{medias.channel}}</td>\n        </tr>\n        <tr>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\">{{$_L.get('企业')}}</td><td :colspan=\"medias.event === '0'?'1':'3'\" :style=\"{borderColor:theme.border_color_light}\">{{Labels.teamNameByCarId(medias)}}</td>\n          <td :class=\"$style.tableName\" v-if=\"medias.event === '0'\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\" style=\"border-bottom:none;\">{{$_L.get('速度')}}</td><td :style=\"{borderColor:theme.border_color_light}\" style=\"border-bottom:none;\" v-if=\"medias.event === '0'\">{{speedFormatter(medias.exts)}}</td>\n        </tr>\n        <tr>\n          <td :class=\"$style.tableName\" :style=\"{borderColor:theme.border_color_light, background:theme.bg_color}\" style=\"border-bottom:none;\">{{$_L.get('位置')}}</td><td colspan=\"3\" :style=\"{borderColor:theme.border_color_light}\" style=\"border-bottom:none;\">{{medias.addr}}</td>\n        </tr>\n      </table>\n    </div>\n    <template slot=\"footer\">\n      <div style=\"height: 50px;\">\n        <Button style=\"margin:8px 0px 8px 4px;width:80px;border-right:1px solid #fff;\" type=\"primary\"  v-if=\"type=='0'\" icon=\"el-icon-refresh-left\" @click=\"onRotateClick('left')\"> {{$_L.get('左旋')}} </Button>\n        <Button style=\"margin:8px 0px;width:80px;border-right:1px solid #fff;\" type=\"primary\"  v-if=\"type=='0'\" icon=\"el-icon-refresh-right\" @click=\"onRotateClick('right')\"> {{$_L.get('右旋')}} </Button>\n        <Button style=\"margin:8px -4px 8px 0px;width:80px;border-right:1px solid #fff;\" type=\"primary\"  v-if=\"type=='0'\" icon=\"el-icon-c-scale-to-original\" @click=\"onRotateClick('reduction')\"> {{$_L.get('还原')}} </Button>\n        <Button style=\"margin:8px 4px;width:80px;\" type=\"primary\" @click=\"onDownload()\" icon=\"el-icon-download\" > {{$_L.get('保存')}} </Button>\n        <Button style=\"margin:8px 4px;\" type=\"primary\" @click=\"onDownload(false)\" icon=\"el-icon-download\" v-if=\"type=='2'&&o_url\"> {{$_L.get('原文件保存')}} </Button>\n        <Button style=\"margin:8px 4px;width:80px;\" @click=\"$refs.w.close()\"> {{$_L.get('关闭')}} </Button>\n      </div>\n    </template>\n  </Window>\n</template>\n\n<script>\n  import { getCars } from '@/common/cache/CacheTeamCar.js';\n  import { getAlarmType }  from '@/common/cache/CacheAlarm.js';\n  import BinViewingWindow from './BinViewingWindow.vue';\n  import Labels from '@/common/gps/Labels.js';\n\n  import '@/components/ImgSwiper/swiper.css';\n\n\n  export default {\n    data: function() {\n      return {\n        medias: {},\n        mediasList: [],\n        url: null,\n        o_url: null,\n        type: null,\n        callback: null,\n        waiting: false,\n        top: 0,\n        rotateTimes: 0,\n        imgMaxHeight: 800,\n        margin: 0,\n        isHide: false,\n        index: null,\n      };\n    },\n    _car_map: null,\n    _alarm_map: null,\n    mySwiper: null,\n    created() {\n      getCars(cars =>{\n        this._car_map = cars.map;\n      });\n      getAlarmType(alarm =>{\n        this._alarm_map = alarm.map;\n      });\n      this.imgMaxHeight = document.body.clientHeight - 86 - 87;\n    },\n    computed: {\n      Labels: () => Labels,\n    },\n    mounted() {\n      if(this.type == '2'){\n        this.getVideoSrc();\n      }\n    },\n    methods: {\n      onBinDbclick(){\n        $_popup.open(BinViewingWindow, {data: this.url});\n      },\n      videoError(e){\n        this.o_url = this.url;\n        this.createFlv();\n      },\n      getVideoSrc(){\n        try {\n          this._video = this.$refs.video;\n          let that = this;\n          this._video.addEventListener(\"error\",that.videoError,false);\n        } catch (error) {\n\n        }\n      },\n      createFlv(){\n        $_main.http.post('/query/media?createFlv',{media: this.medias}).then(result => {\n          this.url = this.o_url.replace('.mp4','.new.mp4').replace('.h264','.new.mp4');\n          let that = this;\n          this._video.removeEventListener(\"error\",that.videoError,false);\n        });\n      },\n      swiperDisabled(add){\n        if((this.index + add)<0||(this.index + add)==(this.mediasList.length)){\n          return true;\n        }\n        return false;\n      },\n      nextClick(add){\n        this.callback(this.index+add);\n        this.$refs.w.close();\n      },\n      mouseOver(){\n        this.isHide = true;\n      },\n      mouseLeave(){\n        this.isHide = false;\n      },\n      plateFormatter ( cellValue ) {\n        cellValue = this._car_map[cellValue];\n        return cellValue ? cellValue.plate : '';\n      },\n      speedFormatter (cellValue){\n        if(cellValue){\n          return JSON.parse(cellValue).speed!=null ? JSON.parse(cellValue).speed+'km/h' : '';\n        }\n        return '';\n      },\n      reasonFormatter ( cellValue, row ) {\n        let alarmType = !JSON.parse(cellValue).alarmType ? $_L.get('其他') : JSON.parse(cellValue).alarmType;\n        if(!this._alarm_map[alarmType]){\n          alarmType = $_L.get('其他');\n        }\n        if(alarmType == $_L.get('其他')){\n          if(row.event == \"0\"){\n            cellValue = $_L.get('平台下发指令');\n          }else if(row.event == \"1\"){\n            cellValue = $_L.get('定时动作');\n          }else if(row.event == \"2\"){\n            cellValue = $_L.get('抢劫报警触发');\n          }else if(row.event == \"3\"){\n            cellValue = $_L.get('碰撞侧翻报警触发');\n          }else if(row.event == \"4\"){\n            cellValue = $_L.get('开门拍照');\n          }else if(row.event == \"5\"){\n            cellValue = $_L.get('门关拍照');\n          }else if(row.event == \"6\"){\n            cellValue = $_L.get('车门由开变关，时速从小于20公里到超过20公里');\n          }else if(row.event == \"7\"){\n            cellValue = $_L.get('定距拍照');\n          }else if(row.event == \"9\"){\n            cellValue = $_L.get('终端自动');\n          }else if(row.event == \"100\"){\n            cellValue = $_L.get('人脸对比');\n          }\n        }else{\n          cellValue = this._alarm_map[alarmType].name;\n        }\n        return cellValue ? cellValue : '';\n      },\n      rollImg(){\n        /* 获取当前页面的缩放比\n            若未设置zoom缩放比，则为默认100%，即1，原图大小\n        */\n        var zoom = parseInt(this.$refs.img.style.zoom) || 100;\n        /* event.wheelDelta 获取滚轮滚动值并将滚动值叠加给缩放比zoom\n              wheelDelta统一为±120，其中正数表示为向上滚动，负数表示向下滚动\n          */\n        zoom += event.wheelDelta / 12;\n        /* 最小范围 和 最大范围 的图片缩放尺度 */\n        let top = parseInt(this.$el.style.top.replace('px',''));\n        if (zoom >= 35 && zoom*this.$refs.img.height/100 < (this.imgMaxHeight-top)) {\n          this.$refs.img.style.zoom = zoom + \"%\";\n        }\n      return false;\n \n      },\n      getTypeName(type){\n        if(type == 0){\n          return $_L.get('照片');\n        }else if(type == 1){\n          return $_L.get('音频');\n        }else if(type == 2){\n          return $_L.get('视频');\n        }else if(type == 3){\n          return $_L.get('文件');\n        }else{\n          return $_L.get('其他');\n        }\n      },\n      isImg(type){\n        if(type == 0){\n          return true;\n        }else{\n          return false;\n        }\n      },\n      copyUrl(){\n        var Url2=this.url;\n        var oInput = document.createElement('input');\n        oInput.value = Url2;\n        document.body.appendChild(oInput);\n        oInput.select(); // 选择对象\n        document.execCommand(\"Copy\"); // 执行浏览器复制命令\n        oInput.className = 'oInput';\n        oInput.style.display='none';\n      },\n      onRotateClick(type){\n        this.copyUrl();\n        var img = document.getElementById(\"img\");\n        var content = document.getElementById(\"content\");\n        if(type == \"right\"){\n          this.rotateTimes ++;\n        }else if(type == \"left\"){\n          this.rotateTimes --;\n        }else{\n          this.rotateTimes = 0;\n          this.$refs.img.style.zoom = \"100%\";\n        }\n        img.style.webkitTransform = 'rotate('+90*this.rotateTimes+'deg)';\n        img.style.mozTransform = 'rotate('+90*this.rotateTimes+'deg)';\n        img.style.msTransform = 'rotate('+90*this.rotateTimes+'deg)';\n        img.style.oTransform = 'rotate('+90*this.rotateTimes+'deg)';\n        img.style.transform = 'rotate('+90*this.rotateTimes+'deg)';\n        if(this.rotateTimes % 2 != 0){\n          this.margin = (img.clientWidth-img.clientHeight)/2;\n          this.top = parseInt(this.$el.style.top.replace('px',''));\n        }else{\n          this.margin = 0;\n        }\n      },\n      onDownload(original = true){\n        let url = original ? this.url : this.o_url;\n        let suffix = (this.type == '2'&&this.o_url&&original)? 'new.mp4' : url.split(\"refPath=\")[1].split(\".\")[1];\n        let time = this.medias.time.replace(\" \",\"_\").replace(new RegExp(\":\",(\"gm\")),\"\") + \".\" +suffix;\n        let fileName = this.plateFormatter(this.medias.carId) + \"_\" + time ;\n        var xhr = new XMLHttpRequest();\n        xhr.responseType = \"blob\";  // 返回类型blob\n        xhr.open('get', url, true);\n        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n        // 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑\n        var that = this;\n        xhr.onload = function () {\n          // 请求完成\n          if (this.status === 200) {\n            // 返回200\n            var blob = this.response;\n            var reader = new FileReader();\n            reader.readAsDataURL(blob);  // 转换为base64\n            reader.onload = function (e) {\n              // 转换完成，创建一个a标签用于下载\n              var a = document.createElement('a');\n              a.download = fileName;\n              a.href = e.target.result;\n              $(\"body\").append(a);  // 修复firefox中无法触发click\n              a.click();\n              $(a).remove();\n              that.waiting = false;\n            }\n          }else{\n            $_alert.error($_L.get('下载失败！'));\n          }\n        };\n        // 发送ajax请求\n        xhr.send();\n      },  \n    }\n  };\n</script>\n<style module>\n  .content {\n    width: 100%;\n    height: 100%;\n    min-height: 300px;\n    text-align: center;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n    position: relative;\n  }\n  .img{\n    margin: auto;\n    position: relative;\n  }\n  .details{\n    position: relative;\n    bottom: 1px;\n    width: 100%;\n    text-align: left;\n    float: left;\n  }\n  .table{\n    width: 100%;\n    height: 87px;\n    border-collapse: collapse;\n    table-layout: inherit;\n    margin-bottom: -1px;\n    min-width: 500px;\n  }\n  .table td{\n    border: 1px solid;\n    padding: 5px 10px;\n  }\n  .tableName{\n    width: 50px;\n    text-align: center;\n    border-right: none;\n  }\n</style>"],"sourceRoot":"src/main/alarm/RealTimeAlarm"}]}