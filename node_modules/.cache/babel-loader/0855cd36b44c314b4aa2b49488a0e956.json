{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue","mtime":1685000036289},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport AiAddOrUpdateWindow from \"./AiAddOrUpdateWindow.vue\";\nimport DirAddOrUpdateWindow from \"./DirAddOrUpdateWindow.vue\";\nimport { arrayRemoveItem } from '@/common/util/Arrays.js';\nimport { arrayToMap } from '@/common/util/Arrays.js';\nimport { objClone, objCopyTo } from '@/common/util/Objects.js';\nexport default {\n  data: function data() {\n    return {\n      areas: [{\n        name: '黑龙江省'\n      }, {\n        name: '辽宁省'\n      }, {\n        name: '吉林省'\n      }, {\n        name: '河北省'\n      }, {\n        name: '河南省'\n      }, {\n        name: '湖北省'\n      }, {\n        name: '湖南省'\n      }, {\n        name: '山东省'\n      }, {\n        name: '山西省'\n      }, {\n        name: '陕西省'\n      }, {\n        name: '安徽省'\n      }, {\n        name: '浙江省'\n      }, {\n        name: '江苏省'\n      }, {\n        name: '福建省'\n      }, {\n        name: '广东省'\n      }, {\n        name: '海南省'\n      }, {\n        name: '四川省'\n      }, {\n        name: '云南省'\n      }, {\n        name: '贵州省'\n      }, {\n        name: '青海省'\n      }, {\n        name: '甘肃省'\n      }, {\n        name: '江西省'\n      }, {\n        name: '台湾省'\n      }, {\n        name: '内蒙古自治区'\n      }, {\n        name: '宁夏回族自治区'\n      }, {\n        name: '新疆维吾尔自治区'\n      }, {\n        name: '西藏自治区'\n      }, {\n        name: '广西壮族自治区'\n      }, {\n        name: '北京市'\n      }, {\n        name: '上海市'\n      }, {\n        name: '天津市'\n      }, {\n        name: '重庆市'\n      }, {\n        name: '香港特别行政区'\n      }, {\n        name: '澳门特别行政区'\n      }],\n      datas: [],\n      list: [],\n      place: [],\n      cmpIndex: {\n        id: null\n      },\n      selected: null,\n      selectedItem: null,\n      index: 0\n    };\n  },\n  created: function created() {},\n  mounted: function mounted() {\n    var _this = this;\n\n    $_main.http.get('rule/get', {\n      sessionId: $_main.sessionId,\n      userId: $_main.userId\n    }).then(function (result) {\n      _this.list = result;\n    });\n    this.getPlace();\n  },\n  methods: {\n    getPlace: function getPlace() {\n      var _this2 = this;\n\n      $_main.http.get('place/get', {\n        sessionId: $_main.sessionId,\n        userId: $_main.userId\n      }).then(function (result) {\n        var areas = _this2.areas.filter(function (el) {\n          return result.some(function (item) {\n            return item.area == el.name;\n          });\n        }) || [],\n            place = [];\n        areas.forEach(function (el) {\n          el.isopen = false;\n          el.children = [];\n          result.forEach(function (item) {\n            if (el.name == item.area) {\n              el.children.push(item);\n            }\n          });\n          place.push(el);\n        });\n        _this2.place = place;\n      });\n    },\n    addClick: function addClick() {\n      var item = {\n        name: null,\n        cars: [],\n        area: this.cmpIndex.area,\n        des: null,\n        regions: [],\n        auser: $_main.userId,\n        placeId: this.cmpIndex.id\n      };\n      $_popup.open(AiAddOrUpdateWindow, {\n        item: item,\n        callback: this.addOrUpdateCallback\n      });\n    },\n    updClick: function updClick() {\n      $_popup.open(AiAddOrUpdateWindow, {\n        item: objClone(this.selectedItem),\n        callback: this.addOrUpdateCallback\n      });\n    },\n    addOrUpdateCallback: function addOrUpdateCallback(result, isddd) {\n      if (isddd) {\n        this.datas.push(result);\n        this.list.push(result);\n      } else {\n        objCopyTo(result, this.selectedItem);\n      }\n    },\n    delClick: function delClick() {\n      var _this3 = this;\n\n      $_alert.comfirm($_L.get('你确定要删除吗？'), function (yes) {\n        if (!yes) return;\n        $_main.http.get('rule/delete', {\n          id: _this3.selectedItem.id\n        }).then(function (e) {\n          arrayRemoveItem(_this3.datas, _this3.selectedItem);\n          arrayRemoveItem(_this3.list, _this3.selectedItem);\n          _this3.selectedItem = null;\n          $_alert.success($_L.get('删除成功'));\n        });\n      }, this.$el);\n    },\n    addDirClick: function addDirClick() {\n      $_popup.open(DirAddOrUpdateWindow, {\n        areas: this.areas,\n        callback: this.addOrUpdateDirCallback\n      });\n    },\n    updDirClick: function updDirClick() {\n      $_popup.open(DirAddOrUpdateWindow, {\n        areas: this.areas,\n        item: objClone(this.selected),\n        callback: this.addOrUpdateDirCallback\n      });\n    },\n    addOrUpdateDirCallback: function addOrUpdateDirCallback(result, isddd) {\n      if (isddd) {\n        var place = arrayToMap(this.place, 'name');\n\n        if (place[result.area]) {\n          place[result.area].children.push(result);\n          this.$forceUpdate();\n        } else {\n          this.place.push({\n            name: result.area,\n            isopen: false,\n            children: [result]\n          });\n        }\n      } else {\n        objCopyTo(result, this.selected);\n      }\n    },\n    delDirClick: function delDirClick() {\n      var _this4 = this;\n\n      if (this.datas && this.datas.length != 0) return $_alert.warn($_L.get('该场地下有工况，请先删除工况？'));\n      $_alert.comfirm($_L.get('你确定要删除吗？'), function (yes) {\n        if (!yes) return;\n        $_main.http.get('place/delete', {\n          id: _this4.selected.id\n        }).then(function (e) {\n          var obj;\n\n          _this4.place.forEach(function (el) {\n            if (el.name == _this4.selected.area) {\n              arrayRemoveItem(el.children, _this4.selected);\n\n              if (el.children == 0) {\n                obj = el;\n              }\n            }\n          });\n\n          if (obj) {\n            arrayRemoveItem(_this4.place, obj);\n          }\n\n          _this4.selected = null;\n          _this4.cmpIndex = {\n            id: null\n          };\n          $_alert.success($_L.get('删除成功'));\n        });\n      }, this.$el);\n    },\n    click: function click(item) {\n      this.index++;\n\n      if (!item.children) {\n        this.cmpIndex = item;\n        this.datas = this.list.filter(function (el) {\n          return el.placeId == item.id;\n        });\n      } else {\n        item.isopen = !item.isopen;\n      }\n\n      this.$forceUpdate();\n      this.selected = item;\n    }\n  }\n};",{"version":3,"sources":["CdRuleModule.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA,OAAA,mBAAA;AACA,OAAA,oBAAA;AACA,SAAA,eAAA,QAAA,yBAAA;AACA,SAAA,UAAA,QAAA,yBAAA;AACA,SAAA,QAAA,EAAA,SAAA,QAAA,0BAAA;AAEA,eAAA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,KAAA,EAAA,CAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EACA;AAAA,QAAA,IAAA,EAAA;AAAA,OADA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAEA;AAAA,QAAA,IAAA,EAAA;AAAA,OAFA,EAGA;AAAA,QAAA,IAAA,EAAA;AAAA,OAHA,EAGA;AAAA,QAAA,IAAA,EAAA;AAAA,OAHA,EAGA;AAAA,QAAA,IAAA,EAAA;AAAA,OAHA,EAGA;AAAA,QAAA,IAAA,EAAA;AAAA,OAHA,EAGA;AAAA,QAAA,IAAA,EAAA;AAAA,OAHA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,EAIA;AAAA,QAAA,IAAA,EAAA;AAAA,OAJA,CADA;AAMA,MAAA,KAAA,EAAA,EANA;AAOA,MAAA,IAAA,EAAA,EAPA;AAQA,MAAA,KAAA,EAAA,EARA;AASA,MAAA,QAAA,EAAA;AAAA,QAAA,EAAA,EAAA;AAAA,OATA;AAUA,MAAA,QAAA,EAAA,IAVA;AAWA,MAAA,YAAA,EAAA,IAXA;AAYA,MAAA,KAAA,EAAA;AAZA,KAAA;AAcA,GAhBA;AAkBA,EAAA,OAlBA,qBAkBA,CACA,CAnBA;AAoBA,EAAA,OApBA,qBAoBA;AAAA;;AACA,IAAA,MAAA,CAAA,IAAA,CAAA,GAAA,CAAA,UAAA,EAAA;AAAA,MAAA,SAAA,EAAA,MAAA,CAAA,SAAA;AAAA,MAAA,MAAA,EAAA,MAAA,CAAA;AAAA,KAAA,EAAA,IAAA,CAAA,UAAA,MAAA,EAAA;AACA,MAAA,KAAA,CAAA,IAAA,GAAA,MAAA;AACA,KAFA;AAGA,SAAA,QAAA;AACA,GAzBA;AA0BA,EAAA,OAAA,EAAA;AACA,IAAA,QADA,sBACA;AAAA;;AACA,MAAA,MAAA,CAAA,IAAA,CAAA,GAAA,CAAA,WAAA,EAAA;AAAA,QAAA,SAAA,EAAA,MAAA,CAAA,SAAA;AAAA,QAAA,MAAA,EAAA,MAAA,CAAA;AAAA,OAAA,EAAA,IAAA,CAAA,UAAA,MAAA,EAAA;AACA,YAAA,KAAA,GAAA,MAAA,CAAA,KAAA,CAAA,MAAA,CAAA,UAAA,EAAA;AAAA,iBAAA,MAAA,CAAA,IAAA,CAAA,UAAA,IAAA;AAAA,mBAAA,IAAA,CAAA,IAAA,IAAA,EAAA,CAAA,IAAA;AAAA,WAAA,CAAA;AAAA,SAAA,KAAA,EAAA;AAAA,YAAA,KAAA,GAAA,EAAA;AACA,QAAA,KAAA,CAAA,OAAA,CAAA,UAAA,EAAA,EAAA;AACA,UAAA,EAAA,CAAA,MAAA,GAAA,KAAA;AACA,UAAA,EAAA,CAAA,QAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA;AACA,gBAAA,EAAA,CAAA,IAAA,IAAA,IAAA,CAAA,IAAA,EAAA;AACA,cAAA,EAAA,CAAA,QAAA,CAAA,IAAA,CAAA,IAAA;AACA;AACA,WAJA;AAKA,UAAA,KAAA,CAAA,IAAA,CAAA,EAAA;AACA,SATA;AAUA,QAAA,MAAA,CAAA,KAAA,GAAA,KAAA;AACA,OAbA;AAcA,KAhBA;AAkBA,IAAA,QAlBA,sBAkBA;AACA,UAAA,IAAA,GAAA;AAAA,QAAA,IAAA,EAAA,IAAA;AAAA,QAAA,IAAA,EAAA,EAAA;AAAA,QAAA,IAAA,EAAA,KAAA,QAAA,CAAA,IAAA;AAAA,QAAA,GAAA,EAAA,IAAA;AAAA,QAAA,OAAA,EAAA,EAAA;AAAA,QAAA,KAAA,EAAA,MAAA,CAAA,MAAA;AAAA,QAAA,OAAA,EAAA,KAAA,QAAA,CAAA;AAAA,OAAA;AACA,MAAA,OAAA,CAAA,IAAA,CAAA,mBAAA,EAAA;AAAA,QAAA,IAAA,EAAA,IAAA;AAAA,QAAA,QAAA,EAAA,KAAA;AAAA,OAAA;AACA,KArBA;AAsBA,IAAA,QAtBA,sBAsBA;AACA,MAAA,OAAA,CAAA,IAAA,CAAA,mBAAA,EAAA;AAAA,QAAA,IAAA,EAAA,QAAA,CAAA,KAAA,YAAA,CAAA;AAAA,QAAA,QAAA,EAAA,KAAA;AAAA,OAAA;AACA,KAxBA;AAyBA,IAAA,mBAzBA,+BAyBA,MAzBA,EAyBA,KAzBA,EAyBA;AACA,UAAA,KAAA,EAAA;AACA,aAAA,KAAA,CAAA,IAAA,CAAA,MAAA;AACA,aAAA,IAAA,CAAA,IAAA,CAAA,MAAA;AACA,OAHA,MAGA;AACA,QAAA,SAAA,CAAA,MAAA,EAAA,KAAA,YAAA,CAAA;AACA;AACA,KAhCA;AAiCA,IAAA,QAjCA,sBAiCA;AAAA;;AACA,MAAA,OAAA,CAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA,UAAA,CAAA,EAAA,UAAA,GAAA,EAAA;AACA,YAAA,CAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,GAAA,CAAA,aAAA,EAAA;AAAA,UAAA,EAAA,EAAA,MAAA,CAAA,YAAA,CAAA;AAAA,SAAA,EAAA,IAAA,CAAA,UAAA,CAAA,EAAA;AACA,UAAA,eAAA,CAAA,MAAA,CAAA,KAAA,EAAA,MAAA,CAAA,YAAA,CAAA;AACA,UAAA,eAAA,CAAA,MAAA,CAAA,IAAA,EAAA,MAAA,CAAA,YAAA,CAAA;AACA,UAAA,MAAA,CAAA,YAAA,GAAA,IAAA;AACA,UAAA,OAAA,CAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA,MAAA,CAAA;AACA,SALA;AAMA,OARA,EAQA,KAAA,GARA;AASA,KA3CA;AA4CA,IAAA,WA5CA,yBA4CA;AACA,MAAA,OAAA,CAAA,IAAA,CAAA,oBAAA,EAAA;AAAA,QAAA,KAAA,EAAA,KAAA,KAAA;AAAA,QAAA,QAAA,EAAA,KAAA;AAAA,OAAA;AACA,KA9CA;AA+CA,IAAA,WA/CA,yBA+CA;AACA,MAAA,OAAA,CAAA,IAAA,CAAA,oBAAA,EAAA;AAAA,QAAA,KAAA,EAAA,KAAA,KAAA;AAAA,QAAA,IAAA,EAAA,QAAA,CAAA,KAAA,QAAA,CAAA;AAAA,QAAA,QAAA,EAAA,KAAA;AAAA,OAAA;AACA,KAjDA;AAkDA,IAAA,sBAlDA,kCAkDA,MAlDA,EAkDA,KAlDA,EAkDA;AACA,UAAA,KAAA,EAAA;AACA,YAAA,KAAA,GAAA,UAAA,CAAA,KAAA,KAAA,EAAA,MAAA,CAAA;;AACA,YAAA,KAAA,CAAA,MAAA,CAAA,IAAA,CAAA,EAAA;AACA,UAAA,KAAA,CAAA,MAAA,CAAA,IAAA,CAAA,CAAA,QAAA,CAAA,IAAA,CAAA,MAAA;AACA,eAAA,YAAA;AACA,SAHA,MAGA;AACA,eAAA,KAAA,CAAA,IAAA,CAAA;AAAA,YAAA,IAAA,EAAA,MAAA,CAAA,IAAA;AAAA,YAAA,MAAA,EAAA,KAAA;AAAA,YAAA,QAAA,EAAA,CAAA,MAAA;AAAA,WAAA;AACA;AACA,OARA,MAQA;AACA,QAAA,SAAA,CAAA,MAAA,EAAA,KAAA,QAAA,CAAA;AACA;AACA,KA9DA;AA+DA,IAAA,WA/DA,yBA+DA;AAAA;;AACA,UAAA,KAAA,KAAA,IAAA,KAAA,KAAA,CAAA,MAAA,IAAA,CAAA,EAAA,OAAA,OAAA,CAAA,IAAA,CAAA,GAAA,CAAA,GAAA,CAAA,iBAAA,CAAA,CAAA;AACA,MAAA,OAAA,CAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA,UAAA,CAAA,EAAA,UAAA,GAAA,EAAA;AACA,YAAA,CAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,GAAA,CAAA,cAAA,EAAA;AAAA,UAAA,EAAA,EAAA,MAAA,CAAA,QAAA,CAAA;AAAA,SAAA,EAAA,IAAA,CAAA,UAAA,CAAA,EAAA;AACA,cAAA,GAAA;;AACA,UAAA,MAAA,CAAA,KAAA,CAAA,OAAA,CAAA,UAAA,EAAA,EAAA;AACA,gBAAA,EAAA,CAAA,IAAA,IAAA,MAAA,CAAA,QAAA,CAAA,IAAA,EAAA;AACA,cAAA,eAAA,CAAA,EAAA,CAAA,QAAA,EAAA,MAAA,CAAA,QAAA,CAAA;;AACA,kBAAA,EAAA,CAAA,QAAA,IAAA,CAAA,EAAA;AAAA,gBAAA,GAAA,GAAA,EAAA;AAAA;AACA;AACA,WALA;;AAMA,cAAA,GAAA,EAAA;AAAA,YAAA,eAAA,CAAA,MAAA,CAAA,KAAA,EAAA,GAAA,CAAA;AAAA;;AACA,UAAA,MAAA,CAAA,QAAA,GAAA,IAAA;AACA,UAAA,MAAA,CAAA,QAAA,GAAA;AAAA,YAAA,EAAA,EAAA;AAAA,WAAA;AACA,UAAA,OAAA,CAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA,MAAA,CAAA;AACA,SAZA;AAaA,OAfA,EAeA,KAAA,GAfA;AAgBA,KAjFA;AAkFA,IAAA,KAlFA,iBAkFA,IAlFA,EAkFA;AACA,WAAA,KAAA;;AACA,UAAA,CAAA,IAAA,CAAA,QAAA,EAAA;AACA,aAAA,QAAA,GAAA,IAAA;AACA,aAAA,KAAA,GAAA,KAAA,IAAA,CAAA,MAAA,CAAA,UAAA,EAAA;AAAA,iBAAA,EAAA,CAAA,OAAA,IAAA,IAAA,CAAA,EAAA;AAAA,SAAA,CAAA;AACA,OAHA,MAGA;AACA,QAAA,IAAA,CAAA,MAAA,GAAA,CAAA,IAAA,CAAA,MAAA;AAEA;;AACA,WAAA,YAAA;AACA,WAAA,QAAA,GAAA,IAAA;AACA;AA7FA;AA1BA,CAAA","sourcesContent":["<template>\r\n  <div :class=\"$style.container\">\r\n    <div style=\"width:20%;border:1px solid #AEBAC5;background:#fff;\">\r\n      <Button style=\"width:100%\" type=\"primary\" >{{$_L.get('场地')}}</Button>\r\n      <div style=\"height:calc(100% - 74px);overflow: auto;width: 100%;background-color: #fff;\">\r\n        <ul :class=\"$style.left_ul\" >\r\n          <li v-for=\"(item,index) in place\" :key=\"index\" >\r\n            <div :style=\"!item.children&&cmpIndex.id==item.id&&{backgroundColor:theme.selected_color}\" style=\"margin:0\" @click=\"click(item)\" >\r\n              <span :class=\"!item.children&&cmpIndex.id==item.id&&$style.indexbgc\" :style=\"{backgroundColor:theme.color}\"></span>\r\n             {{item.name}}\r\n              <img :src=\"require('@/assets/main/zhankai.png')\" alt=\"\" :class=\"[item.isopen&&item.children&&$style.isopen||$style.isclose]\" v-show=\"item.children\">\r\n            </div>\r\n            <div style=\"margin:0;padding:0\" v-show=\"item.isopen\">\r\n              <div v-for=\"(item1,index1) in item.children\" :key=\"index1\" >\r\n                <li :class=\"item1.children&&$style.layers\" :style=\"[(cmpIndex.id==item1.id||item1.children)&&{backgroundColor:theme.selected_color},{paddingLeft:item1.children?'40px':'60px'}]\" @click=\"click(item1)\">\r\n                  <span :class=\"cmpIndex.id==item1.id&&$style.indexbgc\" :style=\"{backgroundColor:theme.color}\"></span> {{item1.name}}\r\n                </li>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <div style=\"padding:5px;display: flex;border-top:1px solid #ccc;\">\r\n        <Button icon=\"el-icon-plus\" style=\"margin-right:6px;flex: 1\" type=\"primary\"  @click=\"addDirClick()\" >{{$_L.get('新增')}}</Button>\r\n        <Button icon=\"el-icon-edit\" style=\"margin-right:6px;flex: 1\" type=\"primary\"  @click=\"updDirClick()\" :disabled=\"!cmpIndex.id\">{{$_L.get('修改')}}</Button>\r\n        <Button icon=\"el-icon-minus\" style=\"flex: 1\" type=\"primary\" @click=\"delDirClick()\" :disabled=\"!cmpIndex.id\">{{$_L.get('删除')}}</Button>\r\n      </div>\r\n    </div>\r\n    <div style=\"width:calc(80% - 5px);margin-left:5px;display: flex;flex-flow:column;\">\r\n      <div >\r\n        <Toolbar>\r\n          <div slot=\"right\">\r\n            <Button icon=\"el-icon-plus\" style=\"margin-right:6px;\" type=\"primary\"  @click=\"addClick()\" :disabled=\"!cmpIndex.id||(!place||place.length==0)\">{{$_L.get('新增')}}</Button>\r\n            <Button icon=\"el-icon-edit\" style=\"margin-right:6px;\" type=\"primary\"  @click=\"updClick()\" :disabled=\"!selectedItem\">{{$_L.get('修改')}}</Button>\r\n            <Button icon=\"el-icon-minus\" style=\"margin-right:6px;\" type=\"primary\" @click=\"delClick()\" :disabled=\"!selectedItem\">{{$_L.get('删除')}}</Button>\r\n          </div>\r\n        </Toolbar>\r\n      </div>\r\n      <div style=\"flex-shrink:1;height:100%;position:relative\">\r\n        <vxe-table :data=\"datas\" :loading=\"!datas\" ref=\"grid\" style=\"border:1px solid #AEBAC5;border-top:0;position:absolute;left:0;top:0;right:0;bottom:0;\" @cell-click=\"({row})=>selectedItem=row\">\r\n          <vxe-table-column type=\"index\" :title=\"$_L.get('序号')\" width=\"50px\" />\r\n          <vxe-table-column field=\"name\" :title=\"$_L.get('工况名称')\"/>\r\n          <vxe-table-column field=\"state\" :title=\"$_L.get('状态')\" :formatter=\"({cellValue})=>cellValue=='1'?$_L.get('正常'):$_L.get('关闭')\"/>\r\n          <vxe-table-column field=\"des\" :title=\"$_L.get('描述')\" />\r\n          <vxe-table-column field=\"atime\" :title=\"$_L.get('创建时间')\" />\r\n          <vxe-table-column field=\"auser\" :title=\"$_L.get('创建用户')\" />\r\n        </vxe-table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AiAddOrUpdateWindow      from './AiAddOrUpdateWindow.vue';\r\nimport DirAddOrUpdateWindow     from './DirAddOrUpdateWindow.vue';\r\nimport { arrayRemoveItem }      from '@/common/util/Arrays.js';\r\nimport { arrayToMap }           from '@/common/util/Arrays.js';\r\nimport { objClone, objCopyTo }  from '@/common/util/Objects.js';\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      areas:[{name:'黑龙江省'},{name:'辽宁省'},{name:'吉林省'},{name:'河北省'},{name:'河南省'},{name:'湖北省'},{name:'湖南省'},\r\n        {name:'山东省'},{name:'山西省'},{name:'陕西省'},{name:'安徽省'},{name:'浙江省'},{name:'江苏省'},{name:'福建省'},{name:'广东省'},\r\n        {name:'海南省'},{name:'四川省'},{name:'云南省'},{name:'贵州省'},{name:'青海省'},{name:'甘肃省'},{name:'江西省'},{name:'台湾省'},\r\n        {name:'内蒙古自治区'},{name:'宁夏回族自治区'},{name:'新疆维吾尔自治区'},{name:'西藏自治区'},{name:'广西壮族自治区'},\r\n        {name:'北京市'},{name:'上海市'},{name:'天津市'},{name:'重庆市'},{name:'香港特别行政区'},{name:'澳门特别行政区'}],\r\n      datas: [],\r\n      list:[],\r\n      place:[],\r\n      cmpIndex:{id:null},\r\n      selected:null,\r\n      selectedItem:null,\r\n      index:0\r\n    }\r\n  },\r\n\r\n  created(){\r\n  },\r\n  mounted() {\r\n    $_main.http.get('rule/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n      this.list=result;\r\n    })\r\n    this.getPlace()\r\n  },\r\n  methods: {\r\n    getPlace(){\r\n      $_main.http.get('place/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n        let areas=this.areas.filter(el=>result.some(item=>item.area==el.name))||[],place=[]\r\n        areas.forEach(el=>{\r\n          el.isopen=false\r\n          el.children=[];\r\n          result.forEach(item=>{\r\n            if(el.name==item.area){\r\n              el.children.push(item)\r\n            }\r\n          })\r\n          place.push(el)\r\n        })\r\n        this.place=place;\r\n      })\r\n    },\r\n\r\n    addClick(){\r\n      let item={name:null,cars:[],area:this.cmpIndex.area,des:null,regions:[],auser:$_main.userId,placeId:this.cmpIndex.id}\r\n      $_popup.open(AiAddOrUpdateWindow, {item:item,callback:this.addOrUpdateCallback});\r\n    },\r\n    updClick(){\r\n      $_popup.open(AiAddOrUpdateWindow, {item:objClone(this.selectedItem),callback:this.addOrUpdateCallback});\r\n    },\r\n    addOrUpdateCallback(result,isddd){\r\n      if(isddd){\r\n        this.datas.push(result)\r\n        this.list.push(result)\r\n      }else{\r\n        objCopyTo(result, this.selectedItem);\r\n      }\r\n    },\r\n    delClick(){\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('rule/delete', {id:this.selectedItem.id}).then(e => {\r\n          arrayRemoveItem(this.datas, this.selectedItem);\r\n          arrayRemoveItem(this.list, this.selectedItem);\r\n          this.selectedItem=null;\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    addDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,callback:this.addOrUpdateDirCallback});\r\n    },\r\n    updDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,item:objClone(this.selected),callback:this.addOrUpdateDirCallback});\r\n    },\r\n    addOrUpdateDirCallback(result,isddd){\r\n      if(isddd){\r\n        let place=arrayToMap(this.place,'name')\r\n        if(place[result.area]){\r\n          place[result.area].children.push(result)\r\n          this.$forceUpdate()\r\n        }else{\r\n          this.place.push({name:result.area,isopen:false,children:[result]})\r\n        }\r\n      }else{\r\n        objCopyTo(result, this.selected);\r\n      }\r\n    },\r\n    delDirClick(){\r\n      if(this.datas&&this.datas.length!=0)return $_alert.warn($_L.get('该场地下有工况，请先删除工况？'))\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('place/delete', {id:this.selected.id}).then(e => {\r\n          let obj\r\n          this.place.forEach(el=>{\r\n            if(el.name==this.selected.area){\r\n              arrayRemoveItem(el.children, this.selected);\r\n              if(el.children==0){obj=el}\r\n            }\r\n          })\r\n          if(obj){arrayRemoveItem(this.place, obj);}\r\n          this.selected=null;\r\n          this.cmpIndex={id:null}\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    click(item){\r\n      this.index++\r\n      if(!item.children){\r\n        this.cmpIndex=item;\r\n        this.datas=this.list.filter(el=>el.placeId==item.id)\r\n      }else{\r\n        item.isopen=!item.isopen;\r\n\r\n      }\r\n      this.$forceUpdate()\r\n      this.selected=item;\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style module>\r\n.container{\r\n  width: 100%;\r\n  height: 100%;\r\n  display:flex;\r\n\r\n}\r\n.left_ul{\r\n  height: 100%;\r\n  margin: 0;\r\n  padding:0;\r\n  overflow: auto;\r\n}\r\n.left_ul::-webkit-scrollbar {\r\n  width: 0px;\r\n}\r\n.left_ul li{\r\n  cursor: pointer;\r\n  position: relative;\r\n  height: auto;\r\n  line-height: 50px;\r\n  font-size: 14px;\r\n  min-width: 220px;\r\n}\r\n.left_ul li >div{\r\n  padding-left: 20px;\r\n  padding-right: 10px;\r\n}\r\n\r\n.left_ul li >div:first-child:hover{\r\n  background-color: rgb(255, 240, 193);\r\n}\r\n.left_ul li img{\r\n  vertical-align:middle;\r\n  display: inline-block;\r\n  padding-right: 5px;\r\n}\r\n.indexbgc{\r\n  position: absolute;\r\n  width: 5px;\r\n  height: 50px;\r\n  left: 0;\r\n  top: 0px;\r\n  z-index: 2;\r\n}\r\n.isopen{\r\n  max-width:20px;\r\n  float:right;\r\n  margin-top:25px;\r\n}\r\n.isclose{\r\n  max-width:20px;\r\n  float:right;\r\n  margin-top:25px;\r\n  transform:rotate(90deg);\r\n}\r\n.layers{\r\n  opacity: 0.5;\r\n  color: #000;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/modules/cdRule"}]}