{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\components\\Table\\list\\src\\list.js","dependencies":[{"path":"D:\\cdRule\\src\\components\\Table\\list\\src\\list.js","mtime":1635230121491},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.number.constructor\";\nimport XEUtils from 'xe-utils';\nimport GlobalConfig from \"../../v-x-e-table/src/conf\";\nimport vSize from \"../../mixins/size\";\nimport { GlobalEvent, createResizeEvent } from \"../../tools\";\nimport { browse } from \"../../tools/src/dom\";\nexport default {\n  name: 'VxeList',\n  mixins: [vSize],\n  props: {\n    data: Array,\n    height: [Number, String],\n    maxHeight: [Number, String],\n    loading: Boolean,\n    className: [String, Function],\n    size: {\n      type: String,\n      default: function _default() {\n        return GlobalConfig.list.size || GlobalConfig.size;\n      }\n    },\n    autoResize: {\n      type: Boolean,\n      default: function _default() {\n        return GlobalConfig.list.autoResize;\n      }\n    },\n    syncResize: [Boolean, String, Number],\n    scrollY: Object\n  },\n  data: function data() {\n    return {\n      scrollYLoad: false,\n      bodyHeight: 0,\n      topSpaceHeight: 0,\n      items: []\n    };\n  },\n  computed: {\n    sYOpts: function sYOpts() {\n      return Object.assign({}, GlobalConfig.list.scrollY, this.scrollY);\n    },\n    styles: function styles() {\n      var height = this.height,\n          maxHeight = this.maxHeight;\n      var style = {};\n\n      if (height) {\n        style.height = isNaN(height) ? height : \"\".concat(height, \"px\");\n      } else if (maxHeight) {\n        style.height = 'auto';\n        style.maxHeight = isNaN(maxHeight) ? maxHeight : \"\".concat(maxHeight, \"px\");\n      }\n\n      return style;\n    }\n  },\n  watch: {\n    data: function data(value) {\n      this.loadData(value);\n    },\n    syncResize: function syncResize(value) {\n      var _this = this;\n\n      if (value) {\n        this.recalculate();\n        this.$nextTick(function () {\n          return setTimeout(function () {\n            return _this.recalculate();\n          });\n        });\n      }\n    }\n  },\n  created: function created() {\n    Object.assign(this, {\n      fullData: [],\n      lastScrollLeft: 0,\n      lastScrollTop: 0,\n      scrollYStore: {\n        startIndex: 0,\n        endIndex: 0,\n        visibleSize: 0\n      }\n    });\n    this.loadData(this.data);\n    GlobalEvent.on(this, 'resize', this.handleGlobalResizeEvent);\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    if (this.autoResize) {\n      var resizeObserver = createResizeEvent(function () {\n        return _this2.recalculate();\n      });\n      resizeObserver.observe(this.$el);\n      this.$resize = resizeObserver;\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.$resize) {\n      this.$resize.disconnect();\n    }\n  },\n  destroyed: function destroyed() {\n    GlobalEvent.off(this, 'resize');\n  },\n  render: function render(h) {\n    var $scopedSlots = this.$scopedSlots,\n        styles = this.styles,\n        bodyHeight = this.bodyHeight,\n        topSpaceHeight = this.topSpaceHeight,\n        items = this.items,\n        className = this.className,\n        loading = this.loading;\n    return h('div', {\n      class: ['vxe-list', className ? XEUtils.isFunction(className) ? className({\n        $list: this\n      }) : className : '', {\n        'is--loading': loading\n      }]\n    }, [h('div', {\n      ref: 'virtualWrapper',\n      class: 'vxe-list--virtual-wrapper',\n      style: styles,\n      on: {\n        scroll: this.scrollEvent\n      }\n    }, [h('div', {\n      ref: 'ySpace',\n      class: 'vxe-list--y-space',\n      style: {\n        height: bodyHeight ? \"\".concat(bodyHeight, \"px\") : ''\n      }\n    }), h('div', {\n      ref: 'virtualBody',\n      class: 'vxe-list--body',\n      style: {\n        marginTop: topSpaceHeight ? \"\".concat(topSpaceHeight, \"px\") : ''\n      }\n    }, $scopedSlots.default ? $scopedSlots.default.call(this, {\n      items: items,\n      $list: this\n    }, h) : [])]), h('div', {\n      class: ['vxe-list--loading vxe-loading', {\n        'is--visible': loading\n      }]\n    }, [h('div', {\n      class: 'vxe-loading--spinner'\n    })])]);\n  },\n  methods: {\n    getParentElem: function getParentElem() {\n      return this.$el.parentNode;\n    },\n\n    /**\r\n     * 加载数据\r\n     * @param {Array} datas 数据\r\n     */\n    loadData: function loadData(datas) {\n      var _this3 = this;\n\n      var sYOpts = this.sYOpts,\n          scrollYStore = this.scrollYStore;\n      var fullData = datas || [];\n      scrollYStore.startIndex = 0;\n      scrollYStore.visibleIndex = 0;\n      this.fullData = fullData;\n      this.scrollYLoad = sYOpts.enabled && sYOpts.gt > -1 && sYOpts.gt <= fullData.length;\n      this.handleData();\n      return this.computeScrollLoad().then(function () {\n        _this3.refreshScroll();\n      });\n    },\n\n    /**\r\n     * 重新加载数据\r\n     * @param {Array} datas 数据\r\n     */\n    reloadData: function reloadData(datas) {\n      this.clearScroll();\n      return this.loadData(datas);\n    },\n    handleData: function handleData() {\n      var fullData = this.fullData,\n          scrollYLoad = this.scrollYLoad,\n          scrollYStore = this.scrollYStore;\n      this.items = scrollYLoad ? fullData.slice(scrollYStore.startIndex, scrollYStore.endIndex) : fullData.slice(0);\n      return this.$nextTick();\n    },\n\n    /**\r\n     * 重新计算列表\r\n     */\n    recalculate: function recalculate() {\n      var $el = this.$el;\n\n      if ($el.clientWidth && $el.clientHeight) {\n        return this.computeScrollLoad();\n      }\n\n      return Promise.resolve();\n    },\n\n    /**\r\n     * 清除滚动条\r\n     */\n    clearScroll: function clearScroll() {\n      var scrollBodyElem = this.$refs.virtualWrapper;\n\n      if (scrollBodyElem) {\n        scrollBodyElem.scrollTop = 0;\n      }\n\n      return this.$nextTick();\n    },\n\n    /**\r\n     * 刷新滚动条\r\n     */\n    refreshScroll: function refreshScroll() {\n      var _this4 = this;\n\n      var lastScrollLeft = this.lastScrollLeft,\n          lastScrollTop = this.lastScrollTop;\n      return this.clearScroll().then(function () {\n        if (lastScrollLeft || lastScrollTop) {\n          _this4.lastScrollLeft = 0;\n          _this4.lastScrollTop = 0;\n          return _this4.scrollTo(lastScrollLeft, lastScrollTop);\n        }\n      });\n    },\n\n    /**\r\n     * 如果有滚动条，则滚动到对应的位置\r\n     * @param {Number} scrollLeft 左距离\r\n     * @param {Number} scrollTop 上距离\r\n     */\n    scrollTo: function scrollTo(scrollLeft, scrollTop) {\n      var _this5 = this;\n\n      var scrollBodyElem = this.$refs.virtualWrapper;\n\n      if (XEUtils.isNumber(scrollLeft)) {\n        scrollBodyElem.scrollLeft = scrollLeft;\n      }\n\n      if (XEUtils.isNumber(scrollTop)) {\n        scrollBodyElem.scrollTop = scrollTop;\n      }\n\n      if (this.scrollYLoad) {\n        return new Promise(function (resolve) {\n          return setTimeout(function () {\n            return resolve(_this5.$nextTick());\n          }, 50);\n        });\n      }\n\n      return this.$nextTick();\n    },\n    computeScrollLoad: function computeScrollLoad() {\n      var _this6 = this;\n\n      return this.$nextTick().then(function () {\n        var $refs = _this6.$refs,\n            sYOpts = _this6.sYOpts,\n            scrollYLoad = _this6.scrollYLoad,\n            scrollYStore = _this6.scrollYStore;\n        var virtualWrapperElem = $refs.virtualWrapper,\n            virtualBodyElem = $refs.virtualBody;\n        var rowHeight = 0;\n        var firstItemElem;\n\n        if (virtualBodyElem) {\n          if (sYOpts.sItem) {\n            firstItemElem = virtualBodyElem.querySelector(sYOpts.sItem);\n          }\n\n          if (!firstItemElem) {\n            firstItemElem = virtualBodyElem.children[0];\n          }\n        }\n\n        if (firstItemElem) {\n          rowHeight = firstItemElem.offsetHeight;\n        }\n\n        rowHeight = Math.max(20, rowHeight);\n        scrollYStore.rowHeight = rowHeight; // 计算 Y 逻辑\n\n        if (scrollYLoad) {\n          var visibleYSize = Math.max(8, Math.ceil(virtualWrapperElem.clientHeight / rowHeight));\n          var offsetYSize = sYOpts.oSize ? XEUtils.toNumber(sYOpts.oSize) : browse.msie ? 20 : browse.edge ? 10 : 0;\n          scrollYStore.offsetSize = offsetYSize;\n          scrollYStore.visibleSize = visibleYSize;\n          scrollYStore.endIndex = Math.max(scrollYStore.startIndex, visibleYSize + offsetYSize, scrollYStore.endIndex);\n\n          _this6.updateYData();\n        } else {\n          _this6.updateYSpace();\n        }\n\n        _this6.rowHeight = rowHeight;\n      });\n    },\n    scrollEvent: function scrollEvent(evnt) {\n      var scrollBodyElem = evnt.target;\n      var scrollTop = scrollBodyElem.scrollTop;\n      var scrollLeft = scrollBodyElem.scrollLeft;\n      var isX = scrollLeft !== this.lastScrollLeft;\n      var isY = scrollTop !== this.lastScrollTop;\n      this.lastScrollTop = scrollTop;\n      this.lastScrollLeft = scrollLeft;\n\n      if (this.scrollYLoad) {\n        this.loadYData(evnt);\n      }\n\n      this.$emit('scroll', {\n        scrollLeft: scrollLeft,\n        scrollTop: scrollTop,\n        isX: isX,\n        isY: isY,\n        $event: evnt\n      });\n    },\n    loadYData: function loadYData(evnt) {\n      var scrollYStore = this.scrollYStore;\n      var startIndex = scrollYStore.startIndex,\n          endIndex = scrollYStore.endIndex,\n          visibleSize = scrollYStore.visibleSize,\n          offsetSize = scrollYStore.offsetSize,\n          rowHeight = scrollYStore.rowHeight;\n      var scrollBodyElem = evnt.target;\n      var scrollTop = scrollBodyElem.scrollTop;\n      var toVisibleIndex = Math.floor(scrollTop / rowHeight);\n      var offsetStartIndex = Math.max(0, toVisibleIndex - 1 - offsetSize);\n      var offsetEndIndex = toVisibleIndex + visibleSize + offsetSize;\n\n      if (toVisibleIndex <= startIndex || toVisibleIndex >= endIndex - visibleSize - 1) {\n        if (startIndex !== offsetStartIndex || endIndex !== offsetEndIndex) {\n          scrollYStore.startIndex = offsetStartIndex;\n          scrollYStore.endIndex = offsetEndIndex;\n          this.updateYData();\n        }\n      }\n    },\n    updateYData: function updateYData() {\n      this.handleData();\n      this.updateYSpace();\n    },\n    updateYSpace: function updateYSpace() {\n      var scrollYStore = this.scrollYStore,\n          scrollYLoad = this.scrollYLoad,\n          fullData = this.fullData;\n      this.bodyHeight = scrollYLoad ? fullData.length * scrollYStore.rowHeight : 0;\n      this.topSpaceHeight = scrollYLoad ? Math.max(scrollYStore.startIndex * scrollYStore.rowHeight, 0) : 0;\n    },\n    handleGlobalResizeEvent: function handleGlobalResizeEvent() {\n      this.recalculate();\n    }\n  }\n};",{"version":3,"sources":["D:\\cdRule\\src\\components\\Table\\list\\src\\list.js"],"names":["name","mixins","props","data","height","maxHeight","loading","className","size","type","default","GlobalConfig","autoResize","syncResize","scrollY","Object","scrollYLoad","bodyHeight","topSpaceHeight","items","computed","sYOpts","styles","style","isNaN","watch","setTimeout","created","fullData","lastScrollLeft","lastScrollTop","scrollYStore","startIndex","endIndex","visibleSize","GlobalEvent","mounted","resizeObserver","createResizeEvent","beforeDestroy","destroyed","render","$scopedSlots","h","class","$list","ref","on","scroll","scrollEvent","marginTop","methods","getParentElem","loadData","datas","reloadData","handleData","recalculate","$el","Promise","clearScroll","scrollBodyElem","refreshScroll","scrollTo","XEUtils","resolve","computeScrollLoad","$refs","virtualWrapperElem","virtualBodyElem","rowHeight","firstItemElem","Math","visibleYSize","offsetYSize","browse","evnt","scrollTop","scrollLeft","isX","isY","$event","loadYData","offsetSize","toVisibleIndex","offsetStartIndex","offsetEndIndex","updateYData","updateYSpace","handleGlobalResizeEvent"],"mappings":"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","sourcesContent":["import XEUtils from 'xe-utils'\r\nimport GlobalConfig from '../../v-x-e-table/src/conf'\r\nimport vSize from '../../mixins/size'\r\nimport { GlobalEvent, createResizeEvent } from '../../tools'\r\nimport { browse } from '../../tools/src/dom'\r\n\r\nexport default {\r\n  name: 'VxeList',\r\n  mixins: [vSize],\r\n  props: {\r\n    data: Array,\r\n    height: [Number, String],\r\n    maxHeight: [Number, String],\r\n    loading: Boolean,\r\n    className: [String, Function],\r\n    size: { type: String, default: () => GlobalConfig.list.size || GlobalConfig.size },\r\n    autoResize: { type: Boolean, default: () => GlobalConfig.list.autoResize },\r\n    syncResize: [Boolean, String, Number],\r\n    scrollY: Object\r\n  },\r\n  data () {\r\n    return {\r\n      scrollYLoad: false,\r\n      bodyHeight: 0,\r\n      topSpaceHeight: 0,\r\n      items: []\r\n    }\r\n  },\r\n  computed: {\r\n    sYOpts () {\r\n      return Object.assign({}, GlobalConfig.list.scrollY, this.scrollY)\r\n    },\r\n    styles () {\r\n      const { height, maxHeight } = this\r\n      const style = {}\r\n      if (height) {\r\n        style.height = isNaN(height) ? height : `${height}px`\r\n      } else if (maxHeight) {\r\n        style.height = 'auto'\r\n        style.maxHeight = isNaN(maxHeight) ? maxHeight : `${maxHeight}px`\r\n      }\r\n      return style\r\n    }\r\n  },\r\n  watch: {\r\n    data (value) {\r\n      this.loadData(value)\r\n    },\r\n    syncResize (value) {\r\n      if (value) {\r\n        this.recalculate()\r\n        this.$nextTick(() => setTimeout(() => this.recalculate()))\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    Object.assign(this, {\r\n      fullData: [],\r\n      lastScrollLeft: 0,\r\n      lastScrollTop: 0,\r\n      scrollYStore: {\r\n        startIndex: 0,\r\n        endIndex: 0,\r\n        visibleSize: 0\r\n      }\r\n    })\r\n    this.loadData(this.data)\r\n    GlobalEvent.on(this, 'resize', this.handleGlobalResizeEvent)\r\n  },\r\n  mounted () {\r\n    if (this.autoResize) {\r\n      const resizeObserver = createResizeEvent(() => this.recalculate())\r\n      resizeObserver.observe(this.$el)\r\n      this.$resize = resizeObserver\r\n    }\r\n  },\r\n  beforeDestroy () {\r\n    if (this.$resize) {\r\n      this.$resize.disconnect()\r\n    }\r\n  },\r\n  destroyed () {\r\n    GlobalEvent.off(this, 'resize')\r\n  },\r\n  render (h) {\r\n    const { $scopedSlots, styles, bodyHeight, topSpaceHeight, items, className, loading } = this\r\n    return h('div', {\r\n      class: ['vxe-list', className ? (XEUtils.isFunction(className) ? className({ $list: this }) : className) : '', {\r\n        'is--loading': loading\r\n      }]\r\n    }, [\r\n      h('div', {\r\n        ref: 'virtualWrapper',\r\n        class: 'vxe-list--virtual-wrapper',\r\n        style: styles,\r\n        on: {\r\n          scroll: this.scrollEvent\r\n        }\r\n      }, [\r\n        h('div', {\r\n          ref: 'ySpace',\r\n          class: 'vxe-list--y-space',\r\n          style: {\r\n            height: bodyHeight ? `${bodyHeight}px` : ''\r\n          }\r\n        }),\r\n        h('div', {\r\n          ref: 'virtualBody',\r\n          class: 'vxe-list--body',\r\n          style: {\r\n            marginTop: topSpaceHeight ? `${topSpaceHeight}px` : ''\r\n          }\r\n        }, $scopedSlots.default ? $scopedSlots.default.call(this, { items, $list: this }, h) : [])\r\n      ]),\r\n      h('div', {\r\n        class: ['vxe-list--loading vxe-loading', {\r\n          'is--visible': loading\r\n        }]\r\n      }, [\r\n        h('div', {\r\n          class: 'vxe-loading--spinner'\r\n        })\r\n      ])\r\n    ])\r\n  },\r\n  methods: {\r\n    getParentElem () {\r\n      return this.$el.parentNode\r\n    },\r\n    /**\r\n     * 加载数据\r\n     * @param {Array} datas 数据\r\n     */\r\n    loadData (datas) {\r\n      const { sYOpts, scrollYStore } = this\r\n      const fullData = datas || []\r\n      scrollYStore.startIndex = 0\r\n      scrollYStore.visibleIndex = 0\r\n      this.fullData = fullData\r\n      this.scrollYLoad = sYOpts.enabled && sYOpts.gt > -1 && sYOpts.gt <= fullData.length\r\n      this.handleData()\r\n      return this.computeScrollLoad().then(() => {\r\n        this.refreshScroll()\r\n      })\r\n    },\r\n    /**\r\n     * 重新加载数据\r\n     * @param {Array} datas 数据\r\n     */\r\n    reloadData (datas) {\r\n      this.clearScroll()\r\n      return this.loadData(datas)\r\n    },\r\n    handleData () {\r\n      const { fullData, scrollYLoad, scrollYStore } = this\r\n      this.items = scrollYLoad ? fullData.slice(scrollYStore.startIndex, scrollYStore.endIndex) : fullData.slice(0)\r\n      return this.$nextTick()\r\n    },\r\n    /**\r\n     * 重新计算列表\r\n     */\r\n    recalculate () {\r\n      const { $el } = this\r\n      if ($el.clientWidth && $el.clientHeight) {\r\n        return this.computeScrollLoad()\r\n      }\r\n      return Promise.resolve()\r\n    },\r\n    /**\r\n     * 清除滚动条\r\n     */\r\n    clearScroll () {\r\n      const scrollBodyElem = this.$refs.virtualWrapper\r\n      if (scrollBodyElem) {\r\n        scrollBodyElem.scrollTop = 0\r\n      }\r\n      return this.$nextTick()\r\n    },\r\n    /**\r\n     * 刷新滚动条\r\n     */\r\n    refreshScroll () {\r\n      const { lastScrollLeft, lastScrollTop } = this\r\n      return this.clearScroll().then(() => {\r\n        if (lastScrollLeft || lastScrollTop) {\r\n          this.lastScrollLeft = 0\r\n          this.lastScrollTop = 0\r\n          return this.scrollTo(lastScrollLeft, lastScrollTop)\r\n        }\r\n      })\r\n    },\r\n    /**\r\n     * 如果有滚动条，则滚动到对应的位置\r\n     * @param {Number} scrollLeft 左距离\r\n     * @param {Number} scrollTop 上距离\r\n     */\r\n    scrollTo (scrollLeft, scrollTop) {\r\n      const scrollBodyElem = this.$refs.virtualWrapper\r\n      if (XEUtils.isNumber(scrollLeft)) {\r\n        scrollBodyElem.scrollLeft = scrollLeft\r\n      }\r\n      if (XEUtils.isNumber(scrollTop)) {\r\n        scrollBodyElem.scrollTop = scrollTop\r\n      }\r\n      if (this.scrollYLoad) {\r\n        return new Promise(resolve => setTimeout(() => resolve(this.$nextTick()), 50))\r\n      }\r\n      return this.$nextTick()\r\n    },\r\n    computeScrollLoad () {\r\n      return this.$nextTick().then(() => {\r\n        const { $refs, sYOpts, scrollYLoad, scrollYStore } = this\r\n        const { virtualWrapper: virtualWrapperElem, virtualBody: virtualBodyElem } = $refs\r\n        let rowHeight = 0\r\n        let firstItemElem\r\n        if (virtualBodyElem) {\r\n          if (sYOpts.sItem) {\r\n            firstItemElem = virtualBodyElem.querySelector(sYOpts.sItem)\r\n          }\r\n          if (!firstItemElem) {\r\n            firstItemElem = virtualBodyElem.children[0]\r\n          }\r\n        }\r\n        if (firstItemElem) {\r\n          rowHeight = firstItemElem.offsetHeight\r\n        }\r\n        rowHeight = Math.max(20, rowHeight)\r\n        scrollYStore.rowHeight = rowHeight\r\n        // 计算 Y 逻辑\r\n        if (scrollYLoad) {\r\n          const visibleYSize = Math.max(8, Math.ceil(virtualWrapperElem.clientHeight / rowHeight))\r\n          const offsetYSize = sYOpts.oSize ? XEUtils.toNumber(sYOpts.oSize) : browse.msie ? 20 : (browse.edge ? 10 : 0)\r\n          scrollYStore.offsetSize = offsetYSize\r\n          scrollYStore.visibleSize = visibleYSize\r\n          scrollYStore.endIndex = Math.max(scrollYStore.startIndex, visibleYSize + offsetYSize, scrollYStore.endIndex)\r\n          this.updateYData()\r\n        } else {\r\n          this.updateYSpace()\r\n        }\r\n        this.rowHeight = rowHeight\r\n      })\r\n    },\r\n    scrollEvent (evnt) {\r\n      const scrollBodyElem = evnt.target\r\n      const scrollTop = scrollBodyElem.scrollTop\r\n      const scrollLeft = scrollBodyElem.scrollLeft\r\n      const isX = scrollLeft !== this.lastScrollLeft\r\n      const isY = scrollTop !== this.lastScrollTop\r\n      this.lastScrollTop = scrollTop\r\n      this.lastScrollLeft = scrollLeft\r\n      if (this.scrollYLoad) {\r\n        this.loadYData(evnt)\r\n      }\r\n      this.$emit('scroll', { scrollLeft, scrollTop, isX, isY, $event: evnt })\r\n    },\r\n    loadYData (evnt) {\r\n      const { scrollYStore } = this\r\n      const { startIndex, endIndex, visibleSize, offsetSize, rowHeight } = scrollYStore\r\n      const scrollBodyElem = evnt.target\r\n      const scrollTop = scrollBodyElem.scrollTop\r\n      const toVisibleIndex = Math.floor(scrollTop / rowHeight)\r\n      const offsetStartIndex = Math.max(0, toVisibleIndex - 1 - offsetSize)\r\n      const offsetEndIndex = toVisibleIndex + visibleSize + offsetSize\r\n      if (toVisibleIndex <= startIndex || toVisibleIndex >= endIndex - visibleSize - 1) {\r\n        if (startIndex !== offsetStartIndex || endIndex !== offsetEndIndex) {\r\n          scrollYStore.startIndex = offsetStartIndex\r\n          scrollYStore.endIndex = offsetEndIndex\r\n          this.updateYData()\r\n        }\r\n      }\r\n    },\r\n    updateYData () {\r\n      this.handleData()\r\n      this.updateYSpace()\r\n    },\r\n    updateYSpace () {\r\n      const { scrollYStore, scrollYLoad, fullData } = this\r\n      this.bodyHeight = scrollYLoad ? fullData.length * scrollYStore.rowHeight : 0\r\n      this.topSpaceHeight = scrollYLoad ? Math.max(scrollYStore.startIndex * scrollYStore.rowHeight, 0) : 0\r\n    },\r\n    handleGlobalResizeEvent () {\r\n      this.recalculate()\r\n    }\r\n  }\r\n}\r\n"]}]}