{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\common\\Message.js","dependencies":[{"path":"D:\\cdRule\\src\\common\\Message.js","mtime":1677657197151},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport { objIsEmpty } from '@/common/util/Objects.js';\nvar LISTENERS = {},\n    TIME = false,\n    REMOVED = {},\n    REMOVE_FLAG = false,\n    POST_ING = false;\nvar Message = {\n  RESTART: -1,\n  //接收服务器重启指令\n  GPS: 2,\n  //接收定位指令\n  CRD: 3,\n  //接收实时数据\n  STATE: 5,\n  //接收车辆状态指令\n  CMD: 7,\n  //接收指令回复\n  MSG: 9,\n  //接收消息通知\n  EXIT: 12 //接受（单账户登录模式时强制退出指令)\n\n};\nvar sorts = {};\nsorts[Message.EXIT] = 1;\nsorts[Message.RESTART] = 2;\nsorts[Message.STATE] = 3;\nsorts[Message.CMD] = 5;\nsorts[Message.GPS] = 8;\nsorts[Message.CRD] = 9;\nsorts[Message.MSG] = 10; //三方系统使用列表\n//CAN用了20、21\n\nfunction sortCmds(cmd1, cmd2) {\n  cmd1 = sorts[cmd1] || 99;\n  cmd2 = sorts[cmd2] || 99;\n  return cmd1 - cmd2;\n}\n\nfunction onTimer() {\n  var cmds = Object.keys(LISTENERS);\n  if (cmds.length == 0) return;\n  if (cmds.length > 1) cmds.sort(sortCmds);\n  POST_ING = true;\n  window.$_main.http.post('/message', cmds, true).then(function (result) {\n    POST_ING = false;\n\n    var _loop = function _loop(i) {\n      if (!result[i]) return \"continue\";\n      var cbs = LISTENERS[cmds[i]];\n      cbs && cbs.forEach(function (cb) {\n        try {\n          cb(result[i]);\n        } catch (error) {\n          console.log(error);\n        }\n      });\n\n      if (REMOVE_FLAG) {\n        cbs = REMOVED[cmds[i]];\n        cbs && cbs.forEach(function (cb) {\n          try {\n            cb(result[i]);\n          } catch (error) {\n            console.log(error);\n          }\n        });\n      }\n    };\n\n    for (var i = 0; i < cmds.length; i++) {\n      var _ret = _loop(i);\n\n      if (_ret === \"continue\") continue;\n    }\n\n    if (REMOVE_FLAG) {\n      REMOVE_FLAG = false;\n      REMOVED = {};\n    }\n\n    if (TIME === false) return;\n    TIME = setTimeout(onTimer, 2000);\n  }).catch(function (error) {\n    console.log(error);\n    TIME !== false && (TIME = setTimeout(onTimer, 2000));\n  });\n}\n\nMessage.addListener = function (cmd, callback) {\n  LISTENERS[cmd] = LISTENERS[cmd] || [];\n  LISTENERS[cmd].push(callback);\n  TIME === false && (TIME = setTimeout(onTimer, 2000));\n};\n\nMessage.removeListener = function (cmd, callback) {\n  var cbs = LISTENERS[cmd];\n  if (!cbs) return;\n  var index = cbs.indexOf(callback);\n  if (index == -1) return;\n  cbs.splice(index, 1);\n  if (cbs.length) return;\n  delete LISTENERS[cmd];\n\n  if (POST_ING) {\n    REMOVED[cmd] = REMOVED[cmd] || [];\n    REMOVED[cmd].push(callback);\n    REMOVE_FLAG = true;\n  }\n\n  if (objIsEmpty(LISTENERS) && TIME !== false) {\n    clearTimeout(TIME);\n    TIME = false;\n  }\n};\n\nexport default Message;",{"version":3,"sources":["D:\\cdRule\\src\\common\\Message.js"],"names":["LISTENERS","TIME","REMOVED","REMOVE_FLAG","POST_ING","Message","RESTART","GPS","CRD","STATE","CMD","MSG","EXIT","sorts","cmd1","cmd2","cmds","Object","window","i","result","cbs","cb","console","setTimeout","index","objIsEmpty","clearTimeout"],"mappings":"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","sourcesContent":["\r\nimport { objIsEmpty } from '@/common/util/Objects.js';\r\n\r\nlet LISTENERS = {}, TIME = false, REMOVED = {}, REMOVE_FLAG = false, POST_ING = false;\r\n\r\nlet Message = {\r\n\tRESTART: -1,    //接收服务器重启指令\r\n\tGPS:     2,     //接收定位指令\r\n\tCRD:     3,     //接收实时数据\r\n\tSTATE:   5,     //接收车辆状态指令\r\n\tCMD:     7,     //接收指令回复\r\n\tMSG:     9,     //接收消息通知\r\n\tEXIT:    12,    //接受（单账户登录模式时强制退出指令)\r\n};\r\nlet sorts = {};\r\nsorts[Message.EXIT] = 1;\r\nsorts[Message.RESTART] = 2;\r\nsorts[Message.STATE] = 3;\r\nsorts[Message.CMD] = 5;\r\nsorts[Message.GPS] = 8;\r\nsorts[Message.CRD] = 9;\r\nsorts[Message.MSG] = 10;\r\n\r\n//三方系统使用列表\r\n//CAN用了20、21\r\n\r\nfunction sortCmds(cmd1, cmd2) {\r\n\tcmd1 = sorts[cmd1] || 99;\r\n\tcmd2 = sorts[cmd2] || 99;\r\n\treturn cmd1 - cmd2;\r\n}\r\n\r\nfunction onTimer() {\r\n\tlet cmds = Object.keys(LISTENERS);\r\n\tif (cmds.length == 0) return;\r\n\r\n\tif (cmds.length > 1) cmds.sort(sortCmds);\r\n\tPOST_ING = true;\r\n\twindow.$_main.http.post('/message', cmds, true).then(result => {\r\n\t\tPOST_ING = false;\r\n\t\tfor (let i=0; i<cmds.length; i++) {\r\n\t\t\tif (!result[i]) continue;\r\n\t\t\tlet cbs = LISTENERS[cmds[i]];\r\n\t\t\tcbs && cbs.forEach(cb => { try{cb(result[i])}catch(error){console.log(error)} });\r\n\t\t\tif (REMOVE_FLAG) {\r\n\t\t\t\tcbs = REMOVED[cmds[i]];\r\n\t\t\t\tcbs && cbs.forEach(cb => { try{cb(result[i])}catch(error){console.log(error)} });\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (REMOVE_FLAG) {\r\n\t\t\tREMOVE_FLAG = false;\r\n\t\t\tREMOVED = {};\r\n\t\t}\r\n\t\tif (TIME === false) return;\r\n\t\tTIME = setTimeout(onTimer, 2000);\r\n\t}).catch(error => {\r\n\t\tconsole.log(error);\r\n\t\tTIME !== false && (TIME = setTimeout(onTimer, 2000));\r\n\t});\r\n}\r\n\r\nMessage.addListener = function(cmd, callback) {\r\n\tLISTENERS[cmd] = LISTENERS[cmd] || [];\r\n\tLISTENERS[cmd].push(callback);\r\n\tTIME === false && (TIME = setTimeout(onTimer, 2000));\r\n}\r\n\r\nMessage.removeListener = function(cmd, callback) {\r\n\tlet cbs = LISTENERS[cmd];\r\n\tif (!cbs) return;\r\n\tlet index = cbs.indexOf(callback);\r\n\tif (index == -1) return;\r\n\r\n\tcbs.splice(index, 1);\r\n\tif (cbs.length) return;\r\n\tdelete LISTENERS[cmd];\r\n\r\n\tif (POST_ING) {\r\n\t\tREMOVED[cmd] = REMOVED[cmd] || [];\r\n\t\tREMOVED[cmd].push(callback);\r\n\t\tREMOVE_FLAG = true;\r\n\t}\r\n\r\n\tif (objIsEmpty(LISTENERS) && TIME !== false) {\r\n\t\tclearTimeout(TIME);\r\n\t\tTIME = false;\r\n\t}\r\n}\r\n\r\nexport default Message;\r\n"]}]}