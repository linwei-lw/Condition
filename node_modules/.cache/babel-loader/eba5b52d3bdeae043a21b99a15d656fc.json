{"remainingRequest":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\common\\tree\\CarTreeDyField.js","dependencies":[{"path":"D:\\cdRule\\src\\common\\tree\\CarTreeDyField.js","mtime":1677658521346},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\nimport Message from '@/common/Message.js';\nimport { secondsToCnDesc } from '@/common/util/Dates.js';\nexport default function CarTreeDyField(owner, getCarById) {\n  var ignores = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  this.owner = owner;\n  this.getCarById = getCarById;\n  this.ignores = ignores = ignores || {};\n  this.fields = [];\n  if (!owner._carTreeCfg.showCarField) return;\n  !ignores.acc && owner._carTreeCfg.showCarField.acc && this.onFieldCheck('acc', true);\n  !ignores.speed && owner._carTreeCfg.showCarField.speed && this.onFieldCheck('speed', true);\n  !ignores.rsl && owner._carTreeCfg.showCarField.rsl && this.onFieldCheck('rsl', true);\n  !ignores.ool && owner._carTreeCfg.showCarField.ool && this.onFieldCheck('ool', true);\n  !ignores.area && owner._carTreeCfg.showCarField.area && this.onFieldCheck('area', true);\n}\nCarTreeDyField.prototype = {\n  values: function values(array, node) {\n    if (!this.owner._carTreeCfg.showCarField) return;\n\n    if (!this.ignores.acc && this.owner._carTreeCfg.showCarField.acc && this.dy_acc) {\n      var v = this.dy_acc[node.id];\n      v === true && array.push($_L.get('ACC开'));\n      v === false && array.push($_L.get('ACC关'));\n    }\n\n    if (!this.ignores.speed && this.owner._carTreeCfg.showCarField.speed && this.dy_speed) {\n      var _v = this.dy_speed[node.id];\n      (_v > 0 || _v === 0) && array.push(_v + 'km/h');\n    }\n\n    if (!this.ignores.rsl && this.owner._carTreeCfg.showCarField.rsl && this.dy_rsl) {\n      var _v2 = this.dy_rsl[node.id];\n      _v2 && (_v2.indexOf('+') == 0 ? array.push($_L.get('行') + secondsToCnDesc(Number(_v2))) : array.push($_L.get('停') + secondsToCnDesc(-Number(_v2))));\n    }\n\n    if (!this.ignores.ool && this.owner._carTreeCfg.showCarField.ool && this.dy_ool) {\n      var _v3 = this.dy_ool[node.id];\n\n      if (_v3) {\n        var vv = Math.abs(Number(_v3));\n        vv = vv > 86400 ? parseInt(vv / 3600) * 3600 : vv > 3600 ? parseInt(vv / 60) * 60 : vv;\n        _v3.indexOf('+') == 0 ? array.push($_L.get('连上') + secondsToCnDesc(vv)) : array.push($_L.get('断开') + secondsToCnDesc(vv));\n      }\n    }\n\n    if (!this.ignores.area && this.owner._carTreeCfg.showCarField.area && this.dy_area) {\n      var _v4 = this.dy_area[node.id];\n      _v4 && array.push(_v4);\n    }\n  },\n  onFieldCheck: function onFieldCheck(field, check) {\n    var _this = this;\n\n    if (check) {\n      this.fields.push(field);\n      var values = this['dy_' + field] = {};\n\n      var listen = this['dy_' + field + '_listen'] = function (o) {\n        Object.assign(values, o);\n        Object.keys(o).forEach(function (carId) {\n          o = _this.getCarById(carId);\n          o && _this.owner._tree.updateNodeName(o);\n        });\n      };\n\n      Message.addListener(Message[field.toUpperCase()], listen);\n\n      if (this.owner._tree) {\n        var carIds = [];\n        this.getExpandCars(this.owner._tree.getNodes()[0], [], carIds);\n        carIds.length && window.$_main.http.post('mnt/car?field', {\n          treeId: this.owner.treeId,\n          field: field,\n          check: true,\n          carIds: carIds\n        }).then(listen);\n      }\n    } else {\n      window.$_main.http.post('mnt/car?field', {\n        treeId: this.owner.treeId,\n        field: field,\n        check: false\n      });\n      var i = this.fields.indexOf(field);\n      i != -1 && this.fields.splice(i, 1);\n      delete this['dy_' + field];\n      Message.removeListener(Message[field.toUpperCase()], this['dy_' + field + '_listen']);\n      delete this['dy_' + field + '_listen'];\n    }\n  },\n  addEventListener: function addEventListener(setting) {\n    this.__onExpand = this.__onExpand || setting.callback.onExpand;\n    setting.callback.onExpand = this.onExpand.bind(this);\n    this.__onCollapse = this.__onCollapse || setting.callback.onCollapse;\n    setting.callback.onCollapse = this.onCollapse.bind(this);\n  },\n  resetRoot: function resetRoot(root) {\n    var _this2 = this;\n\n    this.fields && this.fields.length && window.$_main.http.post('mnt/car?clear', this.owner.treeId).then(function () {\n      _this2.onExpand(root);\n    });\n  },\n  destroy: function destroy() {\n    var _this3 = this;\n\n    if (this.fields && this.fields.length) {\n      this.fields.forEach(function (field) {\n        delete _this3['dy_' + field];\n        Message.removeListener(Message[field.toUpperCase()], _this3['dy_' + field + '_listen']);\n        delete _this3['dy_' + field + '_listen'];\n      });\n      window.$_main.http.post('/mnt/car?clear', this.owner.treeId);\n    }\n\n    this.fields = null;\n    this.owner = null;\n  },\n  getExpandCars: function getExpandCars(node, list, ids) {\n    var _this4 = this;\n\n    node && node.children && node.children.forEach(function (n) {\n      if (n.plate) {\n        list.push(n);\n        ids.push(n.id);\n        return;\n      }\n\n      var Z = n[_this4.owner.treeId];\n      Z && Z.open && _this4.getExpandCars(n, list, ids);\n    });\n  },\n  onExpand: function onExpand(node, event) {\n    var _this5 = this;\n\n    this.__onExpand && this.__onExpand(node, event);\n    if (this.fields.length == 0) return;\n    var cars = [],\n        carIds = [];\n    this.getExpandCars(node, cars, carIds);\n    carIds.length && window.$_main.http.post('/mnt/car?toogle', {\n      treeId: this.owner.treeId,\n      fields: this.fields,\n      expand: true,\n      carIds: carIds\n    }).then(function (result) {\n      _this5.fields.forEach(function (field, i) {\n        return Object.assign(_this5['dy_' + field], result[i]);\n      });\n\n      cars.forEach(function (car) {\n        return _this5.owner._tree.updateNodeName(car);\n      });\n    });\n  },\n  onCollapse: function onCollapse(node, event) {\n    var _this6 = this;\n\n    this.__onCollapse && this.__onCollapse(node, event);\n    if (this.fields.length == 0) return;\n    var cars = [],\n        carIds = [];\n    this.getExpandCars(node, cars, carIds);\n    carIds.length && window.$_main.http.post('/mnt/car?toogle', {\n      treeId: this.owner.treeId,\n      fields: this.fields,\n      expand: false,\n      carIds: carIds\n    }).then(function (result) {\n      var _loop = function _loop(i, _values) {\n        _values = _this6['dy_' + _this6.fields[i]];\n        carIds.forEach(function (carId) {\n          return delete _values[carId];\n        });\n        values = _values;\n      };\n\n      for (var i = 0, values; i < _this6.fields.length; i++) {\n        _loop(i, values);\n      }\n\n      cars.forEach(function (car) {\n        return _this6.owner._tree.updateNodeName(car);\n      });\n    });\n  }\n};",{"version":3,"sources":["D:\\cdRule\\src\\common\\tree\\CarTreeDyField.js"],"names":["ignores","owner","CarTreeDyField","values","v","node","array","$_L","secondsToCnDesc","Number","vv","Math","parseInt","onFieldCheck","listen","Object","o","Message","field","carIds","treeId","check","window","i","addEventListener","setting","resetRoot","destroy","getExpandCars","n","list","ids","Z","onExpand","cars","fields","expand","result","onCollapse"],"mappings":"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","sourcesContent":["import Message from '@/common/Message.js';\r\nimport { secondsToCnDesc } from '@/common/util/Dates.js';\r\n\r\nexport default function CarTreeDyField(owner, getCarById, ignores={}) {\r\n  this.owner = owner;\r\n  this.getCarById = getCarById;\r\n  this.ignores = ignores = ignores || {};\r\n  this.fields = [];\r\n  if (!owner._carTreeCfg.showCarField) return;\r\n  !ignores.acc && owner._carTreeCfg.showCarField.acc && this.onFieldCheck('acc', true);\r\n  !ignores.speed && owner._carTreeCfg.showCarField.speed && this.onFieldCheck('speed', true);\r\n  !ignores.rsl && owner._carTreeCfg.showCarField.rsl && this.onFieldCheck('rsl', true);\r\n  !ignores.ool && owner._carTreeCfg.showCarField.ool && this.onFieldCheck('ool', true);\r\n  !ignores.area && owner._carTreeCfg.showCarField.area  && this.onFieldCheck('area',  true);\r\n}\r\n\r\nCarTreeDyField.prototype = {\r\n  values(array, node) {\r\n    if (!this.owner._carTreeCfg.showCarField) return;\r\n    if (!this.ignores.acc && this.owner._carTreeCfg.showCarField.acc && this.dy_acc) {\r\n      let v = this.dy_acc[node.id];\r\n      v === true && array.push($_L.get('ACC开'));\r\n      v === false && array.push($_L.get('ACC关'));\r\n    }\r\n    if (!this.ignores.speed && this.owner._carTreeCfg.showCarField.speed && this.dy_speed) {\r\n      let v = this.dy_speed[node.id];\r\n      (v > 0 || v === 0) && array.push(v+'km/h');\r\n    }\r\n    if (!this.ignores.rsl && this.owner._carTreeCfg.showCarField.rsl && this.dy_rsl) {\r\n      let v = this.dy_rsl[node.id];\r\n      v && (v.indexOf('+') == 0 ? array.push($_L.get('行')+secondsToCnDesc(Number(v))) : array.push($_L.get('停')+secondsToCnDesc(-Number(v))));\r\n    }\r\n    if (!this.ignores.ool && this.owner._carTreeCfg.showCarField.ool && this.dy_ool) {\r\n      let v = this.dy_ool[node.id];\r\n      if (v) {\r\n        let vv = Math.abs(Number(v));\r\n        vv = vv > 86400 ? parseInt(vv / 3600) * 3600 : vv > 3600 ? parseInt(vv / 60) * 60 : vv;\r\n        v.indexOf('+') == 0 ? array.push($_L.get('连上')+secondsToCnDesc(vv)) : array.push($_L.get('断开')+secondsToCnDesc(vv));\r\n      }\r\n    }\r\n    if (!this.ignores.area && this.owner._carTreeCfg.showCarField.area && this.dy_area) {\r\n      let v = this.dy_area[node.id];\r\n      v && array.push(v);\r\n    }\r\n  },\r\n\r\n  onFieldCheck(field, check) {\r\n    if (check) {\r\n      this.fields.push(field);\r\n      let values = this['dy_'+field] = {};\r\n      let listen = this['dy_'+field+'_listen'] = o => {\r\n        Object.assign(values, o);\r\n        Object.keys(o).forEach(carId=>{\r\n          o = this.getCarById(carId);\r\n          o && this.owner._tree.updateNodeName(o);\r\n        });\r\n      };\r\n      Message.addListener(Message[field.toUpperCase()], listen);\r\n      if (this.owner._tree) {\r\n        let carIds = [];\r\n        this.getExpandCars(this.owner._tree.getNodes()[0], [], carIds);\r\n        carIds.length && window.$_main.http.post('mnt/car?field', {treeId:this.owner.treeId, field:field, check:true, carIds:carIds}).then(listen);\r\n      }\r\n    } else {\r\n      window.$_main.http.post('mnt/car?field', {treeId:this.owner.treeId, field:field, check:false});\r\n      let i = this.fields.indexOf(field);\r\n      i != -1 && this.fields.splice(i, 1);\r\n      delete this['dy_'+field];\r\n      Message.removeListener(Message[field.toUpperCase()], this['dy_'+field+'_listen']);\r\n      delete this['dy_'+field+'_listen'];\r\n    }\r\n  },\r\n\r\n  addEventListener(setting) {\r\n    this.__onExpand = this.__onExpand || setting.callback.onExpand;\r\n    setting.callback.onExpand = this.onExpand.bind(this);\r\n    this.__onCollapse = this.__onCollapse || setting.callback.onCollapse;\r\n    setting.callback.onCollapse = this.onCollapse.bind(this);\r\n  },\r\n\r\n  resetRoot(root) {\r\n    this.fields && this.fields.length && window.$_main.http.post('mnt/car?clear', this.owner.treeId).then(()=>{\r\n      this.onExpand(root);\r\n    });\r\n  },\r\n\r\n  destroy() {\r\n    if (this.fields && this.fields.length) {\r\n      this.fields.forEach(field => {\r\n        delete this['dy_'+field];\r\n        Message.removeListener(Message[field.toUpperCase()], this['dy_'+field+'_listen']);\r\n        delete this['dy_'+field+'_listen'];\r\n      });\r\n      window.$_main.http.post('/mnt/car?clear', this.owner.treeId);\r\n    }\r\n    this.fields = null;\r\n    this.owner = null;\r\n  },\r\n\r\n  getExpandCars(node, list, ids) {\r\n    node && node.children && node.children.forEach(n => {\r\n      if (n.plate) { list.push(n); ids.push(n.id); return ; }\r\n      let Z = n[this.owner.treeId];\r\n      Z && Z.open && this.getExpandCars(n, list, ids);\r\n    });\r\n  },\r\n\r\n  onExpand(node, event) {\r\n    this.__onExpand && this.__onExpand(node, event);\r\n    if (this.fields.length == 0) return;\r\n    let cars = [], carIds = [];\r\n    this.getExpandCars(node, cars, carIds);\r\n    carIds.length && window.$_main.http.post('/mnt/car?toogle',{treeId:this.owner.treeId, fields:this.fields, expand:true, carIds:carIds}).then(result => {\r\n      this.fields.forEach((field, i) => Object.assign(this['dy_'+field], result[i]));\r\n      cars.forEach(car => this.owner._tree.updateNodeName(car));\r\n    });\r\n  },\r\n\r\n  onCollapse(node, event) {\r\n    this.__onCollapse && this.__onCollapse(node, event);\r\n    if (this.fields.length == 0) return;\r\n    let cars = [], carIds = [];\r\n    this.getExpandCars(node, cars, carIds);\r\n    carIds.length && window.$_main.http.post('/mnt/car?toogle',{treeId:this.owner.treeId, fields:this.fields, expand:false, carIds:carIds}).then(result => {\r\n      for (let i=0, values; i<this.fields.length; i++) {\r\n        values = this['dy_'+this.fields[i]];\r\n        carIds.forEach(carId => delete values[carId]);\r\n      }\r\n      cars.forEach(car => this.owner._tree.updateNodeName(car));\r\n    });\r\n  },\r\n}\r\n"]}]}