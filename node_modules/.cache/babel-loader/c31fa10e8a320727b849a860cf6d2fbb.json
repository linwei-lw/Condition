{"remainingRequest":"D:\\cdRule\\node_modules\\thread-loader\\dist\\cjs.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js!D:\\cdRule\\src\\components\\Table\\keyboard\\src\\mixin.js","dependencies":[{"path":"D:\\cdRule\\src\\components\\Table\\keyboard\\src\\mixin.js","mtime":1635230121761},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.string.fixed\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.string.fixed\";\nimport XEUtils from 'xe-utils';\nimport { DomTools } from '../../tools';\nimport { browse } from '../../tools/src/dom';\n\nfunction getTargetOffset(target, container) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n  const triggerCheckboxLabel = !browse.firefox && DomTools.hasClass(target, 'vxe-checkbox--label');\n\n  if (triggerCheckboxLabel) {\n    const checkboxLabelStyle = getComputedStyle(target);\n    offsetTop -= XEUtils.toNumber(checkboxLabelStyle.paddingTop);\n    offsetLeft -= XEUtils.toNumber(checkboxLabelStyle.paddingLeft);\n  }\n\n  while (target && target !== container) {\n    offsetTop += target.offsetTop;\n    offsetLeft += target.offsetLeft;\n    target = target.offsetParent;\n\n    if (triggerCheckboxLabel) {\n      const checkboxStyle = getComputedStyle(target);\n      offsetTop -= XEUtils.toNumber(checkboxStyle.paddingTop);\n      offsetLeft -= XEUtils.toNumber(checkboxStyle.paddingLeft);\n    }\n  }\n\n  return {\n    offsetTop,\n    offsetLeft\n  };\n}\n\nfunction getCheckboxRangeRows(_vm, params, targetTrElem, moveRange) {\n  let countHeight = 0;\n  let rangeRows = [];\n  const isDown = moveRange > 0;\n  const moveSize = moveRange > 0 ? moveRange : Math.abs(moveRange) + targetTrElem.offsetHeight;\n  const afterFullData = _vm.afterFullData,\n        scrollYStore = _vm.scrollYStore,\n        scrollYLoad = _vm.scrollYLoad;\n\n  if (scrollYLoad) {\n    const _rowIndex = _vm.getVTRowIndex(params.row);\n\n    if (isDown) {\n      rangeRows = afterFullData.slice(_rowIndex, _rowIndex + Math.ceil(moveSize / scrollYStore.rowHeight));\n    } else {\n      rangeRows = afterFullData.slice(_rowIndex - Math.floor(moveSize / scrollYStore.rowHeight) + 1, _rowIndex + 1);\n    }\n  } else {\n    const siblingProp = isDown ? 'next' : 'previous';\n\n    while (targetTrElem && countHeight < moveSize) {\n      rangeRows.push(_vm.getRowNode(targetTrElem).item);\n      countHeight += targetTrElem.offsetHeight;\n      targetTrElem = targetTrElem[`${siblingProp}ElementSibling`];\n    }\n  }\n\n  return rangeRows;\n}\n\nexport default {\n  methods: {\n    // 处理 Tab 键移动\n    moveTabSelected(args, isLeft, evnt) {\n      const afterFullData = this.afterFullData,\n            visibleColumn = this.visibleColumn,\n            editConfig = this.editConfig,\n            editOpts = this.editOpts;\n      let targetRow;\n      let targetRowIndex;\n      let targetColumnIndex;\n      const params = Object.assign({}, args);\n\n      const _rowIndex = this.getVTRowIndex(params.row);\n\n      const _columnIndex = this.getVTColumnIndex(params.column);\n\n      evnt.preventDefault();\n\n      if (isLeft) {\n        // 向左\n        if (_columnIndex <= 0) {\n          // 如果已经是第一列，则移动到上一行\n          if (_rowIndex > 0) {\n            targetRowIndex = _rowIndex - 1;\n            targetRow = afterFullData[targetRowIndex];\n            targetColumnIndex = visibleColumn.length - 1;\n          }\n        } else {\n          targetColumnIndex = _columnIndex - 1;\n        }\n      } else {\n        if (_columnIndex >= visibleColumn.length - 1) {\n          // 如果已经是第一列，则移动到上一行\n          if (_rowIndex < afterFullData.length - 1) {\n            targetRowIndex = _rowIndex + 1;\n            targetRow = afterFullData[targetRowIndex];\n            targetColumnIndex = 0;\n          }\n        } else {\n          targetColumnIndex = _columnIndex + 1;\n        }\n      }\n\n      const targetColumn = visibleColumn[targetColumnIndex];\n\n      if (targetColumn) {\n        if (targetRow) {\n          params.rowIndex = targetRowIndex;\n          params.row = targetRow;\n        } else {\n          params.rowIndex = _rowIndex;\n        }\n\n        params.columnIndex = targetColumnIndex;\n        params.column = targetColumn;\n        params.cell = this.getCell(params.row, params.column);\n\n        if (editConfig) {\n          if (editOpts.trigger === 'click' || editOpts.trigger === 'dblclick') {\n            if (editOpts.mode === 'row') {\n              this.handleActived(params, evnt);\n            } else {\n              this.scrollToRow(params.row, params.column).then(() => this.handleSelected(params, evnt));\n            }\n          }\n        } else {\n          this.scrollToRow(params.row, params.column).then(() => this.handleSelected(params, evnt));\n        }\n      }\n    },\n\n    // 处理当前行方向键移动\n    moveCurrentRow(isUpArrow, isDwArrow, evnt) {\n      const currentRow = this.currentRow,\n            treeConfig = this.treeConfig,\n            treeOpts = this.treeOpts,\n            afterFullData = this.afterFullData;\n      let targetRow;\n      evnt.preventDefault();\n\n      if (currentRow) {\n        if (treeConfig) {\n          const _XEUtils$findTree = XEUtils.findTree(afterFullData, item => item === currentRow, treeOpts),\n                index = _XEUtils$findTree.index,\n                items = _XEUtils$findTree.items;\n\n          if (isUpArrow && index > 0) {\n            targetRow = items[index - 1];\n          } else if (isDwArrow && index < items.length - 1) {\n            targetRow = items[index + 1];\n          }\n        } else {\n          const _rowIndex = this.getVTRowIndex(currentRow);\n\n          if (isUpArrow && _rowIndex > 0) {\n            targetRow = afterFullData[_rowIndex - 1];\n          } else if (isDwArrow && _rowIndex < afterFullData.length - 1) {\n            targetRow = afterFullData[_rowIndex + 1];\n          }\n        }\n      } else {\n        targetRow = afterFullData[0];\n      }\n\n      if (targetRow) {\n        const params = {\n          $table: this,\n          row: targetRow\n        };\n        this.scrollToRow(targetRow).then(() => this.triggerCurrentRowEvent(evnt, params));\n      }\n    },\n\n    // 处理可编辑方向键移动\n    moveSelected(args, isLeftArrow, isUpArrow, isRightArrow, isDwArrow, evnt) {\n      const afterFullData = this.afterFullData,\n            visibleColumn = this.visibleColumn;\n      const params = Object.assign({}, args);\n\n      const _rowIndex = this.getVTRowIndex(params.row);\n\n      const _columnIndex = this.getVTColumnIndex(params.column);\n\n      evnt.preventDefault();\n\n      if (isUpArrow && _rowIndex > 0) {\n        // 移动到上一行\n        params.rowIndex = _rowIndex - 1;\n        params.row = afterFullData[params.rowIndex];\n      } else if (isDwArrow && _rowIndex < afterFullData.length - 1) {\n        // 移动到下一行\n        params.rowIndex = _rowIndex + 1;\n        params.row = afterFullData[params.rowIndex];\n      } else if (isLeftArrow && _columnIndex) {\n        // 移动到左侧单元格\n        params.columnIndex = _columnIndex - 1;\n        params.column = visibleColumn[params.columnIndex];\n      } else if (isRightArrow && _columnIndex < visibleColumn.length - 1) {\n        // 移动到右侧单元格\n        params.columnIndex = _columnIndex + 1;\n        params.column = visibleColumn[params.columnIndex];\n      }\n\n      this.scrollToRow(params.row, params.column).then(() => {\n        params.cell = this.getCell(params.row, params.column);\n        this.handleSelected(params, evnt);\n      });\n    },\n\n    /**\r\n     * 表头单元格按下事件\r\n     */\n    triggerHeaderCellMousedownEvent(evnt, params) {\n      const mouseConfig = this.mouseConfig,\n            mouseOpts = this.mouseOpts;\n\n      if (mouseConfig && mouseOpts.area && this.handleHeaderCellAreaEvent) {\n        const cell = evnt.currentTarget;\n        const triggerSort = DomTools.getEventTargetNode(evnt, cell, 'vxe-cell--sort').flag;\n        const triggerFilter = DomTools.getEventTargetNode(evnt, cell, 'vxe-cell--filter').flag;\n        this.handleHeaderCellAreaEvent(evnt, Object.assign({\n          cell,\n          triggerSort,\n          triggerFilter\n        }, params));\n      }\n\n      this.focus();\n      this.closeMenu();\n    },\n\n    /**\r\n     * 单元格按下事件\r\n     */\n    triggerCellMousedownEvent(evnt, params) {\n      const cell = evnt.currentTarget;\n      params.cell = cell;\n      this.handleCellMousedownEvent(evnt, params);\n      this.focus();\n      this.closeFilter();\n      this.closeMenu();\n    },\n\n    handleCellMousedownEvent(evnt, params) {\n      const editConfig = this.editConfig,\n            editOpts = this.editOpts,\n            handleSelected = this.handleSelected,\n            checkboxConfig = this.checkboxConfig,\n            checkboxOpts = this.checkboxOpts,\n            mouseConfig = this.mouseConfig,\n            mouseOpts = this.mouseOpts;\n\n      if (mouseConfig && mouseOpts.area && this.handleCellAreaEvent) {\n        return this.handleCellAreaEvent(evnt, params);\n      } else {\n        if (checkboxConfig && checkboxOpts.range) {\n          this.handleCheckboxRangeEvent(evnt, params);\n        }\n\n        if (mouseConfig && mouseOpts.selected) {\n          if (!editConfig || editOpts.mode === 'cell') {\n            handleSelected(params, evnt);\n          }\n        }\n      }\n    },\n\n    handleCheckboxRangeEvent(evnt, params) {\n      const column = params.column,\n            cell = params.cell;\n\n      if (column.type === 'checkbox') {\n        const $el = this.$el,\n              elemStore = this.elemStore;\n        const disX = evnt.clientX;\n        const disY = evnt.clientY;\n        const bodyWrapperElem = elemStore[`${column.fixed || 'main'}-body-wrapper`] || elemStore['main-body-wrapper'];\n        const checkboxRangeElem = bodyWrapperElem.querySelector('.vxe-table--checkbox-range');\n        const domMousemove = document.onmousemove;\n        const domMouseup = document.onmouseup;\n        const trElem = cell.parentNode;\n        const selectRecords = this.getCheckboxRecords();\n        let lastRangeRows = [];\n        const marginSize = 1;\n        const offsetRest = getTargetOffset(evnt.target, bodyWrapperElem);\n        const startTop = offsetRest.offsetTop + evnt.offsetY;\n        const startLeft = offsetRest.offsetLeft + evnt.offsetX;\n        const startScrollTop = bodyWrapperElem.scrollTop;\n        const rowHeight = trElem.offsetHeight;\n        let mouseScrollTimeout = null;\n        let isMouseScrollDown = false;\n        let mouseScrollSpaceSize = 1;\n\n        const triggerEvent = (type, evnt) => {\n          this.emitEvent(`checkbox-range-${type}`, {\n            records: this.getCheckboxRecords(),\n            reserves: this.getCheckboxReserveRecords()\n          }, evnt);\n        };\n\n        const handleChecked = evnt => {\n          const clientX = evnt.clientX,\n                clientY = evnt.clientY;\n          const offsetLeft = clientX - disX;\n          const offsetTop = clientY - disY + (bodyWrapperElem.scrollTop - startScrollTop);\n          let rangeHeight = Math.abs(offsetTop);\n          let rangeWidth = Math.abs(offsetLeft);\n          let rangeTop = startTop;\n          let rangeLeft = startLeft;\n\n          if (offsetTop < marginSize) {\n            // 向上\n            rangeTop += offsetTop;\n\n            if (rangeTop < marginSize) {\n              rangeTop = marginSize;\n              rangeHeight = startTop;\n            }\n          } else {\n            // 向下\n            rangeHeight = Math.min(rangeHeight, bodyWrapperElem.scrollHeight - startTop - marginSize);\n          }\n\n          if (offsetLeft < marginSize) {\n            // 向左\n            rangeLeft += offsetLeft;\n\n            if (rangeWidth > startLeft) {\n              rangeLeft = marginSize;\n              rangeWidth = startLeft;\n            }\n          } else {\n            // 向右\n            rangeWidth = Math.min(rangeWidth, bodyWrapperElem.clientWidth - startLeft - marginSize);\n          }\n\n          checkboxRangeElem.style.height = `${rangeHeight}px`;\n          checkboxRangeElem.style.width = `${rangeWidth}px`;\n          checkboxRangeElem.style.left = `${rangeLeft}px`;\n          checkboxRangeElem.style.top = `${rangeTop}px`;\n          checkboxRangeElem.style.display = 'block';\n          const rangeRows = getCheckboxRangeRows(this, params, trElem, offsetTop < marginSize ? -rangeHeight : rangeHeight); // 至少滑动 10px 才能有效匹配\n\n          if (rangeHeight > 10 && rangeRows.length !== lastRangeRows.length) {\n            lastRangeRows = rangeRows;\n\n            if (evnt.ctrlKey) {\n              rangeRows.forEach(row => {\n                this.handleSelectRow({\n                  row\n                }, selectRecords.indexOf(row) === -1);\n              });\n            } else {\n              this.setAllCheckboxRow(false);\n              this.setCheckboxRow(rangeRows, true);\n            }\n\n            triggerEvent('change', evnt);\n          }\n        }; // 停止鼠标滚动\n\n\n        const stopMouseScroll = () => {\n          clearTimeout(mouseScrollTimeout);\n          mouseScrollTimeout = null;\n        }; // 开始鼠标滚动\n\n\n        const startMouseScroll = evnt => {\n          stopMouseScroll();\n          mouseScrollTimeout = setTimeout(() => {\n            if (mouseScrollTimeout) {\n              const scrollLeft = bodyWrapperElem.scrollLeft,\n                    scrollTop = bodyWrapperElem.scrollTop,\n                    clientHeight = bodyWrapperElem.clientHeight,\n                    scrollHeight = bodyWrapperElem.scrollHeight;\n              const topSize = Math.ceil(mouseScrollSpaceSize * 50 / rowHeight);\n\n              if (isMouseScrollDown) {\n                if (scrollTop + clientHeight < scrollHeight) {\n                  this.scrollTo(scrollLeft, scrollTop + topSize);\n                  startMouseScroll(evnt);\n                  handleChecked(evnt);\n                } else {\n                  stopMouseScroll();\n                }\n              } else {\n                if (scrollTop) {\n                  this.scrollTo(scrollLeft, scrollTop - topSize);\n                  startMouseScroll(evnt);\n                  handleChecked(evnt);\n                } else {\n                  stopMouseScroll();\n                }\n              }\n            }\n          }, 50);\n        };\n\n        DomTools.addClass($el, 'drag--range');\n\n        document.onmousemove = evnt => {\n          evnt.preventDefault();\n          evnt.stopPropagation();\n          const clientY = evnt.clientY;\n\n          const _DomTools$getAbsolute = DomTools.getAbsolutePos(bodyWrapperElem),\n                boundingTop = _DomTools$getAbsolute.boundingTop; // 如果超过可视区，触发滚动\n\n\n          if (clientY < boundingTop) {\n            isMouseScrollDown = false;\n            mouseScrollSpaceSize = boundingTop - clientY;\n\n            if (!mouseScrollTimeout) {\n              startMouseScroll(evnt);\n            }\n          } else if (clientY > boundingTop + bodyWrapperElem.clientHeight) {\n            isMouseScrollDown = true;\n            mouseScrollSpaceSize = clientY - boundingTop - bodyWrapperElem.clientHeight;\n\n            if (!mouseScrollTimeout) {\n              startMouseScroll(evnt);\n            }\n          } else if (mouseScrollTimeout) {\n            stopMouseScroll();\n          }\n\n          handleChecked(evnt);\n        };\n\n        document.onmouseup = evnt => {\n          stopMouseScroll();\n          DomTools.removeClass($el, 'drag--range');\n          checkboxRangeElem.removeAttribute('style');\n          document.onmousemove = domMousemove;\n          document.onmouseup = domMouseup;\n          triggerEvent('end', evnt);\n        };\n\n        triggerEvent('start', evnt);\n      }\n    }\n\n  }\n};",null]}