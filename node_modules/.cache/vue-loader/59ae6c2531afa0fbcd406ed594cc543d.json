{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\common\\tree\\CarGroupSetWindow.vue?vue&type=style&index=0&module=true&lang=css&","dependencies":[{"path":"D:\\cdRule\\src\\common\\tree\\CarGroupSetWindow.vue","mtime":1677658521330},{"path":"D:\\cdRule\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.content {\n  padding: 5px 0 0 5px;\n}\n.content > * {\n  margin: 0 5px 5px 0;\n  width: calc(100% - 5px);\n  float: left;\n}\n",{"version":3,"sources":["CarGroupSetWindow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CarGroupSetWindow.vue","sourceRoot":"src/common/tree","sourcesContent":["<template>\r\n  <Window :title=\"$_L.get('车辆分组管理')\" :width=\"600\" ref=\"w\" :waiting=\"waiting\">\r\n    <div :class=\"$style.content\" style=\"position:relative;\">\r\n      <Panel :title=\"$_L.get('车辆分组列表')\" :disabled=\"!listable\" style=\"width:200px;\" :style=\"[theme.panel, {height:height+'px',borderRadius:theme.popup_radius}]\">\r\n        <List ref=\"list\" :border=\"false\" :list=\"groups\" labelField=\"name\" @click=\"onGroupClick\" :style=\"{height:(height-79)+'px'}\" style=\"width:100%;background-color:#fff;\"/>\r\n        <Toolbar small :border=\"false\" :bgc=\"theme.bg_color\" style=\"position:absolute;bottom:0;left:0\">\r\n          <Button type=\"primary\" style=\"flex-grow:1\" icon=\"el-icon-plus\"  @click=\"addClick()\">{{$_L.get('新增')}}</Button>\r\n          <Button type=\"primary\" style=\"flex-grow:1\" icon=\"el-icon-minus\" @click=\"delClick()\" :disabled=\"!delable\">{{$_L.get('删除')}}</Button>\r\n        </Toolbar>\r\n      </Panel>\r\n      <Panel :title=\"$_L.get('车辆分组参数')\" :disabled=\"!savable\" style=\"width:385px;\" :style=\"[theme.panel, {height:height+'px',borderRadius:theme.popup_radius}]\">\r\n        <InputText :label=\"$_L.get('分组名称')\" trim v-model=\"name\" :reg=\"/\\|/g\" required style=\"margin:5px;width:calc(100% - 10px)\"/>\r\n        <CarTree ref=\"tree\" :border=\"false\" :setting=\"{favshow:false,favset:false,groupshow:false,groupset:false,check:{enable:true},view:{hideFunction:hideFunction}}\" style=\"margin:0 5px 5px 5px;width:calc(100% - 10px)\" :style=\"{height:(height-129)+'px'}\" :toolbarStyle=\"{borderBottom:0,backgroundColor:'#fff',padding:'1px 0',margin:'0 -5px', width:'calc(100% + 10px)'}\"/>\r\n        <Toolbar small :border=\"false\" :bgc=\"theme.bg_color\" :leftStyle=\"{justifyContent:'center'}\" style=\"position:absolute;bottom:0;left:0\">\r\n          <Button style=\"min-width:90px;\" v-if=\"!listable\" @click=\"listable=true\">{{$_L.get('取消')}}</Button>\r\n          <Button type=\"primary\" style=\"min-width:90px;\" @click=\"saveClick()\">{{$_L.get('保存')}}</Button>\r\n        </Toolbar>\r\n      </Panel>\r\n    </div>\r\n  </Window>\r\n</template>\r\n\r\n<script>\r\n  import { getCarById, resetGroupTree } from '@/common/cache/CacheTeamCar.js';\r\n  import { arrayRemoveItem } from '@/common/util/Arrays.js';\r\n\r\n  export default {\r\n    components: {\r\n      CarTree: () => import('@/common/tree/CarTree.vue' /*webpackChunkName:'CarTree'*/),\r\n    },\r\n    data: function() {\r\n      return {\r\n        groups: [],\r\n        name: null,\r\n        waiting: false,\r\n        height: 0,\r\n        listable: false,\r\n        savable: false,\r\n        delable: false,\r\n      };\r\n    },\r\n    created() {\r\n      this.height = document.body.clientHeight * 5 / 6 - 100;\r\n    },\r\n    mounted() {\r\n      let groups = window.$_cache.userCfg.GROUP_CAR;//[name|carId,carId...]\r\n      groups && (groups = JSON.parse(groups));\r\n      if (groups) {\r\n        groups.forEach(str=>{\r\n          str = str.split('|');\r\n          this.groups.push({name:str[0], carIds:str[1].split(',')});\r\n        });\r\n      }\r\n      this.listable = true;\r\n    },\r\n\r\n    methods: {\r\n      onGroupClick(item) {\r\n        this._group = item;\r\n        this.savable = this.delable = true;\r\n        this.name = item.name;\r\n        this.$refs.tree.getTree().checkAllNodes(false);\r\n        if (item.carIds.length > 0) {\r\n          let cars = [];\r\n          item.carIds.forEach(carId => {\r\n            let car = getCarById(carId);\r\n            car && cars.push(car);\r\n          });\r\n          cars.length && this.$refs.tree.checkNodes(cars, true, true, true);\r\n        }\r\n        this.refreshHide();\r\n      },\r\n      refreshHide() {\r\n        let tree = this.$refs.tree.getTree();\r\n        for (let i=0, len=this.groups.length, g; i<len; i++) {\r\n          g = this.groups[i];\r\n          g.carIds.forEach(carId => {\r\n            let car = getCarById(carId);\r\n            car && tree.updateNodeHide(car);\r\n          });\r\n        }\r\n      },\r\n      hideFunction(node) {\r\n        if (!node.plate) return false;\r\n        for (let i=0, len=this.groups.length, g; i<len; i++) {\r\n          g = this.groups[i];\r\n          if (g != this._group && g.carIds.indexOf(node.id) != -1) return true;\r\n        }\r\n        return false;\r\n      },\r\n      addClick() {\r\n        this.savable = true;\r\n        this.delable = false;\r\n        this.listable = false;\r\n        this.$refs.list.selectedItem = this._group = null;\r\n        this.name = null;\r\n        this.$refs.tree.getTree().checkAllNodes(false);\r\n        this.refreshHide();\r\n      },\r\n      delClick() {\r\n        $_alert.comfirm($_L.get('确认要删除选中的车辆分组吗？'), yes => {\r\n          if (!yes) return;\r\n          let item = this.$refs.list.selectedItem, items = [];\r\n          this.groups.forEach(group => group != item && items.push(group.name+'|'+group.carIds.join(',')));\r\n          items = JSON.stringify(items);\r\n          window.$_main.http.post('sys/user?updateUserCfg',{item:'GROUP_CAR',value:items}).then(result => {\r\n            $_alert.success($_L.get('删除成功'));\r\n            window.$_cache.userCfg.GROUP_CAR = items;\r\n            resetGroupTree();\r\n            arrayRemoveItem(this.groups, item);\r\n            this.savable = this.delable = false;\r\n            this.name = this._group = null;\r\n            this.$refs.tree.getTree().checkAllNodes(false);\r\n            this.refreshHide();\r\n          });\r\n        });\r\n      },\r\n      saveClick() {\r\n        if (!this.name) return $_alert.warn($_L.get('请填写{0}', $_L.get('分组名称')), this.$el);\r\n        let carIds = this.$refs.tree.getCheckedNodes(false, false, 'id', 'plate');\r\n        if (!carIds || carIds.length == 0) return $_alert.warn($_L.get('请勾选车辆！'), this.$el);\r\n        if (carIds.length > 100) return $_alert.warn($_L.get('勾选的车辆数不能超过100个！'), this.$el);\r\n        let item = this.$refs.list.selectedItem, items = [], nameExist = false;\r\n        this.groups.forEach(group => {\r\n          group != item && (items.push(group.name+'|'+group.carIds.join(',')), nameExist=nameExist||group.name==this.name);\r\n        });\r\n        if (nameExist) return $_alert.warn($_L.get('存在相同的分组名称！'), this.$el);\r\n        items.push(this.name+'|'+carIds.join(','));\r\n        items = JSON.stringify(items);\r\n        let o = {name:this.name, carIds:carIds};\r\n        window.$_main.http.post('sys/user?updateUserCfg',{item:'GROUP_CAR',value:items}).then(result => {\r\n          $_alert.success(item?$_L.get('修改成功'):$_L.get('新增成功'));\r\n          window.$_cache.userCfg.GROUP_CAR = items;\r\n          resetGroupTree();\r\n          !item ? this.groups.push(o) : (item.name=o.name, item.carIds=o.carIds);\r\n          this.$refs.list.selectedItem = this._group = item || o;\r\n          this.savable = this.delable = this.listable = true;\r\n          this.refreshHide();\r\n        });\r\n      },\r\n    }\r\n  };\r\n</script>\r\n\r\n<style module>\r\n  .content {\r\n    padding: 5px 0 0 5px;\r\n  }\r\n  .content > * {\r\n    margin: 0 5px 5px 0;\r\n    width: calc(100% - 5px);\r\n    float: left;\r\n  }\r\n</style>\r\n"]}]}