{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\common\\tree\\CarTreeToolbar.vue?vue&type=style&index=0&module=true&lang=css&","dependencies":[{"path":"D:\\cdRule\\src\\common\\tree\\CarTreeToolbar.vue","mtime":1612227987723},{"path":"D:\\cdRule\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.setter {\n  width: 260px;\n  position: fixed;\n  margin: 0;\n  background-color: #fff;\n  border-width: 1px;\n  border-style: solid;\n  box-shadow: 0px 0px 5px 0px RGBA(0, 0, 0, 0.1);\n  overflow: hidden;\n}\n.setter > * {\n  background-position: 10px center!important;\n  padding-left: 10px!important;\n  margin-bottom: -1px;\n  height: 30px;\n  float: left;\n}\n.title {\n  width: 100%;\n  background-color: #E8EAED;\n}\n.item {\n  width: calc(33% + 1.5px);\n  border-left-width: 1px;\n  border-left-style: solid;\n  border-left-color: #E8EAED;\n  border-bottom-width: 1px;\n  border-bottom-style: solid;\n  border-bottom-color: #E8EAED;\n  margin-left: -1px;\n  overflow: hidden;\n  text-overflow:ellipsis;\n}\n",{"version":3,"sources":["CarTreeToolbar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CarTreeToolbar.vue","sourceRoot":"src/common/tree","sourcesContent":["\r\n<template>\r\n  <Toolbar :border=\"false\" small :mini=\"mini\" :style=\"[simple?{padding:'0'}:{borderBottom:'1px solid',borderColor:theme.border_color_light}]\">\r\n      <Button type=\"light\" style=\"padding:2px 0 0 0;\" icon=\"el-icon-search\" :height=\"hw\" :style=\"{width:`${hw}px`,borderColor:simple?theme.border_color_dark:theme.border_color_light}\" @click=\"searchSet.show=!searchSet.show\"/>\r\n      <SearchBox \r\n        ref=\"searchBox\"\r\n        style=\"margin-left:-1px\" \r\n        :style=\"{width:`calc(100% - ${mini?(simple?26:84):(simple?31:103)}px`}\" \r\n        :height=\"hw\" \r\n        border\r\n        :borderColor=\"simple?theme.border_color_dark:theme.border_color_light\"\r\n        :treeBorder=\"treeBorder\" \r\n        :showSearchIcon=\"false\" \r\n        :placeholder=\"placeholder\" \r\n        :hasOwnField=\"hasOwnField\" \r\n        :searchFun=\"searchFun\" \r\n        :onItemSelected=\"onSearchItemSelected\"\r\n        @blankinput=\"showRecent\"\r\n        @blankclick=\"showRecent\"\r\n      />\r\n      <Button v-if=\"!simple\" type=\"light\" style=\"margin-left:-1px;padding:2px 0 0 0;\" :height=\"hw\" :style=\"{width:`${hw}px`}\" icon=\"el-icon-refresh-right\" :disabled=\"model=='fav'\" @click=\"refreshClick\"/>\r\n      <Button v-if=\"!simple\" type=\"light\" style=\"margin-left:-1px;padding:2px 0 0 0;\" :height=\"hw\" :style=\"{width:`${hw}px`}\" icon=\"el-icon-setting\" @click=\"renderSet.show=!renderSet.show\"/>\r\n\r\n      <div ref=\"searchSet\" :class=\"$style.setter\" v-if=\"searchSet.show\" :style=\"{left:searchSet.left+'px',top:searchSet.top+'px',zIndex:searchSet.show && theme.zindex(), borderColor:theme.border_color_light}\">\r\n        <div :class=\"$style.title\" style=\"line-height:30px\"> 车辆搜索选项 </div>\r\n        <Checkbox label=\"车牌号码\" :class=\"$style.item\" val=\"plate\"   v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\"/>\r\n        <Checkbox label=\"车辆名称\" :class=\"$style.item\" val=\"carname\" v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\"/>\r\n        <Checkbox label=\"终端标识\" :class=\"$style.item\" val=\"tmnKey\"  v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\"/>\r\n        \r\n        <div :class=\"$style.title\" style=\"line-height:30px\"> 车队搜索选项 </div>\r\n        <Checkbox label=\"车队名称\" :class=\"$style.item\" val=\"teamname\" v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\"/>\r\n        <Checkbox label=\"联系人员\" :class=\"$style.item\" val=\"linkman\"  v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\"/>\r\n        <Checkbox label=\"联系电话\" :class=\"$style.item\" val=\"phone\"    v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\"/>\r\n      </div>\r\n\r\n      <div ref=\"renderSet\" :class=\"$style.setter\" v-if=\"renderSet.show\" :style=\"{left:renderSet.left+'px', top:renderSet.top+'px', zIndex:renderSet.show && theme.zindex(), borderColor:theme.border_color_light}\">\r\n        <div :class=\"$style.title\" style=\"line-height:30px;\"> 统计显示 </div>\r\n        <Checkbox :disabled=\"model=='fav'\" label=\"在线统计\" :class=\"$style.item\" v-model=\"showTeamCount.line\" @change=\"setTeamCount('line')\" />\r\n        <Checkbox :disabled=\"model=='fav'\" label=\"行停统计\" :class=\"$style.item\" v-model=\"showTeamCount.move\" @change=\"setTeamCount('move')\"/>\r\n        <Checkbox :disabled=\"model=='fav'\" label=\"报警统计\" :class=\"$style.item\" v-model=\"showTeamCount.alarm\" @change=\"setTeamCount('alarm')\"/>\r\n        <Checkbox :disabled=\"model=='fav'\" label=\"无效统计\" :class=\"$style.item\" v-model=\"showTeamCount.invalid\" @change=\"setTeamCount('invalid')\"/>\r\n        \r\n        <div :class=\"$style.title\" style=\"line-height:30px;\"> 车辆显示 </div>\r\n        <Radio    label=\"车牌号码\" :class=\"$style.item\" :name=\"`car_${uuid}`\" true=\"plate\" v-model=\"carTreeCfg.sortField\" @change=\"carSortFieldChg\"/>\r\n        <Radio    label=\"车辆名称\" :class=\"$style.item\" :name=\"`car_${uuid}`\" true=\"name\"  v-model=\"carTreeCfg.sortField\" @change=\"carSortFieldChg\"/>\r\n        <Checkbox label=\"终端标识\" :class=\"$style.item\" val=\"tmnKey\" v-model=\"showCarField\" @change=\"showCarFieldChg('tmnKey')\"/>\r\n        <Checkbox label=\"车辆状态\" :class=\"$style.item\" val=\"state\" v-model=\"showCarField\" @change=\"showCarFieldChg('state')\"/>\r\n        \r\n        <div :class=\"$style.title\" style=\"line-height:30px;\"> 车辆过滤 </div>\r\n        <Radio label=\"所有车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" :true=\"false\"  v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"在线车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"online\"  v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"报警车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"alarm\"   v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"行驶车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"move\"    v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"停止车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"stop\"    v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"离线车辆\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"offline\" v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n        <Radio label=\"无效定位\" :class=\"$style.item\" :name=\"`filter_${uuid}`\" true=\"invalid\" v-model=\"carTreeCfg.filter\" @change=\"carFilterChg\"/>\r\n      </div>\r\n\r\n    </Toolbar>\r\n</template>\r\n\r\n<script>\r\n  import SearchBox from \"@/components/Tree/SearchBox.vue\";\r\n\r\n  import { domLeftTop } from '@/components/util/Dom.js';\r\n  import { objCopyTo } from '@/common/util/Objects.js';\r\n  import { objIsEmpty }  from '@/common/util/Objects.js';\r\n  import { Fields } from '@/common/cache/CacheTeamCar.js';\r\n  import { getCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\n  import { saveCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\n  import { countState } from '@/common/cache/CacheTeamCar.js';\r\n  \r\n  export default {\r\n    components: { SearchBox },\r\n    props: {\r\n      setting:    { default: null},\r\n      miniBar:    { type: Boolean, default: false },\r\n      treeBorder: { type: Boolean, default: true  },\r\n      onSearchItemSelected: Function,\r\n      refreshClick: Function,\r\n      onCarFilterChg: Function,\r\n      showRecent: Function,\r\n    },\r\n\r\n    _carFields: null,\r\n    _teamFields: null,\r\n    _tree: null,\r\n    _treeId: null,\r\n\r\n    data() {\r\n      return {\r\n        uuid: $_theme.zindex(),\r\n        placeholder: \"\",\r\n        hasOwnField: null,\r\n        model: false,\r\n        carTreeCfg: {},\r\n        showTeamCount: {line: false, move: false, alarm: false, invalid: false},\r\n        showCarField: [], //['color', 'tmnKey', 'state'], \r\n        searchSet: {show: false, left:0, top:0},\r\n        renderSet: {show: false, left:0, top:0},\r\n        simple: false,\r\n      };\r\n    },\r\n\r\n    computed: {\r\n      hw: function() { return this.miniBar ? 27 : this.theme.inputHeight; },\r\n      mini: function() { return this.miniBar },\r\n    },\r\n\r\n    watch: {\r\n      'searchSet.show': function(v) {\r\n        if (!v) return document.removeEventListener('click', this.clickSearchSet);\r\n        let {left, top} = domLeftTop(this.$el);\r\n        this.searchSet.left = left - 1;\r\n        this.searchSet.top = top + this.$el.clientHeight;\r\n        setTimeout(() => { document.addEventListener('click', this.clickSearchSet); }, 10);\r\n      },\r\n      'renderSet.show': function(v) {\r\n        if (!v) return document.removeEventListener('click', this.clickRenderSet);\r\n        let {left, top} = domLeftTop(this.$el);\r\n        if (left + this.$el.clientWidth + 260 > document.documentElement.clientWidth) {\r\n          left = left + this.$el.clientWidth - 260 + 1;\r\n          top += this.$el.clientHeight;\r\n        } else {\r\n          left = left + this.$el.clientWidth;\r\n          top -= 1;\r\n        }\r\n        this.renderSet.left = left;\r\n        this.renderSet.top = top;\r\n        setTimeout(() => { document.addEventListener('click', this.clickRenderSet); }, 10);\r\n      }\r\n    },\r\n    \r\n    mounted() {\r\n      this.carTreeCfg = getCarTreeCfg();\r\n      this.carTreeCfg.showTeamCount && objCopyTo(this.carTreeCfg.showTeamCount, this.showTeamCount);\r\n      if (this.carTreeCfg.showCarField) {\r\n        this.carTreeCfg.showCarField.tmnKey  && this.showCarField.push('tmnKey');\r\n        this.carTreeCfg.showCarField.state   && this.showCarField.push('state');\r\n      }\r\n    },\r\n\r\n    methods: {\r\n      init() {\r\n        this.setSearchField();\r\n      },\r\n      setTree(tree) {\r\n        this._treeId = tree.setting.treeId;\r\n        this.$refs.searchBox.setTree(this._tree = tree);\r\n      },\r\n      setSearchField() {\r\n        let carFields = this.carTreeCfg.search.carFields, teamFields = this.carTreeCfg.search.teamFields;\r\n        if (carFields.length == 0 && teamFields.length == 0) {\r\n          carFields.push('plate');\r\n        }\r\n        this._carFields = carFields.length > 0 ? carFields : null;\r\n        this._teamFields = teamFields.length > 0 ? teamFields : null;\r\n        this.hasOwnField = this._carFields && this._teamFields ? null : this._carFields ? 'plate' : 'pid';\r\n        let placeholder = [];\r\n        if (this._carFields) {\r\n          this._carFields.indexOf('plate')  > -1 && placeholder.push('车牌号码');\r\n          this._carFields.indexOf('carname') > -1 && placeholder.push('车辆名称');\r\n          this._carFields.indexOf('tmnKey') > -1 && placeholder.push('终端标识');\r\n        }\r\n        if (this._teamFields) {\r\n          this._teamFields.indexOf('teamname') > -1 && placeholder.push('车队名称');\r\n          this._teamFields.indexOf('linkman') > -1 && placeholder.push('联系人员');\r\n          this._teamFields.indexOf('phone')   > -1 && placeholder.push('联系电话');\r\n        }\r\n        this.placeholder = placeholder.join('｜');\r\n      },\r\n      searchFun(node, text) {\r\n        if (node[this._treeId].hide) return false;\r\n        return this.contain(node, text, node.plate ? this._carFields : this._teamFields);\r\n      },\r\n      contain(node, text, fields) {\r\n        if (!fields) return false;\r\n        for (let field of fields) {\r\n          field = (Fields[field] || Fields.bxts)(node, field);\r\n          if (field && field.toLowerCase().indexOf(text) >= 0) return true;\r\n        }\r\n        return false;\r\n      },\r\n      clickSearchSet(event) {\r\n        this.searchSet.show = this.$refs.searchSet.contains(event.target);\r\n      },\r\n      clickRenderSet(event) {\r\n        this.renderSet.show = this.$refs.renderSet.contains(event.target);\r\n      },\r\n      searchSetChg() {\r\n        saveCarTreeCfg();\r\n        this.setSearchField();\r\n      },\r\n      setTeamCount(field) {\r\n        let before = this.carTreeCfg.showTeamCount;\r\n        this._setShowCfg('showTeamCount', field, this.showTeamCount[field]);\r\n        !before && this.carTreeCfg.showTeamCount && countState();\r\n        this.resetTree(this._tree.updateNodeName, false);\r\n      },\r\n      carSortFieldChg() {\r\n        saveCarTreeCfg();\r\n        this.resetTree(this._tree.updateNodeName, true);\r\n      },\r\n      showCarFieldChg(field) {\r\n        this._setShowCfg('showCarField', field, this.showCarField.indexOf(field) != -1);\r\n        this.resetTree(this._tree.updateNodeName, true);\r\n      },\r\n      carFilterChg() {\r\n        saveCarTreeCfg();\r\n        this.onCarFilterChg(this.carTreeCfg.filter);\r\n        this._tree && this.carTreeCfg.filter && (this._tree.setting.view.hideFunction = this.$parent.hideFunction);\r\n        this.resetTree(this._tree.updateNodeHide, true);\r\n        this._tree && !this.carTreeCfg.filter && (this._tree.setting.view.hideFunction = null);\r\n      },\r\n      _setShowCfg(item, key, value) {\r\n        let cfg = this.carTreeCfg[item];\r\n        if (!cfg && !value) return;\r\n        if (!value) {\r\n          cfg && delete cfg[key];\r\n          if (objIsEmpty(cfg)) cfg = false;\r\n        } else {\r\n          cfg = cfg || {};\r\n          cfg[key] = value;\r\n        }\r\n        this.carTreeCfg[item] = cfg;\r\n        saveCarTreeCfg();\r\n      },\r\n      resetTree(method, resetCar, nodes=null) {\r\n        nodes = nodes || this._tree.getNodes();\r\n        for (let i=0,len=nodes.length,node; i<len; i++) {\r\n          node = nodes[i];\r\n          if (!node[this._treeId].dom) continue;\r\n          if (node.plate) {\r\n            resetCar && method(node);\r\n            continue;\r\n          } else if (!resetCar) {\r\n            method(node);\r\n          }\r\n          if (node.children && node.children.length > 0) {\r\n            this.resetTree(method, resetCar, node.children);\r\n          }\r\n        }\r\n      },\r\n      showTip(tip, color) {\r\n        this.$refs.searchBox.clear();\r\n        this.$refs.searchBox.showTip(tip, color);\r\n      },\r\n      destroy() {\r\n        this.$refs.searchBox.clear();\r\n        this.$refs.searchBox.setTree(null);\r\n        this._tree = null;\r\n        this._carFields = null;\r\n        this._teamFields = null;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style module>\r\n  .setter {\r\n    width: 260px;\r\n    position: fixed;\r\n    margin: 0;\r\n    background-color: #fff;\r\n    border-width: 1px;\r\n    border-style: solid;\r\n    box-shadow: 0px 0px 5px 0px RGBA(0, 0, 0, 0.1);\r\n    overflow: hidden;\r\n  }\r\n  .setter > * {\r\n    background-position: 10px center!important;\r\n    padding-left: 10px!important;\r\n    margin-bottom: -1px;\r\n    height: 30px;\r\n    float: left;\r\n  }\r\n  .title {\r\n    width: 100%;\r\n    background-color: #E8EAED;\r\n  }\r\n  .item {\r\n    width: calc(33% + 1.5px);\r\n    border-left-width: 1px;\r\n    border-left-style: solid;\r\n    border-left-color: #E8EAED;\r\n    border-bottom-width: 1px;\r\n    border-bottom-style: solid;\r\n    border-bottom-color: #E8EAED;\r\n    margin-left: -1px;\r\n    overflow: hidden;\r\n    text-overflow:ellipsis;\r\n  }\r\n</style>\r\n"]}]}