{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue","mtime":1685000036289},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport AiAddOrUpdateWindow      from './AiAddOrUpdateWindow.vue';\r\nimport DirAddOrUpdateWindow     from './DirAddOrUpdateWindow.vue';\r\nimport { arrayRemoveItem }      from '@/common/util/Arrays.js';\r\nimport { arrayToMap }           from '@/common/util/Arrays.js';\r\nimport { objClone, objCopyTo }  from '@/common/util/Objects.js';\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      areas:[{name:'黑龙江省'},{name:'辽宁省'},{name:'吉林省'},{name:'河北省'},{name:'河南省'},{name:'湖北省'},{name:'湖南省'},\r\n        {name:'山东省'},{name:'山西省'},{name:'陕西省'},{name:'安徽省'},{name:'浙江省'},{name:'江苏省'},{name:'福建省'},{name:'广东省'},\r\n        {name:'海南省'},{name:'四川省'},{name:'云南省'},{name:'贵州省'},{name:'青海省'},{name:'甘肃省'},{name:'江西省'},{name:'台湾省'},\r\n        {name:'内蒙古自治区'},{name:'宁夏回族自治区'},{name:'新疆维吾尔自治区'},{name:'西藏自治区'},{name:'广西壮族自治区'},\r\n        {name:'北京市'},{name:'上海市'},{name:'天津市'},{name:'重庆市'},{name:'香港特别行政区'},{name:'澳门特别行政区'}],\r\n      datas: [],\r\n      list:[],\r\n      place:[],\r\n      cmpIndex:{id:null},\r\n      selected:null,\r\n      selectedItem:null,\r\n      index:0\r\n    }\r\n  },\r\n\r\n  created(){\r\n  },\r\n  mounted() {\r\n    $_main.http.get('rule/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n      this.list=result;\r\n    })\r\n    this.getPlace()\r\n  },\r\n  methods: {\r\n    getPlace(){\r\n      $_main.http.get('place/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n        let areas=this.areas.filter(el=>result.some(item=>item.area==el.name))||[],place=[]\r\n        areas.forEach(el=>{\r\n          el.isopen=false\r\n          el.children=[];\r\n          result.forEach(item=>{\r\n            if(el.name==item.area){\r\n              el.children.push(item)\r\n            }\r\n          })\r\n          place.push(el)\r\n        })\r\n        this.place=place;\r\n      })\r\n    },\r\n\r\n    addClick(){\r\n      let item={name:null,cars:[],area:this.cmpIndex.area,des:null,regions:[],auser:$_main.userId,placeId:this.cmpIndex.id}\r\n      $_popup.open(AiAddOrUpdateWindow, {item:item,callback:this.addOrUpdateCallback});\r\n    },\r\n    updClick(){\r\n      $_popup.open(AiAddOrUpdateWindow, {item:objClone(this.selectedItem),callback:this.addOrUpdateCallback});\r\n    },\r\n    addOrUpdateCallback(result,isddd){\r\n      if(isddd){\r\n        this.datas.push(result)\r\n        this.list.push(result)\r\n      }else{\r\n        objCopyTo(result, this.selectedItem);\r\n      }\r\n    },\r\n    delClick(){\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('rule/delete', {id:this.selectedItem.id}).then(e => {\r\n          arrayRemoveItem(this.datas, this.selectedItem);\r\n          arrayRemoveItem(this.list, this.selectedItem);\r\n          this.selectedItem=null;\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    addDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,callback:this.addOrUpdateDirCallback});\r\n    },\r\n    updDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,item:objClone(this.selected),callback:this.addOrUpdateDirCallback});\r\n    },\r\n    addOrUpdateDirCallback(result,isddd){\r\n      if(isddd){\r\n        let place=arrayToMap(this.place,'name')\r\n        if(place[result.area]){\r\n          place[result.area].children.push(result)\r\n          this.$forceUpdate()\r\n        }else{\r\n          this.place.push({name:result.area,isopen:false,children:[result]})\r\n        }\r\n      }else{\r\n        objCopyTo(result, this.selected);\r\n      }\r\n    },\r\n    delDirClick(){\r\n      if(this.datas&&this.datas.length!=0)return $_alert.warn($_L.get('该场地下有工况，请先删除工况？'))\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('place/delete', {id:this.selected.id}).then(e => {\r\n          let obj\r\n          this.place.forEach(el=>{\r\n            if(el.name==this.selected.area){\r\n              arrayRemoveItem(el.children, this.selected);\r\n              if(el.children==0){obj=el}\r\n            }\r\n          })\r\n          if(obj){arrayRemoveItem(this.place, obj);}\r\n          this.selected=null;\r\n          this.cmpIndex={id:null}\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    click(item){\r\n      this.index++\r\n      if(!item.children){\r\n        this.cmpIndex=item;\r\n        this.datas=this.list.filter(el=>el.placeId==item.id)\r\n      }else{\r\n        item.isopen=!item.isopen;\r\n\r\n      }\r\n      this.$forceUpdate()\r\n      this.selected=item;\r\n    },\r\n  }\r\n}\r\n",null]}