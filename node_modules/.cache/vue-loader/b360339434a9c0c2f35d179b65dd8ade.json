{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\modules\\cdRule\\CdRuleModule.vue","mtime":1685000036289},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport AiAddOrUpdateWindow      from './AiAddOrUpdateWindow.vue';\r\nimport DirAddOrUpdateWindow     from './DirAddOrUpdateWindow.vue';\r\nimport { arrayRemoveItem }      from '@/common/util/Arrays.js';\r\nimport { arrayToMap }           from '@/common/util/Arrays.js';\r\nimport { objClone, objCopyTo }  from '@/common/util/Objects.js';\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      areas:[{name:'黑龙江省'},{name:'辽宁省'},{name:'吉林省'},{name:'河北省'},{name:'河南省'},{name:'湖北省'},{name:'湖南省'},\r\n        {name:'山东省'},{name:'山西省'},{name:'陕西省'},{name:'安徽省'},{name:'浙江省'},{name:'江苏省'},{name:'福建省'},{name:'广东省'},\r\n        {name:'海南省'},{name:'四川省'},{name:'云南省'},{name:'贵州省'},{name:'青海省'},{name:'甘肃省'},{name:'江西省'},{name:'台湾省'},\r\n        {name:'内蒙古自治区'},{name:'宁夏回族自治区'},{name:'新疆维吾尔自治区'},{name:'西藏自治区'},{name:'广西壮族自治区'},\r\n        {name:'北京市'},{name:'上海市'},{name:'天津市'},{name:'重庆市'},{name:'香港特别行政区'},{name:'澳门特别行政区'}],\r\n      datas: [],\r\n      list:[],\r\n      place:[],\r\n      cmpIndex:{id:null},\r\n      selected:null,\r\n      selectedItem:null,\r\n      index:0\r\n    }\r\n  },\r\n\r\n  created(){\r\n  },\r\n  mounted() {\r\n    $_main.http.get('rule/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n      this.list=result;\r\n    })\r\n    this.getPlace()\r\n  },\r\n  methods: {\r\n    getPlace(){\r\n      $_main.http.get('place/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n        let areas=this.areas.filter(el=>result.some(item=>item.area==el.name))||[],place=[]\r\n        areas.forEach(el=>{\r\n          el.isopen=false\r\n          el.children=[];\r\n          result.forEach(item=>{\r\n            if(el.name==item.area){\r\n              el.children.push(item)\r\n            }\r\n          })\r\n          place.push(el)\r\n        })\r\n        this.place=place;\r\n      })\r\n    },\r\n\r\n    addClick(){\r\n      let item={name:null,cars:[],area:this.cmpIndex.area,des:null,regions:[],auser:$_main.userId,placeId:this.cmpIndex.id}\r\n      $_popup.open(AiAddOrUpdateWindow, {item:item,callback:this.addOrUpdateCallback});\r\n    },\r\n    updClick(){\r\n      $_popup.open(AiAddOrUpdateWindow, {item:objClone(this.selectedItem),callback:this.addOrUpdateCallback});\r\n    },\r\n    addOrUpdateCallback(result,isddd){\r\n      if(isddd){\r\n        this.datas.push(result)\r\n        this.list.push(result)\r\n      }else{\r\n        objCopyTo(result, this.selectedItem);\r\n      }\r\n    },\r\n    delClick(){\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('rule/delete', {id:this.selectedItem.id}).then(e => {\r\n          arrayRemoveItem(this.datas, this.selectedItem);\r\n          arrayRemoveItem(this.list, this.selectedItem);\r\n          this.selectedItem=null;\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    addDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,callback:this.addOrUpdateDirCallback});\r\n    },\r\n    updDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,item:objClone(this.selected),callback:this.addOrUpdateDirCallback});\r\n    },\r\n    addOrUpdateDirCallback(result,isddd){\r\n      if(isddd){\r\n        let place=arrayToMap(this.place,'name')\r\n        if(place[result.area]){\r\n          place[result.area].children.push(result)\r\n          this.$forceUpdate()\r\n        }else{\r\n          this.place.push({name:result.area,isopen:false,children:[result]})\r\n        }\r\n      }else{\r\n        objCopyTo(result, this.selected);\r\n      }\r\n    },\r\n    delDirClick(){\r\n      if(this.datas&&this.datas.length!=0)return $_alert.warn($_L.get('该场地下有工况，请先删除工况？'))\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('place/delete', {id:this.selected.id}).then(e => {\r\n          let obj\r\n          this.place.forEach(el=>{\r\n            if(el.name==this.selected.area){\r\n              arrayRemoveItem(el.children, this.selected);\r\n              if(el.children==0){obj=el}\r\n            }\r\n          })\r\n          if(obj){arrayRemoveItem(this.place, obj);}\r\n          this.selected=null;\r\n          this.cmpIndex={id:null}\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    click(item){\r\n      this.index++\r\n      if(!item.children){\r\n        this.cmpIndex=item;\r\n        this.datas=this.list.filter(el=>el.placeId==item.id)\r\n      }else{\r\n        item.isopen=!item.isopen;\r\n\r\n      }\r\n      this.$forceUpdate()\r\n      this.selected=item;\r\n    },\r\n  }\r\n}\r\n",{"version":3,"sources":["CdRuleModule.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"CdRuleModule.vue","sourceRoot":"src/modules/cdRule","sourcesContent":["<template>\r\n  <div :class=\"$style.container\">\r\n    <div style=\"width:20%;border:1px solid #AEBAC5;background:#fff;\">\r\n      <Button style=\"width:100%\" type=\"primary\" >{{$_L.get('场地')}}</Button>\r\n      <div style=\"height:calc(100% - 74px);overflow: auto;width: 100%;background-color: #fff;\">\r\n        <ul :class=\"$style.left_ul\" >\r\n          <li v-for=\"(item,index) in place\" :key=\"index\" >\r\n            <div :style=\"!item.children&&cmpIndex.id==item.id&&{backgroundColor:theme.selected_color}\" style=\"margin:0\" @click=\"click(item)\" >\r\n              <span :class=\"!item.children&&cmpIndex.id==item.id&&$style.indexbgc\" :style=\"{backgroundColor:theme.color}\"></span>\r\n             {{item.name}}\r\n              <img :src=\"require('@/assets/main/zhankai.png')\" alt=\"\" :class=\"[item.isopen&&item.children&&$style.isopen||$style.isclose]\" v-show=\"item.children\">\r\n            </div>\r\n            <div style=\"margin:0;padding:0\" v-show=\"item.isopen\">\r\n              <div v-for=\"(item1,index1) in item.children\" :key=\"index1\" >\r\n                <li :class=\"item1.children&&$style.layers\" :style=\"[(cmpIndex.id==item1.id||item1.children)&&{backgroundColor:theme.selected_color},{paddingLeft:item1.children?'40px':'60px'}]\" @click=\"click(item1)\">\r\n                  <span :class=\"cmpIndex.id==item1.id&&$style.indexbgc\" :style=\"{backgroundColor:theme.color}\"></span> {{item1.name}}\r\n                </li>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <div style=\"padding:5px;display: flex;border-top:1px solid #ccc;\">\r\n        <Button icon=\"el-icon-plus\" style=\"margin-right:6px;flex: 1\" type=\"primary\"  @click=\"addDirClick()\" >{{$_L.get('新增')}}</Button>\r\n        <Button icon=\"el-icon-edit\" style=\"margin-right:6px;flex: 1\" type=\"primary\"  @click=\"updDirClick()\" :disabled=\"!cmpIndex.id\">{{$_L.get('修改')}}</Button>\r\n        <Button icon=\"el-icon-minus\" style=\"flex: 1\" type=\"primary\" @click=\"delDirClick()\" :disabled=\"!cmpIndex.id\">{{$_L.get('删除')}}</Button>\r\n      </div>\r\n    </div>\r\n    <div style=\"width:calc(80% - 5px);margin-left:5px;display: flex;flex-flow:column;\">\r\n      <div >\r\n        <Toolbar>\r\n          <div slot=\"right\">\r\n            <Button icon=\"el-icon-plus\" style=\"margin-right:6px;\" type=\"primary\"  @click=\"addClick()\" :disabled=\"!cmpIndex.id||(!place||place.length==0)\">{{$_L.get('新增')}}</Button>\r\n            <Button icon=\"el-icon-edit\" style=\"margin-right:6px;\" type=\"primary\"  @click=\"updClick()\" :disabled=\"!selectedItem\">{{$_L.get('修改')}}</Button>\r\n            <Button icon=\"el-icon-minus\" style=\"margin-right:6px;\" type=\"primary\" @click=\"delClick()\" :disabled=\"!selectedItem\">{{$_L.get('删除')}}</Button>\r\n          </div>\r\n        </Toolbar>\r\n      </div>\r\n      <div style=\"flex-shrink:1;height:100%;position:relative\">\r\n        <vxe-table :data=\"datas\" :loading=\"!datas\" ref=\"grid\" style=\"border:1px solid #AEBAC5;border-top:0;position:absolute;left:0;top:0;right:0;bottom:0;\" @cell-click=\"({row})=>selectedItem=row\">\r\n          <vxe-table-column type=\"index\" :title=\"$_L.get('序号')\" width=\"50px\" />\r\n          <vxe-table-column field=\"name\" :title=\"$_L.get('工况名称')\"/>\r\n          <vxe-table-column field=\"state\" :title=\"$_L.get('状态')\" :formatter=\"({cellValue})=>cellValue=='1'?$_L.get('正常'):$_L.get('关闭')\"/>\r\n          <vxe-table-column field=\"des\" :title=\"$_L.get('描述')\" />\r\n          <vxe-table-column field=\"atime\" :title=\"$_L.get('创建时间')\" />\r\n          <vxe-table-column field=\"auser\" :title=\"$_L.get('创建用户')\" />\r\n        </vxe-table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AiAddOrUpdateWindow      from './AiAddOrUpdateWindow.vue';\r\nimport DirAddOrUpdateWindow     from './DirAddOrUpdateWindow.vue';\r\nimport { arrayRemoveItem }      from '@/common/util/Arrays.js';\r\nimport { arrayToMap }           from '@/common/util/Arrays.js';\r\nimport { objClone, objCopyTo }  from '@/common/util/Objects.js';\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      areas:[{name:'黑龙江省'},{name:'辽宁省'},{name:'吉林省'},{name:'河北省'},{name:'河南省'},{name:'湖北省'},{name:'湖南省'},\r\n        {name:'山东省'},{name:'山西省'},{name:'陕西省'},{name:'安徽省'},{name:'浙江省'},{name:'江苏省'},{name:'福建省'},{name:'广东省'},\r\n        {name:'海南省'},{name:'四川省'},{name:'云南省'},{name:'贵州省'},{name:'青海省'},{name:'甘肃省'},{name:'江西省'},{name:'台湾省'},\r\n        {name:'内蒙古自治区'},{name:'宁夏回族自治区'},{name:'新疆维吾尔自治区'},{name:'西藏自治区'},{name:'广西壮族自治区'},\r\n        {name:'北京市'},{name:'上海市'},{name:'天津市'},{name:'重庆市'},{name:'香港特别行政区'},{name:'澳门特别行政区'}],\r\n      datas: [],\r\n      list:[],\r\n      place:[],\r\n      cmpIndex:{id:null},\r\n      selected:null,\r\n      selectedItem:null,\r\n      index:0\r\n    }\r\n  },\r\n\r\n  created(){\r\n  },\r\n  mounted() {\r\n    $_main.http.get('rule/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n      this.list=result;\r\n    })\r\n    this.getPlace()\r\n  },\r\n  methods: {\r\n    getPlace(){\r\n      $_main.http.get('place/get',{ sessionId: $_main.sessionId,userId:$_main.userId }).then(result=>{\r\n        let areas=this.areas.filter(el=>result.some(item=>item.area==el.name))||[],place=[]\r\n        areas.forEach(el=>{\r\n          el.isopen=false\r\n          el.children=[];\r\n          result.forEach(item=>{\r\n            if(el.name==item.area){\r\n              el.children.push(item)\r\n            }\r\n          })\r\n          place.push(el)\r\n        })\r\n        this.place=place;\r\n      })\r\n    },\r\n\r\n    addClick(){\r\n      let item={name:null,cars:[],area:this.cmpIndex.area,des:null,regions:[],auser:$_main.userId,placeId:this.cmpIndex.id}\r\n      $_popup.open(AiAddOrUpdateWindow, {item:item,callback:this.addOrUpdateCallback});\r\n    },\r\n    updClick(){\r\n      $_popup.open(AiAddOrUpdateWindow, {item:objClone(this.selectedItem),callback:this.addOrUpdateCallback});\r\n    },\r\n    addOrUpdateCallback(result,isddd){\r\n      if(isddd){\r\n        this.datas.push(result)\r\n        this.list.push(result)\r\n      }else{\r\n        objCopyTo(result, this.selectedItem);\r\n      }\r\n    },\r\n    delClick(){\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('rule/delete', {id:this.selectedItem.id}).then(e => {\r\n          arrayRemoveItem(this.datas, this.selectedItem);\r\n          arrayRemoveItem(this.list, this.selectedItem);\r\n          this.selectedItem=null;\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    addDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,callback:this.addOrUpdateDirCallback});\r\n    },\r\n    updDirClick(){\r\n      $_popup.open(DirAddOrUpdateWindow, {areas:this.areas,item:objClone(this.selected),callback:this.addOrUpdateDirCallback});\r\n    },\r\n    addOrUpdateDirCallback(result,isddd){\r\n      if(isddd){\r\n        let place=arrayToMap(this.place,'name')\r\n        if(place[result.area]){\r\n          place[result.area].children.push(result)\r\n          this.$forceUpdate()\r\n        }else{\r\n          this.place.push({name:result.area,isopen:false,children:[result]})\r\n        }\r\n      }else{\r\n        objCopyTo(result, this.selected);\r\n      }\r\n    },\r\n    delDirClick(){\r\n      if(this.datas&&this.datas.length!=0)return $_alert.warn($_L.get('该场地下有工况，请先删除工况？'))\r\n      $_alert.comfirm($_L.get('你确定要删除吗？'), yes => {\r\n        if (!yes) return;\r\n        $_main.http.get('place/delete', {id:this.selected.id}).then(e => {\r\n          let obj\r\n          this.place.forEach(el=>{\r\n            if(el.name==this.selected.area){\r\n              arrayRemoveItem(el.children, this.selected);\r\n              if(el.children==0){obj=el}\r\n            }\r\n          })\r\n          if(obj){arrayRemoveItem(this.place, obj);}\r\n          this.selected=null;\r\n          this.cmpIndex={id:null}\r\n          $_alert.success($_L.get('删除成功'));\r\n        });\r\n      }, this.$el);\r\n    },\r\n    click(item){\r\n      this.index++\r\n      if(!item.children){\r\n        this.cmpIndex=item;\r\n        this.datas=this.list.filter(el=>el.placeId==item.id)\r\n      }else{\r\n        item.isopen=!item.isopen;\r\n\r\n      }\r\n      this.$forceUpdate()\r\n      this.selected=item;\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style module>\r\n.container{\r\n  width: 100%;\r\n  height: 100%;\r\n  display:flex;\r\n\r\n}\r\n.left_ul{\r\n  height: 100%;\r\n  margin: 0;\r\n  padding:0;\r\n  overflow: auto;\r\n}\r\n.left_ul::-webkit-scrollbar {\r\n  width: 0px;\r\n}\r\n.left_ul li{\r\n  cursor: pointer;\r\n  position: relative;\r\n  height: auto;\r\n  line-height: 50px;\r\n  font-size: 14px;\r\n  min-width: 220px;\r\n}\r\n.left_ul li >div{\r\n  padding-left: 20px;\r\n  padding-right: 10px;\r\n}\r\n\r\n.left_ul li >div:first-child:hover{\r\n  background-color: rgb(255, 240, 193);\r\n}\r\n.left_ul li img{\r\n  vertical-align:middle;\r\n  display: inline-block;\r\n  padding-right: 5px;\r\n}\r\n.indexbgc{\r\n  position: absolute;\r\n  width: 5px;\r\n  height: 50px;\r\n  left: 0;\r\n  top: 0px;\r\n  z-index: 2;\r\n}\r\n.isopen{\r\n  max-width:20px;\r\n  float:right;\r\n  margin-top:25px;\r\n}\r\n.isclose{\r\n  max-width:20px;\r\n  float:right;\r\n  margin-top:25px;\r\n  transform:rotate(90deg);\r\n}\r\n.layers{\r\n  opacity: 0.5;\r\n  color: #000;\r\n}\r\n</style>\r\n"]}]}