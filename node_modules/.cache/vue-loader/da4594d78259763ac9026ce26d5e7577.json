{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\common\\tree\\CarTreeToolbar.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\common\\tree\\CarTreeToolbar.vue","mtime":1677634046517},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport SearchBox from \"@/components/Tree/SearchBox.vue\";\r\n// import CarFavSetWindow from \"./CarFavSetWindow.vue\";\r\n// import CarGroupSetWindow from \"./CarGroupSetWindow.vue\";\r\n\r\nimport { domLeftTop } from '@/components/util/Dom.js';\r\nimport { objCopyTo } from '@/common/util/Objects.js';\r\nimport { objIsEmpty } from '@/common/util/Objects.js';\r\nimport { arrayRemoveItem } from '@/common/util/Arrays.js';\r\nimport { Fields } from '@/common/cache/CacheTeamCar.js';\r\nimport { getCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\nimport { saveCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\nimport { countState } from '@/common/cache/CacheTeamCar.js';\r\nimport { countFilter } from '@/common/cache/CacheTeamCar.js';\r\nimport { setFilterFun } from '@/common/cache/CacheTeamCar.js';\r\nimport { resetCarTree } from '@/common/cache/CacheTeamCar.js';\r\nimport { getPlateColorArray } from '@/common/Vars.js';\r\nimport { getCarTypeTree } from \"@/common/cache/CacheCmn.js\";\r\nimport { getTeamExtWidgets } from \"@/common/cache/CacheCmn.js\";\r\n\r\nimport { getFieldMap } from \"@/common/gps/Fields.js\";\r\n\r\nexport default {\r\n  components: { SearchBox },\r\n  props: {\r\n    setting: { default: null },\r\n    miniBar: { type: Boolean, default: false },\r\n    treeBorder: { type: Boolean, default: true },\r\n    onSearchItemSelected: Function,\r\n    refreshClick: Function,\r\n    showRecent: Function,\r\n    model: { type: String, default: null },\r\n    // modelChg: Function,\r\n    onCarSortFieldChg: Function,\r\n    show2g4gIcon: { type: Boolean, default: false },\r\n    showDyField: { type: Boolean, default: false },\r\n    isSimple: { type: Boolean, default: false },\r\n  },\r\n\r\n  _carFields: null,\r\n  _teamFields: null,\r\n  _treeId: null,\r\n\r\n  data() {\r\n    return {\r\n      uuid: $_theme.zindex(),\r\n      placeholder: \"\",\r\n      hasOwnField: null,\r\n      // favshow: true,\r\n      // favset: false,\r\n      // groupshow: false,\r\n      // groupset: false,\r\n      // model: false,\r\n      carTreeCfg: {},\r\n      /*{\r\n        search: {carFields:['plate','tmnKey'], teamFields:[]}, //设置搜索条件\r\n        sortField: 'plate',\r\n        filters: {state:false,color:null,type:null},\r\n        showTeamCount: false/{line: true, move: false, alarm: false, invalid: false, acc: false},\r\n        showCarField:  false/{color:true, tmnKey:true, state:true, bxts: [bxtId]}\r\n      }*/\r\n      searchBxtFields: [],\r\n      searchTeamExtFields: [],\r\n      showTeamCount: { line: false, move: false, alarm: false, invalid: false, acc: false },\r\n      das: { dj: false, de: false, df: false },\r\n      showCarField: [], //['color', 'tmnKey', 'state'],\r\n      showCarBxts: [],\r\n      car_bxt_list: [],\r\n      team_ext_list: [],\r\n      searchSet: { show: false, left: 0, top: 0 },\r\n      renderSet: { show: false, left: 0, top: 0 },\r\n      showcount: 0,\r\n      simple: false,\r\n      colors: getPlateColorArray(),\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    hw: function () { return this.miniBar ? 27 : this.theme.inputHeight; },\r\n    mini: function () { return this.miniBar },\r\n    getCarTypeTree: () => getCarTypeTree,\r\n    states: function () { return [{ label: $_L.get('在线车辆'), value: 'online' }, { label: $_L.get('离线车辆'), value: 'offline' }, { label: $_L.get('行驶车辆'), value: 'move' }, { label: $_L.get('停止车辆'), value: 'stop' }, { label: $_L.get('报警车辆'), value: 'alarm' }, { label: $_L.get('无效定位'), value: 'invalid' }]; }\r\n  },\r\n\r\n  watch: {\r\n    'searchSet.show': function (v) {\r\n      if (!v) return document.removeEventListener('click', this.clickSearchSet);\r\n      let { left, top } = domLeftTop(this.$el);\r\n      this.searchSet.left = left - 1;\r\n      this.searchSet.top = top + this.$el.clientHeight;\r\n      setTimeout(() => { document.addEventListener('click', this.clickSearchSet); }, 10);\r\n    },\r\n    'renderSet.show': function (v) {\r\n      if (!v) return document.removeEventListener('click', this.clickRenderSet);\r\n      let { left, top } = domLeftTop(this.$el);\r\n      if (left + this.$el.clientWidth + 260 > document.documentElement.clientWidth) {\r\n        left = left + this.$el.clientWidth - 260 + 1;\r\n        top += this.$el.clientHeight;\r\n      } else {\r\n        left = left + this.$el.clientWidth;\r\n        top -= 1;\r\n      }\r\n      this.renderSet.left = left;\r\n      this.renderSet.top = top;\r\n      setTimeout(() => { document.addEventListener('click', this.clickRenderSet); }, 10);\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.simple = this.isSimple\r\n    let map = getFieldMap();\r\n    this.das.dj = $_H.show('da') && $_H.show('dc') && !!map.t0;\r\n    this.das.de = $_H.show('da') && $_H.show('de') && !!map.t1;\r\n    this.das.df = $_H.show('da') && $_H.show('df') && !!map.t2;\r\n    $_H.show('da') && $_H.show('dc') && this.showcount++;\r\n    $_H.show('da') && $_H.show('db') && this.showcount++;\r\n    $_H.show('da') && $_H.show('di') && this.showcount++;\r\n    this.das.dj && this.showcount++;\r\n    this.das.de && this.showcount++;\r\n    this.das.df && this.showcount++;\r\n    $_H.show('da') && $_H.show('dg') && this.showcount++;\r\n    $_H.show('da') && $_H.show('dh') && this.showcount++;\r\n    $_H.show('da') && $_H.show('dr') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dl') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('ds') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dt') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dq') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dk') && this.show2g4gIcon && this.showcount++;\r\n    this.team_ext_list = getTeamExtWidgets() || this.team_ext_list;\r\n  },\r\n\r\n  mounted() {\r\n    // this.favshow = this.setting.favshow !== false;\r\n    // this.favset = this.setting.favset === true;\r\n    // this.groupshow = this.setting.groupshow !== false;\r\n    // this.groupset = this.setting.groupset === true;\r\n    this.carTreeCfg = getCarTreeCfg();\r\n    this.carTreeCfg.showTeamCount && objCopyTo(this.carTreeCfg.showTeamCount, this.showTeamCount);\r\n    if (this.carTreeCfg.showCarField) {\r\n      this.carTreeCfg.showCarField.color && this.showCarField.push('color');\r\n      this.carTreeCfg.showCarField.tmnKey && this.showCarField.push('tmnKey');\r\n      this.carTreeCfg.showCarField.simCard && this.showCarField.push('simCard');\r\n      this.carTreeCfg.showCarField.tmnNo && this.showCarField.push('tmnNo');\r\n      this.carTreeCfg.showCarField.driver && this.showCarField.push('driver');\r\n      this.carTreeCfg.showCarField.state && this.showCarField.push('state');\r\n      this.carTreeCfg.showCarField.acc && this.showCarField.push('acc');\r\n      this.carTreeCfg.showCarField.speed && this.showCarField.push('speed');\r\n      this.carTreeCfg.showCarField.rsl && this.showCarField.push('rsl');\r\n      this.carTreeCfg.showCarField.ool && this.showCarField.push('ool');\r\n      this.carTreeCfg.showCarField.area && this.showCarField.push('area');\r\n      this.carTreeCfg.showCarField.g24 && this.showCarField.push('g24');\r\n      this.showCarBxts = this.carTreeCfg.showCarField.bxts || this.showCarBxts;\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    init(car_bxt_list) {\r\n      let map = getFieldMap();\r\n      car_bxt_list.forEach(bxt => map[bxt.id] && this.car_bxt_list.push(bxt));\r\n      let carFields = this.carTreeCfg.search.carFields;\r\n      this.car_bxt_list.forEach(bxt => carFields.indexOf('bxts.' + bxt.id) > -1 && this.searchBxtFields.push(bxt.id));\r\n      let teamFields = this.carTreeCfg.search.teamFields;\r\n      this.team_ext_list.forEach(ext => teamFields.indexOf('exts.' + ext.id) > -1 && this.searchTeamExtFields.push(ext.id));\r\n      this.setSearchField();\r\n    },\r\n    setTree(tree) {\r\n      this._treeId = tree.setting.treeId;\r\n      this.$refs.searchBox.setTree(tree);\r\n    },\r\n    searchBxtChg() {\r\n      let carFields = this.carTreeCfg.search.carFields;\r\n      this.car_bxt_list.forEach(bxt => arrayRemoveItem(carFields, 'bxts.' + bxt.id));\r\n      this.searchBxtFields && this.searchBxtFields.forEach(bxtId => carFields.push('bxts.' + bxtId));\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    searchTeamExtChg() {\r\n      let teamFields = this.carTreeCfg.search.teamFields;\r\n      this.team_ext_list.forEach(ext => arrayRemoveItem(teamFields, 'exts.' + ext.id));\r\n      this.searchTeamExtFields && this.searchTeamExtFields.forEach(bxtId => teamFields.push('exts.' + bxtId));\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    setSearchField() {\r\n      let carFields = this.carTreeCfg.search.carFields, teamFields = this.carTreeCfg.search.teamFields;\r\n      if (carFields.length == 0 && teamFields.length == 0) {\r\n        carFields.push('plate');\r\n      }\r\n      this._carFields = carFields.length > 0 ? carFields : null;\r\n      this._teamFields = teamFields.length > 0 ? teamFields : null;\r\n      this.hasOwnField = this._carFields && this._teamFields ? null : this._carFields ? 'plate' : 'pid';\r\n      let placeholder = [];\r\n      if (this._carFields) {\r\n        this._carFields.indexOf('plate') > -1 && placeholder.push($_L.get('车牌号码'));\r\n        this._carFields.indexOf('carname') > -1 && placeholder.push($_L.get('车辆名称'));\r\n        this._carFields.indexOf('tmnKey') > -1 && placeholder.push($_L.get('终端标识'));\r\n        this._carFields.indexOf('simCard') > -1 && placeholder.push($_L.get('SIM卡号'));\r\n        this.car_bxt_list.forEach(bxt => this._carFields.indexOf('bxts.' + bxt.id) > -1 && placeholder.push(bxt.name));\r\n      }\r\n      if (this._teamFields) {\r\n        this._teamFields.indexOf('teamname') > -1 && placeholder.push($_L.get('车队名称'));\r\n        this._teamFields.indexOf('linkman') > -1 && placeholder.push($_L.get('联系人员'));\r\n        this._teamFields.indexOf('phone') > -1 && placeholder.push($_L.get('联系电话'));\r\n        this.team_ext_list.forEach(ext => this._teamFields.indexOf('exts.' + ext.id) > -1 && placeholder.push(ext.name));\r\n      }\r\n      this.placeholder = placeholder.join('｜');\r\n    },\r\n    searchFun(node, text, array) {\r\n      if (node[this._treeId].hide) return false;\r\n      return this.contain(node, text, array, node.plate ? this._carFields : this._teamFields);\r\n    },\r\n    contain(node, text, array, fields) {\r\n      if (!fields) return false;\r\n      let fun;\r\n      for (let field of fields) {\r\n        fun = Fields[field];\r\n        if (fun) {\r\n          field = fun(node, field);\r\n        } else {\r\n          fields = field.split('.');// bxts.id | exts.id\r\n          fun = Fields[fields[0]];\r\n          field = fun(node, fields[1] + '.text') || fun(node, fields[1]);\r\n        }\r\n        if (!field) continue;\r\n        if ((text && field.toLowerCase().indexOf(text) >= 0) || (array && array.has(field))) return true;\r\n      }\r\n      return false;\r\n    },\r\n    // favSetClick() {\r\n    //   $_popup.open(CarFavSetWindow);\r\n    // },\r\n    // groupSetClick() {\r\n    //   $_popup.open(CarGroupSetWindow);\r\n    // },\r\n    clickSearchSet(event) {\r\n      this.searchSet.show = this.$refs.searchSet.contains(event.target);\r\n    },\r\n    clickRenderSet(event) {\r\n      this.renderSet.show = this.$refs.renderSet.contains(event.target);\r\n    },\r\n    searchSetChg() {\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    setTeamCount(field) {\r\n      let before = this.carTreeCfg.showTeamCount;\r\n      this._setShowCfg('showTeamCount', field, this.showTeamCount[field]);\r\n      !before && this.carTreeCfg.showTeamCount && countState();\r\n      resetCarTree('updateNodeName', false, true);\r\n    },\r\n    carSortFieldChg() {\r\n      saveCarTreeCfg();\r\n      resetCarTree('updateNodeName', true, false);\r\n      this.onCarSortFieldChg && this.onCarSortFieldChg();\r\n    },\r\n    showCarFieldChg(field) {\r\n      let flag = this.showCarField.indexOf(field) != -1;\r\n      this._setShowCfg('showCarField', field, flag);\r\n      if (field == 'acc' || field == 'speed' || field == 'rsl' || field == 'ool' || field == 'area') {//ACC、速度和地区，特殊处理，需要后台推数据\r\n        this.$parent._dyfield.onFieldCheck(field, flag);\r\n        !flag && resetCarTree('updateNodeName', true, false);\r\n      } else {\r\n        resetCarTree('updateNodeName', true, false);\r\n      }\r\n    },\r\n    showCarBxtsChg() {\r\n      this._setShowCfg('showCarField', 'bxts', (!this.showCarBxts || this.showCarBxts.length == 0) ? false : this.showCarBxts);\r\n      resetCarTree('updateNodeName', true, false);\r\n    },\r\n    carFilterChg() {\r\n      saveCarTreeCfg();\r\n      setFilterFun();\r\n      this.carTreeCfg.hasFilter && countFilter();\r\n      resetCarTree('updateNodeHide', true, true);\r\n      resetCarTree('updateNodeName', false, true);\r\n    },\r\n    _setShowCfg(item, key, value) {\r\n      let cfg = this.carTreeCfg[item];\r\n      if (!cfg && !value) return;\r\n      if (!value) {\r\n        cfg && delete cfg[key];\r\n        if (objIsEmpty(cfg)) cfg = false;\r\n      } else {\r\n        cfg = cfg || {};\r\n        cfg[key] = value;\r\n      }\r\n      this.carTreeCfg[item] = cfg;\r\n      saveCarTreeCfg();\r\n    },\r\n    showTip(tip, color) {\r\n      this.$refs.searchBox.clear();\r\n      this.$refs.searchBox.showTip(tip, color);\r\n    },\r\n    destroy() {\r\n      this.$refs.searchBox.clear();\r\n      this.$refs.searchBox.setTree(null);\r\n      this._carFields = null;\r\n      this._teamFields = null;\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["CarTreeToolbar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CarTreeToolbar.vue","sourceRoot":"src/common/tree","sourcesContent":["\r\n<template>\r\n  <Toolbar :border=\"false\" small :mini=\"mini\" :style=\"[simple?{padding:'0'}:{borderBottom:'1px solid',borderColor:theme.border_color_light}]\" :bgc=\"theme.tree_toolbar_bg_color\">\r\n    <Button type=\"light\" style=\"padding:2px 0 0 0;\" icon=\"el-icon-search\" :radius=\"theme.input_radius_l\" :height=\"hw\" :style=\"{width:`${hw}px`,borderColor:simple?theme.border_color_dark:theme.border_color_light}\" @click=\"searchSet.show=!searchSet.show\" />\r\n    <SearchBox ref=\"searchBox\" style=\"margin-left:-1px\" :style=\"{width:`calc(100% - ${mini?(simple?26:84):(simple?31:103)}px`}\" :radius=\"simple?theme.input_radius_r:'0px'\" :height=\"hw\" border :borderColor=\"simple?theme.border_color_dark:theme.border_color_light\" :treeBorder=\"treeBorder\" :showSearchIcon=\"false\" :placeholder=\"placeholder\" :hasOwnField=\"hasOwnField\" :searchFun=\"searchFun\" :onItemSelected=\"onSearchItemSelected\" @blankinput=\"showRecent\" @blankclick=\"showRecent\" />\r\n    <Button v-if=\"!simple\" type=\"light\" style=\"margin-left:-1px;padding:2px 0 0 0;\" :height=\"hw\" :style=\"{width:`${hw}px`}\" radius=\"0px\" icon=\"el-icon-refresh-right\" @click=\"refreshClick\" />\r\n    <Button v-if=\"!simple\" type=\"light\" style=\"margin-left:-1px;padding:2px 0 0 0;\" :height=\"hw\" :style=\"{width:`${hw}px`}\" :radius=\"theme.input_radius_r\" icon=\"el-icon-setting\" @click=\"renderSet.show=!renderSet.show\" />\r\n\r\n    <div ref=\"searchSet\" :class=\"$style.setter\" v-if=\"searchSet.show\" :style=\"[{left:searchSet.left+'px',top:searchSet.top+'px',zIndex:searchSet.show && theme.zindex(), borderColor:theme.border_color_light},theme.popup]\">\r\n      <div v-if=\"$_H.show('e0')\" :class=\"$style.title\" style=\"line-height:30px\"> {{$_L.get('车辆搜索选项')}} </div>\r\n      <Checkbox v-if=\"$_H.show('e0')&&$_H.show('e2')\" :label=\"$_L.get('车牌号码')\" :class=\"$style.item\" val=\"plate\" v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\" />\r\n      <Checkbox v-if=\"$_H.show('e0')&&$_H.show('e1')\" :label=\"$_L.get('车辆名称')\" :class=\"$style.item\" val=\"carname\" v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\" />\r\n      <Checkbox v-if=\"$_H.show('e0')&&$_H.show('e6')\" :label=\"$_L.get('终端标识')\" :class=\"$style.item\" val=\"tmnKey\" v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\" />\r\n      <Checkbox v-if=\"$_H.show('e0')&&$_H.show('e4')\" :label=\"$_L.get('SIM卡号')\" :class=\"$style.item\" val=\"simCard\" v-model=\"carTreeCfg.search.carFields\" @change=\"searchSetChg\" />\r\n      <InputSelect v-if=\"car_bxt_list.length&&$_H.show('e0')&&$_H.show('e3')\" :height=\"30\" :class=\"$style.item\" :placeholder=\"$_L.get('更多选项')\" :options=\"car_bxt_list\" valueField=\"id\" labelField=\"name\" checkbox clearable :showCheckAll=\"false\" borderColor=\"#E8EAED\" :maxListNum=\"6\" :focusable=\"false\" v-model=\"searchBxtFields\" radius=\"0px\" style=\"padding-left:0px!important;border-left:0;border-right:0;width:calc(100% + 1px) !important;\" @change=\"searchBxtChg\" />\r\n\r\n      <div v-if=\"$_H.show('em')\" :class=\"$style.title\" style=\"line-height:30px\"> {{$_L.get('车队搜索选项')}} </div>\r\n      <Checkbox v-if=\"$_H.show('em')&&$_H.show('en')\" :label=\"$_L.get('车队名称')\" :class=\"$style.item\" val=\"teamname\" v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\" />\r\n      <Checkbox v-if=\"$_H.show('em')&&$_H.show('eo')\" :label=\"$_L.get('联系人员')\" :class=\"$style.item\" val=\"linkman\" v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\" />\r\n      <Checkbox v-if=\"$_H.show('em')&&$_H.show('ep')\" :label=\"$_L.get('联系电话')\" :class=\"$style.item\" val=\"phone\" v-model=\"carTreeCfg.search.teamFields\" @change=\"searchSetChg\" />\r\n      <InputSelect v-if=\"team_ext_list.length&&$_H.show('em')&&$_H.show('eq')\" :height=\"30\" :class=\"$style.item\" :placeholder=\"$_L.get('更多选项')\" :options=\"team_ext_list\" valueField=\"id\" labelField=\"name\" checkbox clearable :showCheckAll=\"false\" borderColor=\"#E8EAED\" :maxListNum=\"6\" :focusable=\"false\" v-model=\"searchTeamExtFields\" radius=\"0px\" style=\"padding-left:0px!important;border-left:0;border-right:0;width:calc(100% + 1px) !important;\" @change=\"searchTeamExtChg\" />\r\n    </div>\r\n\r\n    <div ref=\"renderSet\" :class=\"$style.setter\" v-if=\"renderSet.show\" :style=\"[{left:renderSet.left+'px', top:renderSet.top+'px', zIndex:renderSet.show && theme.zindex(), borderColor:theme.border_color_light},theme.popup]\">\r\n      <!-- <div v-if=\"favshow\" :class=\"$style.title\" style=\"line-height:30px;\">{{$_L.get('分类显示')}}</div>\r\n        <Radio v-if=\"favshow\" :label=\"$_L.get('车队车辆')\" :class=\"$style.item\" :name=\"`g_${uuid}`\" :true=\"false\" v-model=\"model\" @change=\"modelChg\"/>\r\n        <Radio v-if=\"favshow\" :label=\"$_L.get('收藏车辆')\" :class=\"$style.item\" :name=\"`g_${uuid}`\" true=\"fav\"    v-model=\"model\" @change=\"modelChg\"/>\r\n        <Radio v-if=\"groupshow\" :label=\"$_L.get('分组车辆')\" :class=\"$style.item\" :name=\"`g_${uuid}`\" true=\"group\"  v-model=\"model\" @change=\"modelChg\"/>\r\n        <Button type=\"light\" v-if=\"model=='fav'   && favset\"  @click=\"favSetClick\"   icon=\"el-icon-setting\" :height=\"30\" padding=\"0 !important\" :border=\"false\" style=\"width:84px;position:absolute;top:0px;right:88px;\">{{$_L.get('收藏管理')}}</Button>\r\n        <Button type=\"light\" v-if=\"model=='group' && groupset\"   @click=\"groupSetClick\" icon=\"el-icon-setting\" :height=\"30\" padding=\"0 !important\" :border=\"false\" style=\"width:87px;position:absolute;top:0px;right:0px;\">{{$_L.get('分组管理')}}</Button>\r\n      -->\r\n      <div v-if=\"$_H.show('d1')\" :class=\"$style.title\" style=\"height:40px; line-height:40px; font-size:14px;\"><i class=\"el-icon-xinxichaxun\" :class=\"$style.titleIcon\" />{{$_L.get('统计显示')}}</div>\r\n      <div :class=\"$style.content\">\r\n        <div>\r\n          <div v-if=\"$_H.show('d1')&&$_H.show('d2')&&$_H.show('c0')\"><div :class=\"$style.line\"></div><Checkbox :disabled=\"!!model\" :label=\"$_L.get('在线统计')\" :class=\"$style.item\" v-model=\"showTeamCount.line\" @change=\"setTeamCount('line')\" /></div>\r\n          <div v-if=\"$_H.show('d1')&&$_H.show('d3')\" ><div :class=\"$style.line\"></div><Checkbox :disabled=\"!!model\" :label=\"$_L.get('行停统计')\" :class=\"$style.item\" v-model=\"showTeamCount.move\" @change=\"setTeamCount('move')\" /></div>\r\n          <div v-if=\"$_H.show('d1')&&$_H.show('d4')\" ><div :class=\"$style.line\"></div><Checkbox :disabled=\"!!model\" :label=\"$_L.get('报警统计')\" :class=\"$style.item\" v-model=\"showTeamCount.alarm\" @change=\"setTeamCount('alarm')\" /></div>\r\n          <div v-if=\"$_H.show('d1')&&$_H.show('d5')\" ><div :class=\"$style.line\"></div><Checkbox :disabled=\"!!model\" :label=\"$_L.get('无效统计')\" :class=\"$style.item\" v-model=\"showTeamCount.invalid\" @change=\"setTeamCount('invalid')\" /></div>\r\n          <div v-if=\"$_H.show('d1')&&$_H.show('d6')&&$_H.show('a6')\" ><div :class=\"$style.line\"></div><Checkbox :disabled=\"!!model\" :label=\"$_L.get('ACC统计')\" :class=\"$style.item\" v-model=\"showTeamCount.acc\" @change=\"setTeamCount('acc')\" /></div>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-if=\"$_H.show('da')\" :class=\"$style.title\" style=\"height:40px; line-height:40px; font-size:14px;\"><i class=\"el-icon-cheliangxianshi\" :class=\"$style.titleIcon\" />{{$_L.get('车辆显示')}}</div>\r\n      <div :class=\"$style.content\">\r\n        <div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dc')\" ><div :class=\"$style.line\"></div><Radio :label=\"$_L.get('车牌号码')\" :class=\"$style.item\" :name=\"`car_${uuid}`\" true=\"plate\" v-model=\"carTreeCfg.sortField\" @change=\"carSortFieldChg\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('db')\" ><div :class=\"$style.line\"></div><Radio :label=\"$_L.get('车辆名称')\" :class=\"$style.item\" :name=\"`car_${uuid}`\" true=\"name\" v-model=\"carTreeCfg.sortField\" @change=\"carSortFieldChg\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('di')\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('车牌颜色')\" :class=\"$style.item\" val=\"color\" v-model=\"showCarField\" @change=\"showCarFieldChg('color')\" /></div>\r\n          <div v-if=\"das.dj\"><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('终端标识')\" :class=\"$style.item\" val=\"tmnKey\" v-model=\"showCarField\" @change=\"showCarFieldChg('tmnKey')\" /></div>\r\n          <div v-if=\"das.de\"><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('SIM卡号')\" :class=\"$style.item\" val=\"simCard\" v-model=\"showCarField\" @change=\"showCarFieldChg('simCard')\" /></div>\r\n          <div v-if=\"das.df\"><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('终端号')\" :class=\"$style.item\" val=\"tmnNo\" v-model=\"showCarField\" @change=\"showCarFieldChg('tmnNo')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dg')\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('司机姓名')\" :class=\"$style.item\" val=\"driver\" v-model=\"showCarField\" @change=\"showCarFieldChg('driver')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dh')\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('车辆状态')\" :class=\"$style.item\" val=\"state\" v-model=\"showCarField\" @change=\"showCarFieldChg('state')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dr')&&showDyField\" ><div :class=\"$style.line\"></div><Checkbox label=\"ACC\" :class=\"$style.item\" val=\"acc\" v-model=\"showCarField\" @change=\"showCarFieldChg('acc')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dl')&&showDyField\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('行驶速度')\" :class=\"$style.item\" val=\"speed\" v-model=\"showCarField\" @change=\"showCarFieldChg('speed')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('ds')&&showDyField\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('行停时长')\" :class=\"$style.item\" val=\"rsl\" v-model=\"showCarField\" @change=\"showCarFieldChg('rsl')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dt')&&showDyField\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('链接时长')\" :class=\"$style.item\" val=\"ool\" v-model=\"showCarField\" @change=\"showCarFieldChg('ool')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dq')&&showDyField\" ><div :class=\"$style.line\"></div><Checkbox :label=\"$_L.get('所在地区')\" :class=\"$style.item\" val=\"area\" v-model=\"showCarField\" @change=\"showCarFieldChg('area')\" /></div>\r\n          <div v-if=\"$_H.show('da')&&$_H.show('dk')&&show2g4gIcon\" ><div :class=\"$style.line\"></div><Checkbox :label=\"'2G/'+$_L.get('视频')\" :class=\"$style.item\" val=\"g24\" v-model=\"showCarField\" @change=\"showCarFieldChg('g24')\" /></div>\r\n          <div v-if=\"car_bxt_list.length&&$_H.show('da')&&$_H.show('dd')\" :style=\"{width:showcount%3==0?'calc(100% + 1px)':showcount%3==1?'calc(66% + 2px)':'calc(33% +1px)'}\"><div :class=\"$style.line\"></div><InputSelect :height=\"32\" :class=\"$style.item\" :placeholder=\"$_L.get('更多选项')\" :options=\"car_bxt_list\" valueField=\"id\" labelField=\"name\" checkbox clearable :showCheckAll=\"false\" borderColor=\"#E8EAED\" :maxListNum=\"6\" :focusable=\"false\" v-model=\"showCarBxts\" :dropdownWidth=\"showcount%3==2?'130px':''\" radius=\"0px\" style=\"padding-left:2px!important;border-width:0 0 1px 0;margin-top: 1px;\" @change=\"showCarBxtsChg\" /></div>\r\n        </div>\r\n      </div>\r\n      <div v-if=\"$_H.show('dm')\" :class=\"$style.title\" style=\"height:40px; line-height:40px; font-size:14px;\"><i class=\"el-icon-cheliangguolv\" :class=\"$style.titleIcon\" />{{$_L.get('车辆过滤')}}</div>\r\n      <div :class=\"$style.content\">\r\n        <div>\r\n          <div v-if=\"$_H.show('dm')&&$_H.show('dn')\" ><div :class=\"$style.line\"></div><InputSelect :height=\"32\" :class=\"$style.item\" :placeholder=\"$_L.get('车辆状态')\" :options=\"states\" clearable borderColor=\"#E8EAED\" :maxListNum=\"6\" :focusable=\"false\" v-model=\"carTreeCfg.filters.state\" radius=\"0px\" style=\"padding-left:2px!important;border-width:0 0 1px 0;margin-top: 1px;width: calc(100% - 2px);\" @change=\"carFilterChg\" /></div>\r\n          <div v-if=\"$_H.show('dm')&&$_H.show('do')\" ><div :class=\"$style.line\"></div><InputSelect :height=\"32\" :class=\"$style.item\" :placeholder=\"$_L.get('车牌颜色')\" :options=\"colors\" clearable borderColor=\"#E8EAED\" :maxListNum=\"5\" :focusable=\"false\" v-model=\"carTreeCfg.filters.color\" radius=\"0px\" style=\"padding-left:2px!important;border-width:0 0 1px 0;margin-top: 1px;width: calc(100% - 2px);\" @change=\"carFilterChg\" /></div>\r\n          <div v-if=\"$_H.show('dm')&&$_H.show('dp')\" ><div :class=\"$style.line\"></div><InputTree :height=\"32\" :class=\"$style.item\" :placeholder=\"$_L.get('车辆类型')\" :treeWidth=\"200\" :getTreeRoots=\"cb=>getCarTypeTree(tree=>cb(tree))\" :focusable=\"false\" clearable borderColor=\"#E8EAED\" :searchable=\"false\" v-model=\"carTreeCfg.filters.type\" radius=\"0px\" style=\"padding-left:2px!important;border-width:0 0 1px 0;margin-top: 1px;width: calc(100% - 2px);\" @change=\"carFilterChg\" /></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  </Toolbar>\r\n</template>\r\n\r\n<script>\r\nimport SearchBox from \"@/components/Tree/SearchBox.vue\";\r\n// import CarFavSetWindow from \"./CarFavSetWindow.vue\";\r\n// import CarGroupSetWindow from \"./CarGroupSetWindow.vue\";\r\n\r\nimport { domLeftTop } from '@/components/util/Dom.js';\r\nimport { objCopyTo } from '@/common/util/Objects.js';\r\nimport { objIsEmpty } from '@/common/util/Objects.js';\r\nimport { arrayRemoveItem } from '@/common/util/Arrays.js';\r\nimport { Fields } from '@/common/cache/CacheTeamCar.js';\r\nimport { getCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\nimport { saveCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\nimport { countState } from '@/common/cache/CacheTeamCar.js';\r\nimport { countFilter } from '@/common/cache/CacheTeamCar.js';\r\nimport { setFilterFun } from '@/common/cache/CacheTeamCar.js';\r\nimport { resetCarTree } from '@/common/cache/CacheTeamCar.js';\r\nimport { getPlateColorArray } from '@/common/Vars.js';\r\nimport { getCarTypeTree } from \"@/common/cache/CacheCmn.js\";\r\nimport { getTeamExtWidgets } from \"@/common/cache/CacheCmn.js\";\r\n\r\nimport { getFieldMap } from \"@/common/gps/Fields.js\";\r\n\r\nexport default {\r\n  components: { SearchBox },\r\n  props: {\r\n    setting: { default: null },\r\n    miniBar: { type: Boolean, default: false },\r\n    treeBorder: { type: Boolean, default: true },\r\n    onSearchItemSelected: Function,\r\n    refreshClick: Function,\r\n    showRecent: Function,\r\n    model: { type: String, default: null },\r\n    // modelChg: Function,\r\n    onCarSortFieldChg: Function,\r\n    show2g4gIcon: { type: Boolean, default: false },\r\n    showDyField: { type: Boolean, default: false },\r\n    isSimple: { type: Boolean, default: false },\r\n  },\r\n\r\n  _carFields: null,\r\n  _teamFields: null,\r\n  _treeId: null,\r\n\r\n  data() {\r\n    return {\r\n      uuid: $_theme.zindex(),\r\n      placeholder: \"\",\r\n      hasOwnField: null,\r\n      // favshow: true,\r\n      // favset: false,\r\n      // groupshow: false,\r\n      // groupset: false,\r\n      // model: false,\r\n      carTreeCfg: {},\r\n      /*{\r\n        search: {carFields:['plate','tmnKey'], teamFields:[]}, //设置搜索条件\r\n        sortField: 'plate',\r\n        filters: {state:false,color:null,type:null},\r\n        showTeamCount: false/{line: true, move: false, alarm: false, invalid: false, acc: false},\r\n        showCarField:  false/{color:true, tmnKey:true, state:true, bxts: [bxtId]}\r\n      }*/\r\n      searchBxtFields: [],\r\n      searchTeamExtFields: [],\r\n      showTeamCount: { line: false, move: false, alarm: false, invalid: false, acc: false },\r\n      das: { dj: false, de: false, df: false },\r\n      showCarField: [], //['color', 'tmnKey', 'state'],\r\n      showCarBxts: [],\r\n      car_bxt_list: [],\r\n      team_ext_list: [],\r\n      searchSet: { show: false, left: 0, top: 0 },\r\n      renderSet: { show: false, left: 0, top: 0 },\r\n      showcount: 0,\r\n      simple: false,\r\n      colors: getPlateColorArray(),\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    hw: function () { return this.miniBar ? 27 : this.theme.inputHeight; },\r\n    mini: function () { return this.miniBar },\r\n    getCarTypeTree: () => getCarTypeTree,\r\n    states: function () { return [{ label: $_L.get('在线车辆'), value: 'online' }, { label: $_L.get('离线车辆'), value: 'offline' }, { label: $_L.get('行驶车辆'), value: 'move' }, { label: $_L.get('停止车辆'), value: 'stop' }, { label: $_L.get('报警车辆'), value: 'alarm' }, { label: $_L.get('无效定位'), value: 'invalid' }]; }\r\n  },\r\n\r\n  watch: {\r\n    'searchSet.show': function (v) {\r\n      if (!v) return document.removeEventListener('click', this.clickSearchSet);\r\n      let { left, top } = domLeftTop(this.$el);\r\n      this.searchSet.left = left - 1;\r\n      this.searchSet.top = top + this.$el.clientHeight;\r\n      setTimeout(() => { document.addEventListener('click', this.clickSearchSet); }, 10);\r\n    },\r\n    'renderSet.show': function (v) {\r\n      if (!v) return document.removeEventListener('click', this.clickRenderSet);\r\n      let { left, top } = domLeftTop(this.$el);\r\n      if (left + this.$el.clientWidth + 260 > document.documentElement.clientWidth) {\r\n        left = left + this.$el.clientWidth - 260 + 1;\r\n        top += this.$el.clientHeight;\r\n      } else {\r\n        left = left + this.$el.clientWidth;\r\n        top -= 1;\r\n      }\r\n      this.renderSet.left = left;\r\n      this.renderSet.top = top;\r\n      setTimeout(() => { document.addEventListener('click', this.clickRenderSet); }, 10);\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.simple = this.isSimple\r\n    let map = getFieldMap();\r\n    this.das.dj = $_H.show('da') && $_H.show('dc') && !!map.t0;\r\n    this.das.de = $_H.show('da') && $_H.show('de') && !!map.t1;\r\n    this.das.df = $_H.show('da') && $_H.show('df') && !!map.t2;\r\n    $_H.show('da') && $_H.show('dc') && this.showcount++;\r\n    $_H.show('da') && $_H.show('db') && this.showcount++;\r\n    $_H.show('da') && $_H.show('di') && this.showcount++;\r\n    this.das.dj && this.showcount++;\r\n    this.das.de && this.showcount++;\r\n    this.das.df && this.showcount++;\r\n    $_H.show('da') && $_H.show('dg') && this.showcount++;\r\n    $_H.show('da') && $_H.show('dh') && this.showcount++;\r\n    $_H.show('da') && $_H.show('dr') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dl') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('ds') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dt') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dq') && this.showDyField && this.showcount++;\r\n    $_H.show('da') && $_H.show('dk') && this.show2g4gIcon && this.showcount++;\r\n    this.team_ext_list = getTeamExtWidgets() || this.team_ext_list;\r\n  },\r\n\r\n  mounted() {\r\n    // this.favshow = this.setting.favshow !== false;\r\n    // this.favset = this.setting.favset === true;\r\n    // this.groupshow = this.setting.groupshow !== false;\r\n    // this.groupset = this.setting.groupset === true;\r\n    this.carTreeCfg = getCarTreeCfg();\r\n    this.carTreeCfg.showTeamCount && objCopyTo(this.carTreeCfg.showTeamCount, this.showTeamCount);\r\n    if (this.carTreeCfg.showCarField) {\r\n      this.carTreeCfg.showCarField.color && this.showCarField.push('color');\r\n      this.carTreeCfg.showCarField.tmnKey && this.showCarField.push('tmnKey');\r\n      this.carTreeCfg.showCarField.simCard && this.showCarField.push('simCard');\r\n      this.carTreeCfg.showCarField.tmnNo && this.showCarField.push('tmnNo');\r\n      this.carTreeCfg.showCarField.driver && this.showCarField.push('driver');\r\n      this.carTreeCfg.showCarField.state && this.showCarField.push('state');\r\n      this.carTreeCfg.showCarField.acc && this.showCarField.push('acc');\r\n      this.carTreeCfg.showCarField.speed && this.showCarField.push('speed');\r\n      this.carTreeCfg.showCarField.rsl && this.showCarField.push('rsl');\r\n      this.carTreeCfg.showCarField.ool && this.showCarField.push('ool');\r\n      this.carTreeCfg.showCarField.area && this.showCarField.push('area');\r\n      this.carTreeCfg.showCarField.g24 && this.showCarField.push('g24');\r\n      this.showCarBxts = this.carTreeCfg.showCarField.bxts || this.showCarBxts;\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    init(car_bxt_list) {\r\n      let map = getFieldMap();\r\n      car_bxt_list.forEach(bxt => map[bxt.id] && this.car_bxt_list.push(bxt));\r\n      let carFields = this.carTreeCfg.search.carFields;\r\n      this.car_bxt_list.forEach(bxt => carFields.indexOf('bxts.' + bxt.id) > -1 && this.searchBxtFields.push(bxt.id));\r\n      let teamFields = this.carTreeCfg.search.teamFields;\r\n      this.team_ext_list.forEach(ext => teamFields.indexOf('exts.' + ext.id) > -1 && this.searchTeamExtFields.push(ext.id));\r\n      this.setSearchField();\r\n    },\r\n    setTree(tree) {\r\n      this._treeId = tree.setting.treeId;\r\n      this.$refs.searchBox.setTree(tree);\r\n    },\r\n    searchBxtChg() {\r\n      let carFields = this.carTreeCfg.search.carFields;\r\n      this.car_bxt_list.forEach(bxt => arrayRemoveItem(carFields, 'bxts.' + bxt.id));\r\n      this.searchBxtFields && this.searchBxtFields.forEach(bxtId => carFields.push('bxts.' + bxtId));\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    searchTeamExtChg() {\r\n      let teamFields = this.carTreeCfg.search.teamFields;\r\n      this.team_ext_list.forEach(ext => arrayRemoveItem(teamFields, 'exts.' + ext.id));\r\n      this.searchTeamExtFields && this.searchTeamExtFields.forEach(bxtId => teamFields.push('exts.' + bxtId));\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    setSearchField() {\r\n      let carFields = this.carTreeCfg.search.carFields, teamFields = this.carTreeCfg.search.teamFields;\r\n      if (carFields.length == 0 && teamFields.length == 0) {\r\n        carFields.push('plate');\r\n      }\r\n      this._carFields = carFields.length > 0 ? carFields : null;\r\n      this._teamFields = teamFields.length > 0 ? teamFields : null;\r\n      this.hasOwnField = this._carFields && this._teamFields ? null : this._carFields ? 'plate' : 'pid';\r\n      let placeholder = [];\r\n      if (this._carFields) {\r\n        this._carFields.indexOf('plate') > -1 && placeholder.push($_L.get('车牌号码'));\r\n        this._carFields.indexOf('carname') > -1 && placeholder.push($_L.get('车辆名称'));\r\n        this._carFields.indexOf('tmnKey') > -1 && placeholder.push($_L.get('终端标识'));\r\n        this._carFields.indexOf('simCard') > -1 && placeholder.push($_L.get('SIM卡号'));\r\n        this.car_bxt_list.forEach(bxt => this._carFields.indexOf('bxts.' + bxt.id) > -1 && placeholder.push(bxt.name));\r\n      }\r\n      if (this._teamFields) {\r\n        this._teamFields.indexOf('teamname') > -1 && placeholder.push($_L.get('车队名称'));\r\n        this._teamFields.indexOf('linkman') > -1 && placeholder.push($_L.get('联系人员'));\r\n        this._teamFields.indexOf('phone') > -1 && placeholder.push($_L.get('联系电话'));\r\n        this.team_ext_list.forEach(ext => this._teamFields.indexOf('exts.' + ext.id) > -1 && placeholder.push(ext.name));\r\n      }\r\n      this.placeholder = placeholder.join('｜');\r\n    },\r\n    searchFun(node, text, array) {\r\n      if (node[this._treeId].hide) return false;\r\n      return this.contain(node, text, array, node.plate ? this._carFields : this._teamFields);\r\n    },\r\n    contain(node, text, array, fields) {\r\n      if (!fields) return false;\r\n      let fun;\r\n      for (let field of fields) {\r\n        fun = Fields[field];\r\n        if (fun) {\r\n          field = fun(node, field);\r\n        } else {\r\n          fields = field.split('.');// bxts.id | exts.id\r\n          fun = Fields[fields[0]];\r\n          field = fun(node, fields[1] + '.text') || fun(node, fields[1]);\r\n        }\r\n        if (!field) continue;\r\n        if ((text && field.toLowerCase().indexOf(text) >= 0) || (array && array.has(field))) return true;\r\n      }\r\n      return false;\r\n    },\r\n    // favSetClick() {\r\n    //   $_popup.open(CarFavSetWindow);\r\n    // },\r\n    // groupSetClick() {\r\n    //   $_popup.open(CarGroupSetWindow);\r\n    // },\r\n    clickSearchSet(event) {\r\n      this.searchSet.show = this.$refs.searchSet.contains(event.target);\r\n    },\r\n    clickRenderSet(event) {\r\n      this.renderSet.show = this.$refs.renderSet.contains(event.target);\r\n    },\r\n    searchSetChg() {\r\n      saveCarTreeCfg();\r\n      this.setSearchField();\r\n    },\r\n    setTeamCount(field) {\r\n      let before = this.carTreeCfg.showTeamCount;\r\n      this._setShowCfg('showTeamCount', field, this.showTeamCount[field]);\r\n      !before && this.carTreeCfg.showTeamCount && countState();\r\n      resetCarTree('updateNodeName', false, true);\r\n    },\r\n    carSortFieldChg() {\r\n      saveCarTreeCfg();\r\n      resetCarTree('updateNodeName', true, false);\r\n      this.onCarSortFieldChg && this.onCarSortFieldChg();\r\n    },\r\n    showCarFieldChg(field) {\r\n      let flag = this.showCarField.indexOf(field) != -1;\r\n      this._setShowCfg('showCarField', field, flag);\r\n      if (field == 'acc' || field == 'speed' || field == 'rsl' || field == 'ool' || field == 'area') {//ACC、速度和地区，特殊处理，需要后台推数据\r\n        this.$parent._dyfield.onFieldCheck(field, flag);\r\n        !flag && resetCarTree('updateNodeName', true, false);\r\n      } else {\r\n        resetCarTree('updateNodeName', true, false);\r\n      }\r\n    },\r\n    showCarBxtsChg() {\r\n      this._setShowCfg('showCarField', 'bxts', (!this.showCarBxts || this.showCarBxts.length == 0) ? false : this.showCarBxts);\r\n      resetCarTree('updateNodeName', true, false);\r\n    },\r\n    carFilterChg() {\r\n      saveCarTreeCfg();\r\n      setFilterFun();\r\n      this.carTreeCfg.hasFilter && countFilter();\r\n      resetCarTree('updateNodeHide', true, true);\r\n      resetCarTree('updateNodeName', false, true);\r\n    },\r\n    _setShowCfg(item, key, value) {\r\n      let cfg = this.carTreeCfg[item];\r\n      if (!cfg && !value) return;\r\n      if (!value) {\r\n        cfg && delete cfg[key];\r\n        if (objIsEmpty(cfg)) cfg = false;\r\n      } else {\r\n        cfg = cfg || {};\r\n        cfg[key] = value;\r\n      }\r\n      this.carTreeCfg[item] = cfg;\r\n      saveCarTreeCfg();\r\n    },\r\n    showTip(tip, color) {\r\n      this.$refs.searchBox.clear();\r\n      this.$refs.searchBox.showTip(tip, color);\r\n    },\r\n    destroy() {\r\n      this.$refs.searchBox.clear();\r\n      this.$refs.searchBox.setTree(null);\r\n      this._carFields = null;\r\n      this._teamFields = null;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style module>\r\n.setter {\r\n  width: 280px;\r\n  position: fixed;\r\n  margin: 0;\r\n  background-color: #fff;\r\n  border-width: 1px;\r\n  border-style: solid;\r\n  box-shadow: 0px 0px 5px 0px RGBA(0, 0, 0, 0.1);\r\n  overflow: hidden;\r\n}\r\n.item, .title {\r\n  background-position: 10px center !important;\r\n  padding-left: 10px !important;\r\n  margin-bottom: -1px;\r\n  height: 30px;\r\n  float: left;\r\n}\r\n.title {\r\n  width: 100%;\r\n  background-color: #e8eaed;\r\n}\r\n.titleIcon{\r\n  font-size: 18px;\r\n  margin-right: 8px;\r\n  position: relative;\r\n  top: 2px;\r\n}\r\n.content{\r\n  padding: 0 13px;\r\n  position: relative;\r\n}\r\n.content > div{\r\n  width: 100%;\r\n  float: left;\r\n  overflow: hidden;\r\n}\r\n.content > div > div{\r\n  float: left;\r\n  width: calc(33.3% + 1px);\r\n  margin-left: -1px;\r\n}\r\n.line{\r\n  width: 1px;\r\n  height: 17px;\r\n  background-color: #e8eaed;\r\n  margin-top: 8px;\r\n  float: left;\r\n}\r\n.item {\r\n  width: calc(100% - 1px);\r\n  border-bottom: 1px solid #e8eaed;\r\n  height: 33px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n</style>\r\n"]}]}