{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\components\\Tree\\SearchBox.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\components\\Tree\\SearchBox.vue","mtime":1662449411103},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { domLeftTop } from '@/components/util/Dom.js';\nimport { treeSearch } from '@/common/util/Trees.js';\n\nexport default {\n  props: {\n    placeholder: String,\n    hasOwnField: String,                                    // 如果指定该属性，查询对象必须有该属性，否则不查询该对象\n    searchFun: Function,                                    // 查询回调函数 参数(node, searchText) 返回true(符合条件)|false(不符合条件)\n    onItemSelected: Function,                               // 选择某个查询的结果 参数(node)\n    border: { type: Boolean, default: false },              // 是否显示边框\n    borderColor: { type: String, default: $_theme.border_color_light},            // 边框颜色\n    radius: { type: String,  default: $_theme.input_radius},// 边框圆角\n    treeBorder: { type: Boolean, default: false },          // 树是否显示边框\n    showSearchIcon: { type: Boolean, default: true },       // 是否显示搜索图标\n    height: { type: Number,  default: $_theme.inputHeight },// 高度数值，单位是px\n    searchMax:{ type: Number, default: 200  },              // 搜索栏显示的最多数量\n  },\n\n  _timeout: null,\n  _tree: null,\n  _options: null,\n  _selectedInfo: null,// {dom:xxx, index:yyy}\n\n  data() {\n    return {\n      value: null,\n      showDropDown: false,\n      tip: null,\n      mytitle: null,\n    };\n  },\n\n  watch: {\n    showDropDown: function(v) {\n      this.hideDropDown = this.hideDropDown || (e => this.showDropDown = false);\n      v ? setTimeout(()=>document.addEventListener('click', this.hideDropDown), 10) : document.removeEventListener('click', this.hideDropDown);\n    },\n    tip: function(v) {\n      this.hideTip = this.hideTip || (e => this.tip = null);\n      v ? setTimeout(()=>document.addEventListener('click', this.hideTip), 10) : document.removeEventListener('click', this.hideTip);\n    }\n  },\n  methods: {\n    setTree(tree) {\n      this._tree = tree;\n      if(!tree) return;\n      this._check = tree.setting.check && tree.setting.check.enable;\n      if (this._check) this.mytitle = $_L.get('用空格、逗号或分号隔开可精确查询多个') +'\\n' + $_L.get('按回车键勾选上所有查询结果');\n    },\n    showOrHideClearBtn(show) {\n      this.$refs.clearBtn.style.display = (show && this.value) ? '' : 'none';\n    },\n    handleClick() {\n      if (!this.value) {\n        return this.$emit('blankclick', this);\n      }\n      if (this._options && this._options.length > 0 && !this.showDropDown) {\n        this.styleDropDown();\n        this.showDropDown = true;\n      }\n    },\n    handleInput(event) {\n      this.value = event.target.value;\n      this.$emit('input', event.target.value);\n      if (!this.value) {\n        this.clear();\n        this.$emit('blankinput', this);\n        return;\n      }\n      this.showOrHideClearBtn(true);\n      this._timeout && clearTimeout(this._timeout);\n      this._timeout = setTimeout(this.onSearch, 500);\n    },\n    openOptions(options) {\n      this._options = options;\n      this.openDropDown();\n    },\n    onSearch() {\n      this._timeout = null;\n      if (!this._tree) return;\n      let [text, array] = this.getSearchText(this.value);\n      this._options = treeSearch(this._tree, text, array, this.hasOwnField, this.searchFun, array ? array.length : this.searchMax);\n      this._selectedInfo = null;\n      if (this._options.length == 0) {\n        return this.showTip($_L.get('无结果'), '#f00');\n      }\n      this.tip = null;\n      this.openDropDown();\n    },\n    getSearchText(text) {\n      text = (text||'').trim();\n      if (!text) return [null, null];\n      if (!this._check) return [text, null];\n      let array = text.split(/[ |,|;|；|，|　]/);\n      if (array.length == 1) return [text.toLowerCase(), null];\n      return [null, new Set(array)];\n    },\n    showTip(tip, color) {\n      this.showDropDown = false;\n      this.tip = tip;\n      this.$nextTick(() => {\n        let treeDom = this._tree.setting.treeObj.get(0).parentNode;\n        let treeHide = treeDom.offsetWidth == 0;\n        let {left, top} = treeHide ? domLeftTop(this.$el.parentNode) : domLeftTop(treeDom);\n        treeHide && (top = this.$el.offsetHeight + top);\n        !treeHide && left--;\n        let style = this.$refs.tip.style;\n        style.color = color;\n        style['z-index'] = $_theme.zindex();\n        style.top = top + 'px';\n        style.left = left + 'px';\n        style.width = (treeHide ? this.$el.parentNode.offsetWidth : treeDom.offsetWidth + 2) + 'px';\n      });\n    },\n    handleKeypress(event) {\n      if ((event.keyCode || event.which) == 13) {\n        let setting = this._tree.setting;\n        if (setting.check && setting.check.enable && setting.check.hasChecked && this._options && this._options.length) {//hasChecked:是否需要勾选上\n          setting = setting.treeId;\n          let n;\n          this._options.forEach(node=>(!node[setting] || node[setting].value!=1) && this._tree.checkNode(n=node, true, true, true));\n          n && this._tree.selectNode(n, false);\n          this.showDropDown = false;\n        }\n      }\n    },\n    openDropDown() {// 显示或隐藏选项列表\n      this.showDropDown = true;\n      this.styleDropDown();\n      let dom = this.$refs.dropdown;\n      dom.innerHTML = '';\n      let span = [];\n      for (let i=0, len=this._options.length, node, icon_url, icon_css, li, name; i<len; i++) {\n        node = this._options[i];\n        \n        span.push(\"<span style='width:30px;height:30px;background-position:center;\");\n        icon_url = this.iconUrl(node);\n        icon_url && span.push(icon_url);\n        span.push(\"' class='button\");\n        icon_css = this.iconCss(node);\n        icon_css && span.push(\" \", icon_css);\n        span.push(\"'></span>\");\n        span.push(name = this.nameFunction(node) || '');\n\n        li = document.createElement(\"li\");\n        li.className = this.$style.option_item;\n        li.style['background-color'] = this.theme.alternate_colors[i%2];\n        li.innerHTML = span.join('');\n        li.onclick = event => this.onItemClick(event, i, name);\n        span.length = 0;\n\n        dom.appendChild(li);\n      }\n    },\n    styleDropDown() {\n      let treeDom = this._tree.setting.treeObj.get(0).parentNode;\n      let treeHide = treeDom.offsetWidth == 0;\n      let {left, top} = treeHide ? domLeftTop(this.$el.parentNode) : domLeftTop(treeDom);\n      treeHide && (top = this.$el.offsetHeight + top);\n      !treeHide && left--;\n      let style = this.$refs.dropdown.style;\n      style.color = '';\n      style['z-index'] = $_theme.zindex();\n      style.top = top + 'px';\n      style.left = left + 'px';\n      style.height = Math.min(treeHide ? (document.documentElement.clientHeight - top - 21) : (treeDom.offsetHeight-1), this._options.length * 30) + 'px';\n      style.width = (treeHide ? this.$el.parentNode.offsetWidth-2 : treeDom.offsetWidth) + 'px';\n    },\n    iconUrl(node) {\n      if (!this._tree.setting.view.iconUrlFunction) return null;\n      let iconUrl = this._tree.setting.view.iconUrlFunction(node);\n      return iconUrl ? (\"background-size:16px 16px;background-image:url(\" + iconUrl + \");\") : null;\n    },\n    iconCss(node) {\n      if (this._tree.setting.view.iconCssFunction) {\n        return this._tree.setting.view.iconCssFunction(node) || null;\n      }\n      return node[this._tree.setting.treeId].isParent ? 'ico_close' : 'ico_docu';\n    },\n    nameFunction(node) {\n      return this._tree.setting.view.nameFunction ? this._tree.setting.view.nameFunction(node) : node[this._tree.setting.data.key.name];\n    },\n    onItemClick(event, index, name) {\n      this.value = name.split(' ')[0];\n      if (this._selectedInfo) {\n        this._selectedInfo.dom.style.cssText = 'background-color:' + this.theme.alternate_colors[this._selectedInfo.index%2];\n      }\n      this._selectedInfo = {dom: event.target, index: index};\n      this._selectedInfo.dom.style.cssText = 'background-color:' + this.theme.selected_color + '!important';\n      let node = this._options[index];\n      this._tree.selectNode(node, false);\n      let setting = this._tree.setting, tools = setting.treeObj.zTree._z.tools;\n      if (!setting.callback.beforeClick || tools.apply(setting.callback.beforeClick, [node], true) !== false) {\n        setting.treeObj.trigger(setting.treeObj.zTree.consts.event.CLICK, [null, node]);\n      }\n      if (setting.check && setting.check.enable && setting.check.hasChecked) {//hasChecked:是否需要勾选上\n        this._tree.checkNode(node, true, true, true);\n      }\n      this.onItemSelected && this.onItemSelected(node);\n    },\n    clear() {\n      this._timeout && clearTimeout(this._timeout);\n      this._timeout = null;\n      this.showDropDown = false;\n      this.$refs.dropdown.innerHTML = '';\n      this.value = this.tip = null;\n      this._options = null;\n      this._selectedInfo = null;\n      this.showOrHideClearBtn(false);\n    }\n  }\n};\n",null]}