{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\common\\tree\\CarFavSetWindow.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\common\\tree\\CarFavSetWindow.vue","mtime":1677658521312},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { resetFavTree, getCars, setFavCount } from '@/common/cache/CacheTeamCar.js';\nimport { getCarTreeIconUrl } from '@/common/util/Urls.js';\nimport { getCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\n\nexport default {\n  data: function() {\n    return {\n      waiting: false,\n      height: 0,\n    };\n  },\n  created() {\n    this.height = document.body.clientHeight * 5 / 6 - 100;\n  },\n  mounted() {\n    this._carTreeCfg = getCarTreeCfg();\n    getCars(CARS => {\n      this.$refs.tree.init(CARS.root);\n      let nodes = CARS.fav_root.children;\n      nodes.length && this.$refs.tree.checkNodes(nodes, true, true);\n    });\n  },\n\n  methods: {\n    searchFun(node, text, array) {\n      if (node.plate) {//车辆\n        if ((text && node.plate.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.plate))) return true;\n        if ((text && node.name.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.name))) return true;\n        if ((text && node.tmnKey && node.tmnKey.toLowerCase().indexOf(text) >= 0) || (array && node.tmnKey && array.has(node.tmnKey))) return true;\n        if (node.viceKeys && text && node.viceKeys.replace(/\\_va|\\_av|\\_v|\\_a/g, '').indexOf(text) >= 0) return true;\n        if (node.viceKeys && array) {\n      \t  node = node.viceKeys.replace(/\\_va|\\_av|\\_v|\\_a/g, '').split(',');\n            for (let i=0; i<node.length; i++) {\n              if (array.has(node[i])) return true;\n            }\n        }\n        return false;\n      }\n      return (text && node.name.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.name));//车队\n    },\n    nameFunction(node) {\n      return node.plate ? node[this._carTreeCfg.sortField] : (node.name + ' ['+node.online+'/'+node.carNum+']');\n    },\n    iconUrlFunction(node, open) {//车辆\n      return node.plate ? getCarTreeIconUrl(node.state, node.stts, node.cmpId) : null;\n    },\n    iconCssFunction(node, open) {\n      return node.plate ? null : open ? 'ico_open' : 'ico_close';\n    },\n    submit() {\n      let ids = [], nodes = this.$refs.tree.getCheckedNodes(true, true);\n      nodes.forEach(node => node.id != '0' && ids.push(node.plate?node.id:('t'+node.id)));\n      ids = ids.length == 0 ? null : JSON.stringify(ids);\n      //if (ids && ids.length > 2000) return $_alert.warn($_L.get('不允许收藏太多车辆！'));\n      this.waiting = true;\n      window.$_main.http.post('sys/user?updateUserCfg',{item:'FAV_CAR',value:ids}).then(result => {\n        $_alert.success($_L.get('设置成功'));\n        window.$_cache.userCfg.FAV_CAR = ids;\n        resetFavTree();\n        setFavCount();\n        this.$refs.w.close();\n      }).catch(e => this.waiting = false);\n    }\n  }\n};\n",{"version":3,"sources":["CarFavSetWindow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CarFavSetWindow.vue","sourceRoot":"src/common/tree","sourcesContent":["<template>\r\n  <Window :title=\"$_L.get('请勾选要收藏的车辆')\" :width=\"400\" ref=\"w\" :waiting=\"waiting\">\r\n    <div :class=\"$style.content\">\r\n      <Tree ref=\"tree\" :searchFun=\"searchFun\" :border=\"false\" :setting=\"{check:{enable:true},view:{nameFunction:nameFunction,iconUrlFunction:iconUrlFunction,iconCssFunction:iconCssFunction}}\" :style=\"{height:height+'px'}\"/>\r\n    </div>\r\n\r\n    <template slot=\"footer\">\r\n       <Button style=\"margin:8px 4px;width:80px;\" @click=\"$refs.w.close()\"> {{$_L.get('取消')}} </Button>\r\n       <Button style=\"margin:8px 4px;width:80px;\" type=\"primary\" @click=\"submit()\"> {{$_L.get('保存')}} </Button>\r\n    </template>\r\n  </Window>\r\n</template>\r\n\r\n<script>\r\n  import { resetFavTree, getCars, setFavCount } from '@/common/cache/CacheTeamCar.js';\r\n  import { getCarTreeIconUrl } from '@/common/util/Urls.js';\r\n  import { getCarTreeCfg } from '@/common/cache/CacheTeamCar.js';\r\n\r\n  export default {\r\n    data: function() {\r\n      return {\r\n        waiting: false,\r\n        height: 0,\r\n      };\r\n    },\r\n    created() {\r\n      this.height = document.body.clientHeight * 5 / 6 - 100;\r\n    },\r\n    mounted() {\r\n      this._carTreeCfg = getCarTreeCfg();\r\n      getCars(CARS => {\r\n        this.$refs.tree.init(CARS.root);\r\n        let nodes = CARS.fav_root.children;\r\n        nodes.length && this.$refs.tree.checkNodes(nodes, true, true);\r\n      });\r\n    },\r\n\r\n    methods: {\r\n      searchFun(node, text, array) {\r\n        if (node.plate) {//车辆\r\n          if ((text && node.plate.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.plate))) return true;\r\n          if ((text && node.name.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.name))) return true;\r\n          if ((text && node.tmnKey && node.tmnKey.toLowerCase().indexOf(text) >= 0) || (array && node.tmnKey && array.has(node.tmnKey))) return true;\r\n          if (node.viceKeys && text && node.viceKeys.replace(/\\_va|\\_av|\\_v|\\_a/g, '').indexOf(text) >= 0) return true;\r\n          if (node.viceKeys && array) {\r\n        \t  node = node.viceKeys.replace(/\\_va|\\_av|\\_v|\\_a/g, '').split(',');\r\n              for (let i=0; i<node.length; i++) {\r\n                if (array.has(node[i])) return true;\r\n              }\r\n          }\r\n          return false;\r\n        }\r\n        return (text && node.name.toLowerCase().indexOf(text) >= 0) || (array && array.has(node.name));//车队\r\n      },\r\n      nameFunction(node) {\r\n        return node.plate ? node[this._carTreeCfg.sortField] : (node.name + ' ['+node.online+'/'+node.carNum+']');\r\n      },\r\n      iconUrlFunction(node, open) {//车辆\r\n        return node.plate ? getCarTreeIconUrl(node.state, node.stts, node.cmpId) : null;\r\n      },\r\n      iconCssFunction(node, open) {\r\n        return node.plate ? null : open ? 'ico_open' : 'ico_close';\r\n      },\r\n      submit() {\r\n        let ids = [], nodes = this.$refs.tree.getCheckedNodes(true, true);\r\n        nodes.forEach(node => node.id != '0' && ids.push(node.plate?node.id:('t'+node.id)));\r\n        ids = ids.length == 0 ? null : JSON.stringify(ids);\r\n        //if (ids && ids.length > 2000) return $_alert.warn($_L.get('不允许收藏太多车辆！'));\r\n        this.waiting = true;\r\n        window.$_main.http.post('sys/user?updateUserCfg',{item:'FAV_CAR',value:ids}).then(result => {\r\n          $_alert.success($_L.get('设置成功'));\r\n          window.$_cache.userCfg.FAV_CAR = ids;\r\n          resetFavTree();\r\n          setFavCount();\r\n          this.$refs.w.close();\r\n        }).catch(e => this.waiting = false);\r\n      }\r\n    }\r\n  };\r\n</script>\r\n\r\n<style module>\r\n  .content {\r\n    padding: 5px 0 0 5px;\r\n  }\r\n  .content > * {\r\n    margin: 0 5px 5px 0;\r\n    width: calc(100% - 5px);\r\n    float: left;\r\n  }\r\n</style>\r\n"]}]}