{"remainingRequest":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\cdRule\\src\\modules\\RptGpsTrack.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\cdRule\\src\\modules\\RptGpsTrack.vue","mtime":1675482283117},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\cdRule\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Split                                    from '@/components/Split.vue';\r\nimport carTree                                  from '@/common/tree/CarTree.vue';\r\nimport InputDateTime                            from '@/components/InputDateTime.vue';\r\nimport ButtonTime                               from '@/components/ButtonTime.vue';\r\nimport AlarmTree                                from '@/common/tree/AlarmTree.vue';\r\nimport PoiTree                                  from '@/common/tree/PoiTree.vue';\r\nimport { getNowDate ,splitDate,apartDays}       from '@/common/util/Dates.js';\r\nimport { exportToExcel }                        from \"@/common/util/Exps.js\";\r\nimport { objClone }                             from \"@/common/util/Objects.js\";\r\nimport { getPois}                               from '@/common/cache/CachePoi.js';\r\nimport { getFavAlarmType}                       from '@/common/cache/CacheAlarm.js';\r\nimport { arrayRemoveFilter,arrayRemoveValue }   from '@/common/util/Arrays.js';\r\nimport { arrayToTree }                          from '@/common/util/Trees.js';\r\nimport Labels                                   from '@/common/gps/Labels.js';\r\nimport {adjunctFunction}                        from '@/common/alarm/Labels.js';\r\nimport QueryCarRunVideoWindow                   from '@/modules/query/QueryCarRunModule/QueryCarRunVideoWindow.vue';\r\nimport MediaWindow                              from '@/common/alarm/MediaWindow'\r\nimport { initAlarm }                            from '@/common/cache/CacheAlarm.js';\r\nimport {getSgnIconUrl}                          from \"@/common/util/Urls.js\";\r\n  \r\n  //  import md5 from 'js-md5'三环东路/大娄弄 苏E00855F 超速报警 超速预警 苏E00313F\\\r\n\r\n  // 三环东路/开元大道 苏E09113F  苏EFN992 车道偏离报警\r\n\r\n\r\n\r\n\r\nexport default {\r\n  name: \"SmsReport\",\r\n  components: {Split,InputDateTime,ButtonTime,QueryCarRunVideoWindow},\r\n  data() {\r\n    return {\r\n        sdate: getNowDate() + \" 00:00:00\",\r\n        edate: getNowDate() + \" 23:59:59\",\r\n        params:{carIds:[],typeIds:[],pois:[],startTime:getNowDate() + \" 00:00:00\",endTime:getNowDate() + \" 23:59:59\",sessionId:$_main.sessionId},\r\n        pois:[],\r\n        srcs:null,\r\n        toolbarHeight: 48,\r\n        loading: false,\r\n        tableData:[],\r\n        list:[],\r\n        allList:[],\r\n        querying: false,\r\n        btnTxt: $_L.get('查询'),\r\n        disabled:false,\r\n        videoShow: true,\r\n    };\r\n  },\r\n    watch: {\r\n      '$store.state.screenWidth': function() {\r\n        this.setToolbarHeight();\r\n      },\r\n      videoShow: function(v) {\r\n        this.$nextTick(()=>this.$refs.tableDetail.refreshColumn());\r\n      },\r\n    },\r\n    updated() {\r\n      this.$nextTick(this.setToolbarHeight);\r\n    },\r\n    activated: function () {\r\n      this.setToolbarHeight();\r\n      this.$refs.table.resetResizable();\r\n    },\r\n    created(){\r\n    },\r\n    computed: {\r\n        carTree: () => carTree ,\r\n        exportToExcel: () => exportToExcel,\r\n        AlarmTree: () => AlarmTree,\r\n        poiTree: () => PoiTree,\r\n        Labels: () => Labels,\r\n    },\r\n    methods: {\r\n        getSgnIconUrl:getSgnIconUrl,\r\n        setToolbarHeight() {\r\n          let sheight = this.$refs.toolbar.$el.scrollWidth > this.$refs.toolbar.$el.clientWidth ? 17 : 0;\r\n          this.toolbarHeight = this.$refs.toolbar.$el.clientHeight + sheight;\r\n        },\r\n        getAlarmSrc(callback){\r\n          let root = {id:'0',name:$_L.get('报警来源')};\r\n          let children = arrayToTree(this.alarmArray,'id','pid')\r\n          children.forEach(node => node.parent = root);\r\n          root.children=children\r\n          callback(root);\r\n        },\r\n        onSearch(){\r\n          if(!this.params.carIds||this.params.carIds.length==0){\r\n            $_alert.warn($_L.get('请选择车辆！'), this.$el);\r\n            return;\r\n          }\r\n          if(!this.pois||this.pois.length==0){\r\n            $_alert.warn($_L.get('请选择标注！'), this.$el);\r\n            return;\r\n          }\r\n          let pois = this.pois||[],poisList=[];\r\n          pois.forEach(el => {if(getPois().map[el]&&!('children' in getPois().map[el])){poisList.push(objClone(getPois().map[el],new Set(['parent'])))}});\r\n          this.params.pois=poisList\r\n          if(!this.params.typeIds||this.params.typeIds.length==0){\r\n            $_alert.warn($_L.get('请选择报警类型！'), this.$el);\r\n            return;\r\n          }\r\n          if (this.params.startTime > this.params.endTime)return $_alert.warn($_L.get('开始日期不能大于结束日期！'), this.$el);\r\n          if(apartDays(this.params.startTime,this.params.endTime)>31){\r\n            $_alert.warn($_L.get('日期间隔不能超过31天！'), this.$el);\r\n            return\r\n          }\r\n          this.disabled=true;\r\n          this.tableData=[];\r\n          this.list=[];\r\n          if(!this.srcs){\r\n            this.params.srcs=['1','2','3','9','8']\r\n          }else{\r\n            this.params.srcs=this.srcs\r\n          }\r\n          $_http.postxhyc('query/alarm',this.params).then(res=>{\r\n            this.disabled=false;\r\n            if(res&&res.result&&res.result.length>0){\r\n              this.tableData=res.result\r\n              this.allList=[]\r\n              this.tableData.map(item=>{\r\n                this.allList=this.allList.concat(item.alarm)\r\n              })\r\n            }else{\r\n              $_alert.warn($_L.get('暂无数据'))\r\n            }\r\n          })\r\n          // this.list=[];\r\n\r\n          // let params=[]\r\n          // var dateData=splitDate(this.params.startTime,this.params.endTime)\r\n          // for (let i = 0; i < dateData.length; i++) {\r\n          //     params.push(Object.assign({carIds: this.params.carIds, startTime:dateData[i].sdate,endTime:dateData[i].edate}))\r\n          // }\r\n          // this.querying = true;\r\n          // this.toQuery(params);\r\n        },\r\n      toQuery(params,index=0) {\r\n        this.btnTxt = parseInt(index * 100 / params.length) + '%';\r\n        $_http.postxhyc(\"query/alarm\", params[index]).then(result => {\r\n          if (this.querying) {\r\n              if(result){\r\n                this.list=this.list.concat(JSON.parse(JSON.stringify(result)))\r\n              }\r\n              (++index < params.length) ? this.toQuery(params, index): this.toFinish();\r\n          }\r\n        })\r\n      },\r\n      toFinish() {\r\n        this.querying = false;\r\n        this.btnTxt = $_L.get(\"查询\");\r\n        this.list.length==0&&$_alert.warn($_L.get('暂无数据'));\r\n      },\r\n      onTableClick({row}){\r\n        this.list=row.alarm;\r\n      },\r\n      // onItemSelected({row}){\r\n      //   console.log(Labels.carExtByCarId(row))\r\n      // },\r\n      exportEvent(){\r\n          if(this.tableData&&this.tableData.length>0){\r\n            this.$refs.table.exportData({\r\n                      filename: '标注下查报警统计',\r\n                      type: 'csv',\r\n                      isHeader: true,\r\n                      isFooter: true,\r\n                      data: this.tableData\r\n                    })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      exportEventDetail(){\r\n          if(this.list&&this.list.length>0){\r\n            this.$refs.tableDetail.exportData({\r\n                      filename: '标注下查报警明细',\r\n                      type: 'csv',\r\n                      isHeader: true,\r\n                      isFooter: true,\r\n                      data: this.list\r\n                    })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      exportEventAllDetail(){\r\n          \r\n          if(this.allList&&this.allList.length>0){\r\n            this.$nextTick(()=>{\r\n              this.$refs.tableAllDetail.exportData({\r\n                        filename: '标注下查所有报警明细',\r\n                        type: 'csv',\r\n                        isHeader: true,\r\n                        isFooter: true,\r\n                        data: this.allList\r\n                      })\r\n            })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      onAlarmTreeCheck(node,ns) {\r\n        arrayRemoveFilter(ns,item => !!item.children);\r\n      },\r\n      stateFormatter({cellValue}){\r\n        switch (cellValue) {\r\n          case '0':\r\n            return $_L.get('未处理')\r\n          case '1':\r\n            return $_L.get('处理')\r\n          case '2':\r\n            return $_L.get('忽略')\r\n          case '3':\r\n            return $_L.get('误报')\r\n          default:\r\n            break;\r\n        }\r\n      },\r\n      typeFormatter({cellValue}){\r\n        return cellValue?getFavAlarmType().map[cellValue].name:''\r\n      },  \r\n      viewTrack(item) {\r\n        import('@/modules/mnt/MntTrackModuleForSkip.vue').then(component => {\r\n          $_popup.open(component.default, {\r\n            title: $_L.get('车辆行车轨迹') + ' -> ' + item.plate,\r\n            carId: item.carId,\r\n            stime: item.stime,\r\n            etime: item.etime,\r\n            plate: item.plate\r\n          });\r\n        });\r\n      },\r\n      viewVideo(item) {\r\n        $_popup.open(QueryCarRunVideoWindow, {\r\n          carId: item.carId,\r\n          stime: item.stime,\r\n          etime: item.etime\r\n        });\r\n      },\r\n      viewMediaClick(row) {\r\n              let alarm=row\r\n              alarm.typeIds=this.params.typeIds\r\n\r\n              $_popup.open(MediaWindow,{alarm:alarm});\r\n      },\r\n    }\r\n};\r\n\r\n",{"version":3,"sources":["RptGpsTrack.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"RptGpsTrack.vue","sourceRoot":"src/modules","sourcesContent":["<template>\r\n  <div>\r\n   <div :class=\"$style.header\">\r\n    <!--工具栏-->\r\n    <Toolbar ref=\"toolbar\">\r\n      <div style=\"width:280px\">\r\n        <InputTree :label=\"$_L.get('选择车辆')\" v-model=\"params.carIds\" :tree=\"carTree\" searchable clearable hasOwnField=\"plate\" :treeHeight='9999' :class=\"$style.inputBox\"/>\r\n        <InputTree :label=\"$_L.get('选择标注')\" :tree=\"poiTree\" v-model=\"pois\" clearable :class=\"$style.inputBox\" ref=\"pois\"/>\r\n      </div>  \r\n      <div style=\"width:280px\">\r\n        <InputTree :label=\"$_L.get('报警类型')\" v-model=\"params.typeIds\" :tree=\"AlarmTree\" :placeholder=\"$_L.get('默认全部')\" clearable :treeHeight=\"500\" :setting=\"{callback:{onCheck:onAlarmTreeCheck}}\"  :class=\"$style.inputBox\"/>\r\n          <InputSelect :label=\"$_L.get('报警来源')\" v-model=\"srcs\" :placeholder=\"$_L.get('默认全部')\" :options=\"[{value:'1',label:$_L.get('终端')},{value:'2',label:$_L.get('平台')},{value:'3',label:$_L.get('政府')},{value:'9',label:$_L.get('其它')},{value:'8',label:$_L.get('下级企业平台')}]\" checkbox clearable :class=\"$style.inputBox\" />\r\n      </div>\r\n      <QuickTime type=\"YMDHNS\" @set=\"(s,e)=>{params.startTime=s;params.endTime=e}\" :height=\"63\" style=\"margin-right:-9px\"/>  \r\n      <div style=\"width:280px\">\r\n        <InputDateTime  :label=\"$_L.get('开始时间')\"        v-model=\"params.startTime\" :class=\"$style.inputBox\"  type=\"YMDHNS\" clearable/>\r\n        <InputDateTime  :label=\"$_L.get('结束时间')\"        v-model=\"params.endTime\" :class=\"$style.inputBox\"  type=\"YMDHNS\"   clearable/>\r\n      </div>\r\n      <Button type=\"primary\" :icon=\"querying?'el-icon-close':'el-icon-search'\" style=\"height:63px;\" @click=\"querying?toFinish():onSearch()\" :disabled=\"disabled\" >{{btnTxt}}</Button>\r\n      <div slot=\"right\">\r\n        <Button radius=\"3px\" type=\"primary\" icon=\"el-icon-download\" ref=\"detailBtn\" :height=\"29\" @click=\"exportEvent\" style=\"display: inline-block;margin-bottom:5px;\">{{$_L.get('统计')}}</Button>\r\n        <Button radius=\"3px\" type=\"primary\" icon=\"el-icon-download\" ref=\"detailBtn\" :height=\"29\" @click=\"exportEventDetail\" style=\"display: inline-block;margin-left:5px\">{{$_L.get('明细')}}</Button>\r\n        <Button radius=\"3px\" type=\"primary\" icon=\"el-icon-download\" ref=\"detailBtn\" :height=\"29\" @click=\"exportEventAllDetail\" style=\"display: block;width:134px\">{{$_L.get('所有明细')}}</Button>\r\n      </div>\r\n    </Toolbar>\r\n\r\n    <!--表格-->\r\n    <div style=\"height:100%;position:relative;flex:1;border:1px solid;\" :style=\"{borderColor:theme.border_color_dark,height:`calc(50% - ${toolbarHeight/2}px)`}\">\r\n      <vxe-table  height=\"auto\" :data=\"tableData\" :class=\"$style.grid\" :style=\"{borderColor:theme.border_color_dark}\" ref=\"table\" id='table-content' @cell-click=\"onTableClick\">\r\n\t\t\t  <vxe-table-column type=\"checkbox\"  width=\"60\"/>\r\n\t\t\t  <vxe-table-column type=\"index\" :title=\"$_L.get('序号')\" width=\"60\"/>\r\n            <vxe-table-column field=\"poiName\" :title=\"$_L.get('标注名称')\" />\r\n            <vxe-table-column field=\"poiLng\" :title=\"$_L.get('标注经度')\"/>\r\n            <vxe-table-column field=\"poiLat\" :title=\"$_L.get('标注纬度')\"/>\r\n            <vxe-table-column field=\"alarmNum\" :title=\"$_L.get('报警个数')\"/>\r\n      </vxe-table>\r\n    </div>\r\n    <div style=\"flex:1;height:100%;position:relative;border:1px solid;\" :style=\"{borderColor:theme.border_color_dark,height:`calc(50% - ${toolbarHeight/2}px)`}\">\r\n      <vxe-table  height=\"auto\" :data=\"list\" :class=\"$style.grid\" :style=\"{borderColor:theme.border_color_dark}\" ref=\"tableDetail\" id='table-content'>\r\n\t\t\t  <vxe-table-column type=\"checkbox\"  width=\"60\"/>\r\n\t\t\t  <vxe-table-column type=\"index\" :title=\"$_L.get('序号')\" width=\"60\"/>\r\n              <vxe-table-column field=\"poiName\" :title=\"$_L.get('标注名称')\" />\r\n              <vxe-table-column field=\"plate\" :title=\"$_L.get('车牌号')\"/>\r\n              <vxe-table-column field=\"companyName\" :title=\"$_L.get('车队名称')\"/>\r\n              <vxe-table-column field=\"addr\" :title=\"$_L.get('地址')\"/>\r\n              <!-- <vxe-table-column field=\"adjunct\" :title=\"$_L.get('接收数/附件数')\" :formater=\"({row})=>{adjunctFunction(row)}\">\r\n                <template v-slot:name_adjunct=\"{ row, column }\">\r\n                  <span @click=\"viewMediaClick(row,column)\" style=\"text-decoration: underline;cursor: pointer;\" :style=\"{color: theme.color}\">{{123+AlarmLabels.adjunctFunction(row)}}</span>\r\n                </template>\r\n              </vxe-table-column> -->\r\n              <vxe-table-column field=\"\" :title=\"$_L.get('接收数/附件数')\">\r\n                <template v-slot=\"{ row, column }\">\r\n                  <span @click=\"viewMediaClick(row,column)\" style=\"text-decoration: underline;cursor: pointer;\">{{row.allfjNum+'/'+row.fjsok}}</span>\r\n                </template>\r\n              </vxe-table-column>\r\n              <vxe-table-column field=\"\" :title=\"$_L.get('轨迹')\" width=\"70px\">\r\n                <template v-slot=\"{ row }\">\r\n                  <Button type=\"light\" :height=\"24\" @click=\"viewTrack(row)\" style=\"font-size:12px\">{{$_L.get('查看')}}</Button>\r\n                </template>\r\n              </vxe-table-column>\r\n              <vxe-table-column field=\"\" :title=\"$_L.get('录像回放')\" width=\"70px\" :visible=\"videoShow\">\r\n                <template v-slot=\"{ row }\">\r\n                  <Button type=\"light\" :height=\"24\" @click=\"viewVideo(row)\" style=\"font-size:12px\" :disabled=\"row.accState=='0'\">{{$_L.get('回放')}}</Button>\r\n                  <img :src=\"getSgnIconUrl(row.accState=='1'?'c31-1':'c31-0')\" style=\"vertical-align: middle;position: absolute;top: 8px;right: 0px;\" :title=\"$_L.get(row.accState=='1'?'当前ACC开':'当前ACC关')\"/>\r\n                </template>\r\n              </vxe-table-column>\r\n              <vxe-table-column field=\"stime\" :title=\"$_L.get('开始时间')\"/>\r\n              <vxe-table-column field=\"etime\" :title=\"$_L.get('结束时间')\"/>\r\n              <vxe-table-column field=\"lng\" :title=\"$_L.get('经度')\"/>\r\n              <vxe-table-column field=\"lat\" :title=\"$_L.get('纬度')\"/>\r\n              <vxe-table-column field=\"speed\" :title=\"$_L.get('速度(km/h)')\"/>\r\n              <vxe-table-column field=\"alarmType\" :title=\"$_L.get('报警类型')\" :formatter=\"typeFormatter\"/>\r\n              <vxe-table-column field=\"solveState\" :title=\"$_L.get('报警处理状态')\" :formatter=\"stateFormatter\"/>\r\n              <vxe-table-column field=\"solveTime\" :title=\"$_L.get('报警处理时间')\"/>\r\n              <vxe-table-column field=\"solveDes\" :title=\"$_L.get('报警处理描述')\"/>\r\n              <vxe-table-column field=\"solveUser\" :title=\"$_L.get('报警处理人')\"/>\r\n      </vxe-table>\r\n    </div>\r\n    <div style=\"flex-shrink:1;height:100%;position:relative;border:1px solid;\" :style=\"{borderColor:theme.border_color_dark}\" v-show=\"false\">\r\n      <vxe-table  height=\"auto\" :data=\"allList\" :class=\"$style.grid\" :style=\"{borderColor:theme.border_color_dark}\" ref=\"tableAllDetail\" id='table-content'>\r\n\t\t\t  <vxe-table-column type=\"checkbox\"  width=\"60\"/>\r\n\t\t\t  <vxe-table-column type=\"index\" :title=\"$_L.get('序号')\" width=\"60\"/>\r\n              <vxe-table-column field=\"poiName\" :title=\"$_L.get('标注名称')\" />\r\n              <vxe-table-column field=\"plate\" :title=\"$_L.get('车牌号')\"/>\r\n              <vxe-table-column field=\"companyName\" :title=\"$_L.get('车队名称')\"/>\r\n              <vxe-table-column field=\"addr\" :title=\"$_L.get('地址')\"/>\r\n              <vxe-table-column field=\"stime\" :title=\"$_L.get('开始时间')\"/>\r\n              <vxe-table-column field=\"etime\" :title=\"$_L.get('结束时间')\"/>\r\n              <vxe-table-column field=\"lng\" :title=\"$_L.get('经度')\"/>\r\n              <vxe-table-column field=\"lat\" :title=\"$_L.get('纬度')\"/>\r\n              <vxe-table-column field=\"speed\" :title=\"$_L.get('速度(km/h)')\"/>\r\n              <vxe-table-column field=\"alarmType\" :title=\"$_L.get('报警类型')\" :formatter=\"typeFormatter\"/>\r\n              <vxe-table-column field=\"solveState\" :title=\"$_L.get('报警处理状态')\" :formatter=\"stateFormatter\"/>\r\n              <vxe-table-column field=\"solveTime\" :title=\"$_L.get('报警处理时间')\"/>\r\n              <vxe-table-column field=\"solveDes\" :title=\"$_L.get('报警处理描述')\"/>\r\n              <vxe-table-column field=\"solveUser\" :title=\"$_L.get('报警处理人')\"/>\r\n      </vxe-table>\r\n    </div>\r\n   </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Split                                    from '@/components/Split.vue';\r\nimport carTree                                  from '@/common/tree/CarTree.vue';\r\nimport InputDateTime                            from '@/components/InputDateTime.vue';\r\nimport ButtonTime                               from '@/components/ButtonTime.vue';\r\nimport AlarmTree                                from '@/common/tree/AlarmTree.vue';\r\nimport PoiTree                                  from '@/common/tree/PoiTree.vue';\r\nimport { getNowDate ,splitDate,apartDays}       from '@/common/util/Dates.js';\r\nimport { exportToExcel }                        from \"@/common/util/Exps.js\";\r\nimport { objClone }                             from \"@/common/util/Objects.js\";\r\nimport { getPois}                               from '@/common/cache/CachePoi.js';\r\nimport { getFavAlarmType}                       from '@/common/cache/CacheAlarm.js';\r\nimport { arrayRemoveFilter,arrayRemoveValue }   from '@/common/util/Arrays.js';\r\nimport { arrayToTree }                          from '@/common/util/Trees.js';\r\nimport Labels                                   from '@/common/gps/Labels.js';\r\nimport {adjunctFunction}                        from '@/common/alarm/Labels.js';\r\nimport QueryCarRunVideoWindow                   from '@/modules/query/QueryCarRunModule/QueryCarRunVideoWindow.vue';\r\nimport MediaWindow                              from '@/common/alarm/MediaWindow'\r\nimport { initAlarm }                            from '@/common/cache/CacheAlarm.js';\r\nimport {getSgnIconUrl}                          from \"@/common/util/Urls.js\";\r\n  \r\n  //  import md5 from 'js-md5'三环东路/大娄弄 苏E00855F 超速报警 超速预警 苏E00313F\\\r\n\r\n  // 三环东路/开元大道 苏E09113F  苏EFN992 车道偏离报警\r\n\r\n\r\n\r\n\r\nexport default {\r\n  name: \"SmsReport\",\r\n  components: {Split,InputDateTime,ButtonTime,QueryCarRunVideoWindow},\r\n  data() {\r\n    return {\r\n        sdate: getNowDate() + \" 00:00:00\",\r\n        edate: getNowDate() + \" 23:59:59\",\r\n        params:{carIds:[],typeIds:[],pois:[],startTime:getNowDate() + \" 00:00:00\",endTime:getNowDate() + \" 23:59:59\",sessionId:$_main.sessionId},\r\n        pois:[],\r\n        srcs:null,\r\n        toolbarHeight: 48,\r\n        loading: false,\r\n        tableData:[],\r\n        list:[],\r\n        allList:[],\r\n        querying: false,\r\n        btnTxt: $_L.get('查询'),\r\n        disabled:false,\r\n        videoShow: true,\r\n    };\r\n  },\r\n    watch: {\r\n      '$store.state.screenWidth': function() {\r\n        this.setToolbarHeight();\r\n      },\r\n      videoShow: function(v) {\r\n        this.$nextTick(()=>this.$refs.tableDetail.refreshColumn());\r\n      },\r\n    },\r\n    updated() {\r\n      this.$nextTick(this.setToolbarHeight);\r\n    },\r\n    activated: function () {\r\n      this.setToolbarHeight();\r\n      this.$refs.table.resetResizable();\r\n    },\r\n    created(){\r\n    },\r\n    computed: {\r\n        carTree: () => carTree ,\r\n        exportToExcel: () => exportToExcel,\r\n        AlarmTree: () => AlarmTree,\r\n        poiTree: () => PoiTree,\r\n        Labels: () => Labels,\r\n    },\r\n    methods: {\r\n        getSgnIconUrl:getSgnIconUrl,\r\n        setToolbarHeight() {\r\n          let sheight = this.$refs.toolbar.$el.scrollWidth > this.$refs.toolbar.$el.clientWidth ? 17 : 0;\r\n          this.toolbarHeight = this.$refs.toolbar.$el.clientHeight + sheight;\r\n        },\r\n        getAlarmSrc(callback){\r\n          let root = {id:'0',name:$_L.get('报警来源')};\r\n          let children = arrayToTree(this.alarmArray,'id','pid')\r\n          children.forEach(node => node.parent = root);\r\n          root.children=children\r\n          callback(root);\r\n        },\r\n        onSearch(){\r\n          if(!this.params.carIds||this.params.carIds.length==0){\r\n            $_alert.warn($_L.get('请选择车辆！'), this.$el);\r\n            return;\r\n          }\r\n          if(!this.pois||this.pois.length==0){\r\n            $_alert.warn($_L.get('请选择标注！'), this.$el);\r\n            return;\r\n          }\r\n          let pois = this.pois||[],poisList=[];\r\n          pois.forEach(el => {if(getPois().map[el]&&!('children' in getPois().map[el])){poisList.push(objClone(getPois().map[el],new Set(['parent'])))}});\r\n          this.params.pois=poisList\r\n          if(!this.params.typeIds||this.params.typeIds.length==0){\r\n            $_alert.warn($_L.get('请选择报警类型！'), this.$el);\r\n            return;\r\n          }\r\n          if (this.params.startTime > this.params.endTime)return $_alert.warn($_L.get('开始日期不能大于结束日期！'), this.$el);\r\n          if(apartDays(this.params.startTime,this.params.endTime)>31){\r\n            $_alert.warn($_L.get('日期间隔不能超过31天！'), this.$el);\r\n            return\r\n          }\r\n          this.disabled=true;\r\n          this.tableData=[];\r\n          this.list=[];\r\n          if(!this.srcs){\r\n            this.params.srcs=['1','2','3','9','8']\r\n          }else{\r\n            this.params.srcs=this.srcs\r\n          }\r\n          $_http.postxhyc('query/alarm',this.params).then(res=>{\r\n            this.disabled=false;\r\n            if(res&&res.result&&res.result.length>0){\r\n              this.tableData=res.result\r\n              this.allList=[]\r\n              this.tableData.map(item=>{\r\n                this.allList=this.allList.concat(item.alarm)\r\n              })\r\n            }else{\r\n              $_alert.warn($_L.get('暂无数据'))\r\n            }\r\n          })\r\n          // this.list=[];\r\n\r\n          // let params=[]\r\n          // var dateData=splitDate(this.params.startTime,this.params.endTime)\r\n          // for (let i = 0; i < dateData.length; i++) {\r\n          //     params.push(Object.assign({carIds: this.params.carIds, startTime:dateData[i].sdate,endTime:dateData[i].edate}))\r\n          // }\r\n          // this.querying = true;\r\n          // this.toQuery(params);\r\n        },\r\n      toQuery(params,index=0) {\r\n        this.btnTxt = parseInt(index * 100 / params.length) + '%';\r\n        $_http.postxhyc(\"query/alarm\", params[index]).then(result => {\r\n          if (this.querying) {\r\n              if(result){\r\n                this.list=this.list.concat(JSON.parse(JSON.stringify(result)))\r\n              }\r\n              (++index < params.length) ? this.toQuery(params, index): this.toFinish();\r\n          }\r\n        })\r\n      },\r\n      toFinish() {\r\n        this.querying = false;\r\n        this.btnTxt = $_L.get(\"查询\");\r\n        this.list.length==0&&$_alert.warn($_L.get('暂无数据'));\r\n      },\r\n      onTableClick({row}){\r\n        this.list=row.alarm;\r\n      },\r\n      // onItemSelected({row}){\r\n      //   console.log(Labels.carExtByCarId(row))\r\n      // },\r\n      exportEvent(){\r\n          if(this.tableData&&this.tableData.length>0){\r\n            this.$refs.table.exportData({\r\n                      filename: '标注下查报警统计',\r\n                      type: 'csv',\r\n                      isHeader: true,\r\n                      isFooter: true,\r\n                      data: this.tableData\r\n                    })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      exportEventDetail(){\r\n          if(this.list&&this.list.length>0){\r\n            this.$refs.tableDetail.exportData({\r\n                      filename: '标注下查报警明细',\r\n                      type: 'csv',\r\n                      isHeader: true,\r\n                      isFooter: true,\r\n                      data: this.list\r\n                    })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      exportEventAllDetail(){\r\n          \r\n          if(this.allList&&this.allList.length>0){\r\n            this.$nextTick(()=>{\r\n              this.$refs.tableAllDetail.exportData({\r\n                        filename: '标注下查所有报警明细',\r\n                        type: 'csv',\r\n                        isHeader: true,\r\n                        isFooter: true,\r\n                        data: this.allList\r\n                      })\r\n            })\r\n          }else{\r\n            $_alert.warn($_L.get('暂无数据'))\r\n          }\r\n      },\r\n      onAlarmTreeCheck(node,ns) {\r\n        arrayRemoveFilter(ns,item => !!item.children);\r\n      },\r\n      stateFormatter({cellValue}){\r\n        switch (cellValue) {\r\n          case '0':\r\n            return $_L.get('未处理')\r\n          case '1':\r\n            return $_L.get('处理')\r\n          case '2':\r\n            return $_L.get('忽略')\r\n          case '3':\r\n            return $_L.get('误报')\r\n          default:\r\n            break;\r\n        }\r\n      },\r\n      typeFormatter({cellValue}){\r\n        return cellValue?getFavAlarmType().map[cellValue].name:''\r\n      },  \r\n      viewTrack(item) {\r\n        import('@/modules/mnt/MntTrackModuleForSkip.vue').then(component => {\r\n          $_popup.open(component.default, {\r\n            title: $_L.get('车辆行车轨迹') + ' -> ' + item.plate,\r\n            carId: item.carId,\r\n            stime: item.stime,\r\n            etime: item.etime,\r\n            plate: item.plate\r\n          });\r\n        });\r\n      },\r\n      viewVideo(item) {\r\n        $_popup.open(QueryCarRunVideoWindow, {\r\n          carId: item.carId,\r\n          stime: item.stime,\r\n          etime: item.etime\r\n        });\r\n      },\r\n      viewMediaClick(row) {\r\n              let alarm=row\r\n              alarm.typeIds=this.params.typeIds\r\n\r\n              $_popup.open(MediaWindow,{alarm:alarm});\r\n      },\r\n    }\r\n};\r\n\r\n</script>\r\n\r\n<style module>\r\n  .header{\r\n      width: 100%;\r\n      height: 100%;\r\n      background-color: #fff;\r\n  }\r\n  .grid {\r\n      border-width: 1px;\r\n      border-style: solid;\r\n      height: 100%;\r\n      width: 100%;\r\n      position:absolute;left:0;top:0;right:0;bottom:0;border:1px solid;border-top:0;border-bottom:0;\r\n  }\r\n  .inputBox {\r\n      display: block;\r\n      /* width: 240px; */\r\n  }\r\n</style>\r\n"]}]}